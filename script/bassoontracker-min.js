/*BassoonTracker v0.2.04 by Steffest - build 2018-05-07 - Full source on https://github.com/steffest/BassoonTracker */var BassoonTracker=function(){function a(a,c){function d(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}c=c||{};var e,f=a.numberOfChannels,g=a.sampleRate,h=c.float32?3:1,i=3===h?32:16;return e=2===f?d(a.getChannelData(0),a.getChannelData(1)):a.getChannelData(0),b(e,h,g,f,i)}function b(a,b,c,d,e){function f(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}var g=e/8,h=d*g,i=44+a.length*g,j=new ArrayBuffer(i),k=new DataView(j);f(k,0,"RIFF"),k.setUint32(4,36+a.length*g,!0),f(k,8,"WAVE"),f(k,12,"fmt "),k.setUint32(16,16,!0),k.setUint16(20,b,!0),k.setUint16(22,d,!0),k.setUint32(24,c,!0),k.setUint32(28,c*h,!0),k.setUint16(32,h,!0),k.setUint16(34,e,!0),f(k,36,"data"),k.setUint32(40,a.length*g,!0);var l,m=44;if(1===b)for(l=0;l<a.length;l++,m+=2){var n=Math.max(-1,Math.min(1,a[l]));k.setInt16(m,n<0?32768*n:32767*n,!0)}else for(l=0;l<a.length;l++,m+=4)k.setFloat32(m,a[l],!0);return j}function c(a){if(window.location.getParameter)return window.location.getParameter(a);if(location.search)for(var b=location.search.substring(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]&&d[0]==a)return d[1]||!0}}function d(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(a){var d=c.response;d?b&&b(d):b&&b(!1)},c.send(null)}function e(a,b){function c(a){a=0===a?a:a||d.index,a<0&&(a=0),a>=d.length&&(a=d.length-1),d.index=a}var d={index:0,litteEndian:!b};return d.goto=function(a){c(a)},d.jump=function(a){this.goto(this.index+a)},d.readByte=function(a){c(a);var b=this.dataView.getInt8(this.index);return this.index++,b},d.writeByte=function(a,b){c(b),this.dataView.setInt8(this.index,a),this.index++},d.readUbyte=function(a){c(a);var b=this.dataView.getUint8(this.index);return this.index++,b},d.writeUByte=function(a,b){c(b),this.dataView.setUint8(this.index,a),this.index++},d.readUint=function(a){c(a);var b=this.dataView.getUint32(this.index,this.litteEndian);return this.index+=4,b},d.writeUint=function(a,b){c(b),this.dataView.setUint32(this.index,a,this.litteEndian),this.index+=4},d.readBytes=function(a,b){c(b);var d=new Uint8Array(a),e=this.index;(a+=e)>this.length&&(a=this.length);for(var f=0;e<a;++e)d.setUint8(f++,this.dataView.getUint8(e));return this.index=a,d},d.readString=function(a,b){c(b);var d=this.index,e=this.dataView,f="";for((a+=d)>this.length&&(a=this.length);d<a;++d){var g=e.getUint8(d);if(0==g)break;f+=String.fromCharCode(g)}return this.index=a,f},d.writeString=function(a,b){c(b);for(var d=this.dataView,e=a.length,f=0;f<e;f++)d.setUint8(this.index+f,a.charCodeAt(f));this.index+=e},d.writeStringSection=function(a,b,e,f){c(f),b=b||1,a=a||"",e=e||0;var g=a.length;g>b&&(a=a.substr(0,b)),d.writeString(a),d.fill(e,b-g)},d.readWord=function(a){c(a);var b=this.dataView.getUint16(this.index,this.litteEndian);return this.index+=2,b},d.writeWord=function(a,b){c(b),this.dataView.setUint16(this.index,a,this.litteEndian),this.index+=2},d.readLong=d.readDWord=d.readUint,d.readShort=function(a,b){c(b);var d=this.dataView.getInt16(this.index,this.litteEndian);return this.index+=2,d},d.clear=function(a){d.fill(0,a)},d.fill=function(a,b){a=a||0,b=b||0;for(var c=0;c<b;c++)d.writeByte(a)},d.isEOF=function(a){return a=a||0,this.index>=this.length-a},d.buffer=a,d.dataView=new DataView(a),d.length=a.byteLength,d}function f(a,b){function c(){var b={};return b.name=a.readString(4),b.size=a.readDWord(),b}a.litteEndian=!1,a.goto(12);for(var d=c();"BODY"!=d.name&&!a.isEOF(10);)"NAME"==d.name?b.name=a.readString(d.size):a.jump(d.size),d=c();if("BODY"==d.name)for(var e=0;e<d.size;e++){var f=a.readByte();b.data.push(f/127)}}function g(a,b){var c=$.RAW_8BIT,d=k;a.goto(0);var e=a.readString(4);if("RIFF"==e&&(c=$.WAVE_PCM,d=l),"FORM"==e){a.goto(8);var g=a.readString(4);"8SVX"==g&&(c=$.IFF_8SVX,d=f)}return b&&b.name&&".mp3"==b.name.toLowerCase().slice(-4)&&(c=$.MP3,d=h),b&&d?void d(a,b):c}function h(a,b){F.context.decodeAudioData(a.buffer,function(a){return a?(b.data=a.getChannelData(0),void(b.length=a.length)):void alert("error decoding file data: "+url)},function(a){})}function k(a,b){a.goto(0);for(var c=0;c<b.length;c++){var d=a.readByte();b.data.push(d/127)}}function l(a,b){a.litteEndian=!0,a.goto(4);var c={};c.chunkSize=a.readDWord(),c.format=a.readString(4),c.subChunk=a.readString(4),c.subChuckSize=a.readDWord();var d=a.index+c.subChuckSize;if(c.audioFormat=a.readWord(),c.numberOfChannels=a.readWord(),c.sampleRate=a.readDWord(),c.byteRate=a.readDWord(),c.blockalign=a.readWord(),c.bits=a.readWord(),a.goto(d),c.dataChunk=a.readString(4),c.dataChuckSize=a.readDWord(),8==c.bits){b.length=c.dataChuckSize;for(var e=0;e<b.length;e++){var f=a.readUbyte();f-=127,b.data.push(f/127)}}else h(a,b)}var m={images:{},audio:{},json:{},arrayBuffer:{}},n=void 0,o={image:1,audio:2,json:3,binary:4},p={sampleChange:1,patternChange:2,patternPosChange:3,patternTableChange:4,recordingChange:5,cursorPositionChange:6,trackStateChange:7,playingChange:8,playTypeChange:9,songPositionChange:10,songSpeedChange:11,songBPMChange:12,samplePlay:13,screenRefresh:14,songPropertyChange:15,sampleNameChange:16,command:17,pianoNoteOn:18,pianoNoteOff:19,statusChange:20,diskOperationTargetChange:21,trackCountChange:22,patternHorizontalScrollChange:23,songLoaded:24,songLoading:25},q={newFile:1,openFile:2,saveFile:3,clearTrack:4,clearPattern:5,clearSong:6,clearInstruments:7,showMain:8,showOptions:9,showFileOperations:10,showSampleEditor:11,showAbout:12,showHelp:13,togglePiano:14,showTop:15,showBottom:16,randomSong:17,showGithub:18},r={song:1,pattern:2},s={module:1,sample:2,pattern:3,track:4},t={mod:1,xm:2},u={FULL:1,BALANCED:2,NONE:3},v=7093790,w={column4:4,column5:5,column5Full:6,column6:7},z={C1:{period:856,name:"C-1",tune:[907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814]},Cs1:{period:808,name:"C#1",tune:[856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768]},D1:{period:762,name:"D-1",tune:[808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725]},Ds1:{period:720,name:"D#1",tune:[762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684]},E1:{period:678,name:"E-1",tune:[720,715,709,704,699,694,689,684,678,674,670,665,660,655,651,646]},F1:{period:640,name:"F-1",tune:[678,675,670,665,660,655,651,646,640,637,632,628,623,619,614,610]},Fs1:{period:604,name:"F#1",tune:[640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575]},G1:{period:570,name:"G-1",tune:[604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543]},Gs1:{period:538,name:"G#1",tune:[570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513]},A1:{period:508,name:"A-1",tune:[538,535,532,528,524,520,516,513,508,505,502,498,495,491,487,484]},As1:{period:480,name:"A#1",tune:[508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457]},B1:{period:453,name:"B-1",tune:[480,477,474,470,467,463,460,457,453,450,447,444,441,437,434,431]},C2:{period:428,name:"C-2",tune:[453,450,447,444,441,437,434,431,428,425,422,419,416,413,410,407]},Cs2:{period:404,name:"C#2",tune:[428,425,422,419,416,413,410,407,404,401,398,395,392,390,387,384]},D2:{period:381,name:"D-2",tune:[404,401,398,395,392,390,387,384,381,379,376,373,370,368,365,363]},Ds2:{period:360,name:"D#2",tune:[381,379,376,373,370,368,365,363,360,357,355,352,350,347,345,342]},E2:{period:339,name:"E-2",tune:[360,357,355,352,350,347,345,342,339,337,335,332,330,328,325,323]},F2:{period:320,name:"F-2",tune:[339,337,335,332,330,328,325,323,320,318,316,314,312,309,307,305]},Fs2:{period:302,name:"F#2",tune:[320,318,316,314,312,309,307,305,302,300,298,296,294,292,290,288]},G2:{period:285,name:"G-2",tune:[302,300,298,296,294,292,290,288,285,284,282,280,278,276,274,272]},Gs2:{period:269,name:"G#2",tune:[285,284,282,280,278,276,274,272,269,268,266,264,262,260,258,256]},A2:{period:254,name:"A-2",tune:[269,268,266,264,262,260,258,256,254,253,251,249,247,245,244,242]},As2:{period:240,name:"A#2",tune:[254,253,251,249,247,245,244,242,240,239,237,235,233,232,230,228]},B2:{period:226,name:"B-2",tune:[240,238,237,235,233,232,230,228,226,225,224,222,220,219,217,216]},C3:{period:214,name:"C-3",tune:[226,225,223,222,220,219,217,216,214,213,211,209,208,206,205,204]},Cs3:{period:202,name:"C#3",tune:[214,212,211,209,208,206,205,203,202,201,199,198,196,195,193,192]},D3:{period:190,name:"D-3",tune:[202,200,199,198,196,195,193,192,190,189,188,187,185,184,183,181]},Ds3:{period:180,name:"D#3",tune:[190,189,188,187,185,184,183,181,180,179,177,176,175,174,172,171]},E3:{period:170,name:"E-3",tune:[180,179,177,176,175,174,172,171,170,169,167,166,165,164,163,161]},F3:{period:160,name:"F-3",tune:[170,169,167,166,165,164,163,161,160,159,158,157,156,155,154,152]},Fs3:{period:151,name:"F#3",tune:[160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144]},G3:{period:143,name:"G-3",tune:[151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136]},Gs3:{period:135,name:"G#3",tune:[143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128]},A3:{period:127,name:"A-3",tune:[135,134,133,132,131,130,129,128,127,126,125,125,124,123,122,121]},As3:{period:120,name:"A#3",tune:[127,126,125,125,123,123,122,121,120,119,118,118,117,116,115,114]},B3:{period:113,name:"B-3",tune:[120,119,118,118,117,116,115,114,113,113,112,111,110,109,109,108]}},A={None:{name:"---"},C0:{name:"C-0",period:6848},Cs0:{name:"C#0",period:6464},D0:{name:"D-0",period:6096},Ds0:{name:"D#0",period:5760},E0:{name:"E-0",period:5424},F0:{name:"F-0",period:5120},Fs0:{name:"F#0",period:4832},G0:{name:"G-0",period:4560},Gs0:{name:"G#0",period:4304},A0:{name:"A-0",period:4064},As0:{name:"A#0",period:3840},B0:{name:"A-0",period:3628},C1:{name:"C-1",period:3424},Cs1:{name:"C#1",period:3232},D1:{name:"D-1",period:3048},Ds1:{name:"D#1",period:2880},E1:{name:"E-1",period:2712},F1:{name:"F-1",period:2560},Fs1:{name:"F#1",period:2416},G1:{name:"G-1",period:2280},Gs1:{name:"G#1",period:2152},A1:{name:"A-1",period:2032},As1:{name:"A#1",period:1920},B1:{name:"A-1",period:1814},C2:{name:"C-2",period:1712},Cs2:{name:"C#2",period:1616},D2:{name:"D-2",period:1524},Ds2:{name:"D#2",period:1440},E2:{name:"E-2",period:1356},F2:{name:"F-2",period:1280},Fs2:{name:"F#2",period:1208},G2:{name:"G-2",period:1140},Gs2:{name:"G#2",period:1076},A2:{name:"A-2",period:1016},As2:{name:"A#2",period:960},B2:{name:"A-2",period:907},C3:{name:"C-3",period:856},Cs3:{name:"C#3",period:808},D3:{name:"D-3",period:762},Ds3:{name:"D#3",period:720},E3:{name:"E-3",period:678},F3:{name:"F-3",period:640},Fs3:{name:"F#3",period:604},G3:{name:"G-3",period:570},Gs3:{name:"G#3",period:538},A3:{name:"A-3",period:508},As3:{name:"A#3",period:480},B3:{name:"A-3",period:453},C4:{name:"C-4",period:428},Cs4:{name:"C#4",period:404},D4:{name:"D-4",period:381},Ds4:{name:"D#4",period:360},E4:{name:"E-4",period:339},F4:{name:"F-4",period:320},Fs4:{name:"F#4",period:302},G4:{name:"G-4",period:285},Gs4:{name:"G#4",period:269},A4:{name:"A-4",period:254},As4:{name:"A#4",period:240},B4:{name:"A-4",period:227},C5:{name:"C-5",period:214},Cs5:{name:"C#5",period:202},D5:{name:"D-5",period:190},Ds5:{name:"D#5",period:180},E5:{name:"E-5",period:169},F5:{name:"F-5",period:160},Fs5:{name:"F#5",period:151},G5:{name:"G-5",period:142},Gs5:{name:"G#5",period:134},A5:{name:"A-5",period:127},As5:{name:"A#5",period:120},B5:{name:"A-5",period:113},C6:{name:"C-6",period:107},Cs6:{name:"C#6",period:101},D6:{name:"D-6",period:95},Ds6:{name:"D#6",period:90},E6:{name:"E-6",period:85},F6:{name:"F-6",period:80},Fs6:{name:"F#6",period:75},G6:{name:"G-6",period:71},Gs6:{name:"G#6",period:67},A6:{name:"A-6",period:63},As6:{name:"A#6",period:60},B6:{name:"A-6",period:57},C7:{name:"C-7",period:53},Cs7:{name:"C#7",period:50},D7:{name:"D-7",period:48},Ds7:{name:"D#7",period:45},E7:{name:"E-7",period:42},F7:{name:"F-7",period:40},Fs7:{name:"F#7",period:38},G7:{name:"G-7",period:36},Gs7:{name:"G#7",period:34},A7:{name:"A-7",period:32},As7:{name:"A#7",period:30},B7:{name:"A-7",period:28},OFF:{name:"OFF",period:0}},B={C:{name:"C",octave:0,index:1},Csharp:{name:"Cs",octave:0,index:2},D:{name:"D",octave:0,index:3},Dsharp:{name:"Ds",octave:0,index:4},E:{name:"E",octave:0,index:5},F:{name:"F",octave:0,index:6},Fsharp:{name:"Fs",octave:0,index:7},G:{name:"G",octave:0,index:8},Gsharp:{name:"Gs",octave:0,index:9},A:{name:"A",octave:0,index:10},Asharp:{name:"As",octave:0,index:11},B:{name:"B",octave:0,index:12},COctaveUp:{name:"C",octave:1,index:13},CsharpOctaveUp:{name:"Cs",octave:1,index:14},DOctaveUp:{name:"D",octave:1,index:15},DsharpOctaveUp:{name:"Ds",octave:1,index:16},EOctaveUp:{name:"E",octave:1,index:17},FOctaveUp:{name:"F",octave:1,index:18},FsharpOctaveUp:{name:"Fs",octave:1,index:19},GOctaveUp:{name:"G",octave:1,index:20},GsharpOctaveUp:{name:"Gs",octave:1,index:21},AOctaveUp:{name:"A",octave:1,index:22},AsharpOctaveUp:{name:"As",octave:1,index:23},BOctaveUp:{name:"B",octave:1,index:24},COctaveUp2:{name:"C",octave:2,index:25},CsharpOctaveUp2:{name:"Cs",octave:2,index:26},DOctaveUp2:{name:"D",octave:2,index:27}},C={azerty:{a:B.COctaveUp,z:B.DOctaveUp,e:B.EOctaveUp,r:B.FOctaveUp,t:B.GOctaveUp,y:B.AOctaveUp,u:B.BOctaveUp,i:B.COctaveUp2,o:B.DOctaveUp2,"é":B.CsharpOctaveUp,'"':B.DsharpOctaveUp,"(":B.FsharpOctaveUp,"§":B.GsharpOctaveUp,"è":B.AsharpOctaveUp,"ç":B.CsharpOctaveUp2,w:B.C,x:B.D,c:B.E,v:B.F,b:B.G,n:B.A,",":B.B,";":B.COctaveUp,":":B.DOctaveUp,s:B.Csharp,d:B.Dsharp,g:B.Fsharp,h:B.Gsharp,j:B.Asharp},qwerty:{q:B.COctaveUp,w:B.DOctaveUp,e:B.EOctaveUp,r:B.FOctaveUp,t:B.GOctaveUp,y:B.AOctaveUp,u:B.BOctaveUp,i:B.COctaveUp2,o:B.DOctaveUp2,2:B.CsharpOctaveUp,3:B.DsharpOctaveUp,5:B.FsharpOctaveUp,6:B.GsharpOctaveUp,7:B.AsharpOctaveUp,9:B.CsharpOctaveUp2,z:B.C,x:B.D,c:B.E,v:B.F,b:B.G,n:B.A,m:B.B,",":B.COctaveUp,".":B.DOctaveUp,s:B.Csharp,d:B.Dsharp,g:B.Fsharp,h:B.Gsharp,j:B.Asharp},qwertz:{q:B.COctaveUp,w:B.DOctaveUp,e:B.EOctaveUp,r:B.FOctaveUp,t:B.GOctaveUp,z:B.AOctaveUp,u:B.BOctaveUp,i:B.COctaveUp2,o:B.DOctaveUp2,2:B.CsharpOctaveUp,3:B.DsharpOctaveUp,5:B.FsharpOctaveUp,6:B.GsharpOctaveUp,7:B.AsharpOctaveUp,9:B.CsharpOctaveUp2,y:B.C,x:B.D,c:B.E,v:B.F,b:B.G,n:B.A,m:B.B,",":B.COctaveUp,".":B.DOctaveUp,s:B.Csharp,d:B.Dsharp,g:B.Fsharp,h:B.Gsharp,j:B.Asharp}},D={unrollLoops:!1,unrollShortLoops:!1,sustainKeyboardNotes:!1,useHover:!0,keyboardTable:"qwerty",vubars:!0,stereoSeparation:u.BALANCED,emulateProtracker1OffsetBug:!0},E=function(){var a={},b={};return b.onEvent=function(b,c){var d=a[b];d||(d=[],a[b]=d),d.push(c)},b.sendEvent=function(b,c){var d=a[b];if(d){var e,f=d.length;for(e=0;e<f;e++)d[e](c,b)}},b.trigger=function(a,c){b.sendEvent(a,c)},b.on=function(a,c){b.onEvent(a,c)},b}(),F=function(){function b(a){f=a.createGain(),f.gain.value=1,f.connect(a.destination),e=a.createGain(),e.gain.value=.7,e.connect(f),g=a.createBiquadFilter(),g.type="lowpass",g.frequency.value=2e4,g.connect(e)}var c={};window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var d,e,f,g,h,i,j,k,l=[],m=[],n=u.BALANCED,o={volume:!0,panning:!0,high:!0,mid:!0,low:!0,lowPass:!0,reverb:!0,distortion:!1},q=!1;return AudioContext&&(d=new AudioContext,b(d)),c.init=function(a){function b(){var a=FilterChain(o);a.output().connect(g),l.push(a)}if(a=a||d){var e=U.getTrackCount();for(l=[],h=0;h<e;h++)b();c.filterChains=l,q||E.on(p.trackStateChange,function(a){"undefined"!=typeof a.track&&l[a.track]&&l[a.track].volumeValue(a.mute?0:70)}),E.on(p.trackCountChange,function(a){for(h=l.length;h<a;h++)b();c.setStereoSeparation(n)})}},c.checkState=function(){d&&"suspended"===d.state&&d.resume&&d.resume()},c.enable=function(){f.gain.value=1},c.disable=function(){f.gain.value=0},c.playSample=function(a,b,e,f,g,i,j){var m;q?m=k:(m=d,c.enable()),97==j&&(e=0),b=b||428,f=f||U.getCurrentTrack(),i=i||0;var n=U.getSample(a),o=b;if(n){var r,s=0,t=0,u=0;e="undefined"==typeof e?100*n.volume/64:e,n.finetune&&(b=j?c.getFineTuneForNote(j,n.finetune):c.getFineTuneForPeriod(b,n.finetune));var w=v/(2*b),x=1;n.data.length?(t=n.data.length,u=n.loopStart,g&&g.offset&&(g.offset.value>=t&&(g.offset.value=t-1),s=g.offset.value/m.sampleRate),r=m.createBuffer(1,t,m.sampleRate),x=w/m.sampleRate):(r=m.createBuffer(1,1,w),s=0);var y=r.getChannelData(0);for(h=0;h<t;h++)y[h]=n.data[h];var z=m.createBufferSource();z.buffer=r;var A=m.createGain();A.gain.value=e/100,n.loopRepeatLength>2&&(D.unrollLoops||(z.loop=!0,z.loopStart=u/m.sampleRate,z.loopEnd=(u+n.loopRepeatLength)/m.sampleRate)),z.connect(A),A.connect(l[f].input()),z.playbackRate.value=x;var B=0,C=i+B;z.start(C,s);var F={source:z,volume:A,startVolume:e,currentVolume:e,startPeriod:b,basePeriod:o,startPlaybackRate:x,sampleIndex:a,effects:g,track:f};return q||E.trigger(p.samplePlay,F),F}return{}},c.playSilence=function(){if(d){var a=d.createBufferSource();a.connect(e),a.start()}},c.isRecording=function(){return i},c.startRecording=function(){if(!i&&d&&d.createMediaStreamDestination){var a=d.createMediaStreamDestination();j=new MediaRecorder(a.stream),j.ondataavailable=function(a){m.push(a.data)},j.onstop=function(a){var b=new Blob(m,{type:"audio/ogg; codecs=opus"});G(b,"recording.opus")},e.connect(a),j.start(),i=!0}},c.stopRecording=function(){i&&(i=!1,j.stop())},c.startRendering=function(a){q=!0,k=new OfflineAudioContext(2,44100*a,44100),c.context=k,b(k),c.init(k)},c.stopRendering=function(e){q=!1,k.startRendering().then(function(b){e&&e(a(b))}).catch(function(a){}),c.context=d,b(d),c.init(d)},c.setStereoSeparation=function(a){n=a;var b,c=U.getTrackCount();switch(a){case u.NONE:b=0,D.stereoSeparation=u.NONE;break;case u.FULL:b=1,D.stereoSeparation=u.FULL;break;default:b=.5,D.stereoSeparation=u.BALANCED}for(h=0;h<c;h++){var d=l[h];d&&d.panningValue(h%2==0?-b:b)}},c.masterVolume=e,c.cutOffVolume=f,c.lowPassfilter=g,c.context=d,c.getSemiToneFrom=function(a,b,d){var e=a;if(d&&(a=c.getFineTuneBasePeriod(a,d),a||(a=e)),b){var f=O[a];if(f){var g=R.indexOf(f.name),h=R[g+b];if(h){var i=Q[h];i&&(e=i.period,d&&(e=c.getFineTuneForPeriod(e,d)))}}}return e},c.getNearestSemiTone=function(a,b){var c=8;if(b){var d=U.getSample(b);d&&d.finetune&&(c+=d.finetune)}var e=1e5,f=a;for(var g in z)if(z.hasOwnProperty(g)){var h=z[g].tune[c],i=Math.abs(h-a);i<e&&(e=i,f=h)}return f},c.getFineTuneForPeriod=function(a,b){var c=a,d=O[a];if(d&&d.tune){var e=8+b;e>=0&&e<d.tune.length&&(c=d.tune[e])}return c},c.getFineTuneForNote=function(a,b){var c=S[a],d=b>0?S[a+1]:S[a-1];if(c&&d){var e=(d.period-c.period)/127;return c.period+e*b}return c.period||0},c.getFineTuneBasePeriod=function(a,b){var c=a,d=P[b];return d&&(c=d[a]),c},c.limitAmigaPeriod=function(a){return a=Math.max(a,113),a=Math.min(a,856)},c.setAmigaLowPassFilter=function(a,b){var c=a?2e3:2e4;g.frequency.setValueAtTime(c,b)},c.waveFormFunction={sine:function(a,b,c,d){return a+Math.sin(b*c)*d*2},saw:function(a,b,c,d){var e=b*c/7%1;return e=2*e-1,e=e*d*-2,a+e},square:function(a,b,c,d){var e=Math.sin(b*c)<=0?-1:1;return e=e*d*2,a+e}},c}();!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a[a.__dropbox_export||"dropboxService"]=b()}(this,function(){"use strict";function a(a,b){return"[object Function]"==e.call(a)}function b(a,b){return"[object String]"==e.call(a)}function c(a,b){return"[object Object]"==e.call(a)}function d(){return window.location.hash.replace(/^#/,"").split("&").reduce(function(a,b){return""==b?a:(b=b.split("="),a[decodeURIComponent(b[0])]=decodeURIComponent(b[1]),a)},{})}var e={}.toString,f="https://api.dropboxapi.com/2/",g="https://content.dropboxapi.com/2/",h=function(a,b){return arguments.length>1?localStorage[a]=b:localStorage[a]},i=void 0,j={"auth/token/revoke":{contentType:null},"users/get_current_account":{contentType:"application/json"},"files/upload":{baseUri:g,format:"content-upload"},"files/get_thumbnail":{baseUri:g,format:"content-download"},"files/download":{baseUri:g,format:"content-download"},"files/get_preview":{baseUri:g,format:"content-download"},"files/upload_session/append":{baseUri:g,format:"content-upload"},"files/upload_session/append_v2":{baseUri:g,format:"content-upload"},"files/upload_session/finish":{baseUri:g,format:"content-upload"},"files/upload_session/start":{baseUri:g,format:"content-upload"},"files/get_shared_link_file":{baseUri:g,format:"content-download"}},k={rpc:"application/json","content-upload":"application/octet-stream"},l=function(b,d){var e=[].slice.call(arguments),g=j[b]||{},l=g.baseUri||f,m=g.format||"rpc",n=g.contentType||null===g.contentType?null:k[m],o=e[e.length-1],p=e.length>2&&(c(o)||a(o))?o:{};a(p)&&(p={onComplete:p});var q,r={};Promise&&(q=new Promise(function(a,b){r.resolve=a,r.reject=b}));var s=new XMLHttpRequest;s.open("POST",l+b,!0),s.setRequestHeader("Authorization","Bearer "+(h("__dbat")||"000000000000000000000000_00000-000000000000000000000000000000000")),"content-download"==m&&(s.responseType="blob"),d&&d.responseType&&(s.responseType=d.responseType,delete d.responseType),n&&s.setRequestHeader("Content-Type",n),!d||"content-upload"!=m&&"content-download"!=m||s.setRequestHeader("Dropbox-API-Arg",JSON.stringify(d)),p.onDownloadProgress&&s.addEventListener("progress",p.onDownloadProgress),p.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",p.onUploadProgress),(p.onError||i)&&s.addEventListener("error",function(a){var b=p.onError&&p.onError(a.target);q&&r.reject&&r.reject(a.target),i&&i(a.target,b)}),s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status){var a=JSON.parse(s.getResponseHeader("dropbox-api-result")||s.responseText);"auth/token/revoke"==b&&h("__dbat",""),p.onComplete&&p.onComplete(a,s.response,s),q&&r.resolve&&r.resolve(a,s.response,s)}else{var c=p.onError&&p.onError(s);q&&r.reject&&r.reject(s),i&&i(s,c)}};var t=e.length>2&&"content-upload"==m?e[2]:void 0;return t=t||(d&&"rpc"==m?JSON.stringify(d):null),t?s.send(t):s.send(),q};return l.setGlobalErrorHandler=function(a){i=a},l.setTokenStore=function(a){h=a},l.authenticate=function(c,e){e=e||{},a(e)&&(e={onComplete:e}),c=c||{},b(c)&&(c={client_id:c}),c.redirect_uri=c.redirect_uri||window.location.href;var f,g={};if(Promise&&(f=new Promise(function(a,b){g.resolve=a,g.reject=b})),h("__dbat"))return e.onComplete(),f&&f.resolve&&f.resolve(),f;var j=d(),k=h("__dbcsrf");if(j.state&&k&&j.state==k)if(j.access_token)h("__dbat",j.access_token),h("__dbcsrf",""),window.location.replace(window.location.href.replace(/#.*/,""));else{var l=e.onError&&e.onError(j);f&&f.reject&&f.reject(j),i&&i(j,l)}else k=""+Math.floor(1e5*Math.random()),h("__dbcsrf",k),window.location="https://www.dropbox.com/1/oauth2/authorize?response_type=token&client_id="+encodeURIComponent(c.client_id)+"&redirect_uri="+encodeURIComponent(c.redirect_uri)+"&state="+encodeURIComponent(k);return f},l.getAccessToken=function(){return h("__dbat")},l.clearAccessToken=function(){return h("__dbat","")},l});var G=G||function(a){"use strict";if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{var e=a.open(o,"_blank");e||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};return p.readyState=p.INIT,e?(o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=G:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return G}),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){"use strict";var c=b.AudioContext||b.webkitAudioContext,d=a("stereo-panner-node");c&&!c.prototype.createStereoPanner&&(c.prototype.createStereoPanner=function(){return new d(this)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"stereo-panner-node":4}],2:[function(a,b,c){"use strict";var d=4096,e=new Float32Array(d),f=new Float32Array(d);!function(){for(var a=0;a<d;a++)e[a]=Math.cos(a/d*Math.PI*.5),f[a]=Math.sin(a/d*Math.PI*.5)}(),b.exports={L:e,R:f}},{}],3:[function(a,b,c){(function(c){"use strict";function d(a){this.audioContext=a,this.inlet=a.createChannelSplitter(2),this._pan=a.createGain(),this.pan=this._pan.gain,this._wsL=a.createWaveShaper(),this._wsR=a.createWaveShaper(),this._L=a.createGain(),this._R=a.createGain(),this.outlet=a.createChannelMerger(2),this.inlet.channelCount=2,this.inlet.channelCountMode="explicit",this._pan.gain.value=0,this._wsL.curve=e.L,this._wsR.curve=e.R,this._L.gain.value=0,this._R.gain.value=0,this.inlet.connect(this._L,0),this.inlet.connect(this._R,1),this._L.connect(this.outlet,0,0),this._R.connect(this.outlet,0,1),this._pan.connect(this._wsL),this._pan.connect(this._wsR),this._wsL.connect(this._L.gain),this._wsR.connect(this._R.gain),this._isConnected=!1,this._dc1buffer=null,this._dc1=null}var e=a("./curve");d.prototype.connect=function(a){var b=this.audioContext;this._isConnected||(this._isConnected=!0,this._dc1buffer=b.createBuffer(1,2,b.sampleRate),this._dc1buffer.getChannelData(0).set([1,1]),this._dc1=b.createBufferSource(),this._dc1.buffer=this._dc1buffer,this._dc1.loop=!0,this._dc1.start(b.currentTime),this._dc1.connect(this._pan)),c.AudioNode.prototype.connect.call(this.outlet,a)},d.prototype.disconnect=function(){var a=this.audioContext;this._isConnected&&(this._isConnected=!1,this._dc1.stop(a.currentTime),this._dc1.disconnect(),this._dc1=null,this._dc1buffer=null),c.AudioNode.prototype.disconnect.call(this.outlet)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./curve":2}],4:[function(a,b,c){"use strict";function d(a){var b=new e(a);return Object.defineProperties(b.inlet,{pan:{value:b.pan,enumerable:!0},connect:{value:function(a){return b.connect(a)}},disconnect:{value:function(){return b.disconnect()}}}),b.inlet}var e=a("./stereo-panner-impl");b.exports=d},{"./stereo-panner-impl":3}]},{},[1]),function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){var d=a("./lib/WAAClock");b.exports=d,"undefined"!=typeof window&&(window.WAAClock=d)},{"./lib/WAAClock":2}],3:[function(a,b,c){var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b,c){var d=a("__browserify_process"),e="undefined"!=typeof window;if(e&&!AudioContext)throw new Error("This browser doesn't seem to support web audio API");var f={toleranceLate:.1,toleranceEarly:.001},g=function(a,b,c){this.clock=a,this.func=c,this.repeatTime=null,this.toleranceLate=f.toleranceLate,this.toleranceEarly=f.toleranceEarly,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(b)};g.prototype.clear=function(){return this.clock._removeEvent(this),this},g.prototype.repeat=function(a){if(0===a)throw new Error("delay cannot be 0");return this.repeatTime=a,this},g.prototype.tolerance=function(a){return"number"==typeof a.late&&(this.toleranceLate=a.late),"number"==typeof a.early&&(this.toleranceEarly=a.early),this._update(),this},g.prototype.isRepeated=function(){return null!==this.repeatTime},g.prototype.schedule=function(a){this._armed=!0,this.deadline=a,this._update(),this.clock.context.currentTime>=this._earliestTime&&(this.clock._removeEvent(this),this._execute())},g.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):this.onexpired&&this.onexpired(this),this._armed===!1&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},g.prototype._update=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly,this.clock._removeEvent(this),this.clock._insertEvent(this)};var h=b.exports=function(a,b){b=b||{},this.toleranceEarly=b.toleranceEarly||f.toleranceEarly,this.toleranceLate=b.toleranceLate||f.toleranceLate,this.context=a,this._events=[],this._started=!1};h.prototype.setTimeout=function(a,b){return this._createEvent(a,this._absTime(b))},h.prototype.callbackAtTime=function(a,b){return this._createEvent(a,b)},h.prototype.timeStretch=function(a,b,c){var d=this,e=d.context.currentTime;return b.forEach(function(b){b.isRepeated()&&b.repeat(b.repeatTime*c);var d=a+c*(b.deadline-a);if(b.isRepeated())for(;e>=d-b.toleranceEarly;)d+=b.repeatTime;b.schedule(d)}),b},h.prototype.start=function(){if(this._started===!1){var a=this;this._started=!0,this._events=[];var b=256;this._clockNode=this.context.createScriptProcessor(b,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){d.nextTick(function(){a._tick()})}}},h.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())},h.prototype._tick=function(){for(var a=this._events.shift();a&&a._earliestTime<=this.context.currentTime;)a._execute(),a=this._events.shift();a&&this._events.unshift(a)},h.prototype._createEvent=function(a,b){var c=new g(this,b,a);return c.tolerance({
late:this.toleranceLate,early:this.toleranceEarly}),c},h.prototype._insertEvent=function(a){this._events.splice(this._indexByTime(a._earliestTime),0,a)},h.prototype._removeEvent=function(a){var b=this._events.indexOf(a);b!==-1&&this._events.splice(b,1)},h.prototype._indexByTime=function(a){for(var b,c=0,d=this._events.length;c<d;)b=Math.floor((c+d)/2),this._events[b]._earliestTime<a?c=b+1:d=b;return c},h.prototype._absTime=function(a){return a+this.context.currentTime},h.prototype._relTime=function(a){return a-this.context.currentTime}},{__browserify_process:3}]},{},[1]),function(a){"use strict";function b(){this.crc=-1}function c(){}function d(a,b,c){if(b<0||c<0||b+c>a.size)throw new RangeError("offset:"+b+", length:"+c+", size:"+a.size);return a.slice?a.slice(b,b+c):a.webkitSlice?a.webkitSlice(b,b+c):a.mozSlice?a.mozSlice(b,b+c):a.msSlice?a.msSlice(b,b+c):void 0}function e(a,b){var c,d;return c=new ArrayBuffer(a),d=new Uint8Array(c),b&&d.set(b,0),{buffer:c,array:d,view:new DataView(c)}}function f(){}function g(a){function b(b,c){var f=new Blob([a],{type:R});d=new i(f),d.init(function(){e.size=d.size,b()},c)}function c(a,b,c,e){d.readUint8Array(a,b,c,e)}var d,e=this;e.size=0,e.init=b,e.readUint8Array=c}function h(b){function c(a){for(var c=b.length;"="==b.charAt(c-1);)c--;f=b.indexOf(",")+1,g.size=Math.floor(.75*(c-f)),a()}function d(c,d,g){var h,i=e(d),j=4*Math.floor(c/3),k=4*Math.ceil((c+d)/3),l=a.atob(b.substring(j+f,k+f)),m=c-3*Math.floor(j/4);for(h=m;h<m+d;h++)i.array[h-m]=l.charCodeAt(h);g(i.array)}var f,g=this;g.size=0,g.init=c,g.readUint8Array=d}function i(a){function b(b){e.size=a.size,b()}function c(b,c,e,f){var g=new FileReader;g.onload=function(a){e(new Uint8Array(a.target.result))},g.onerror=f;try{g.readAsArrayBuffer(d(a,b,c))}catch(a){f(a)}}var e=this;e.size=0,e.init=b,e.readUint8Array=c}function j(a){function b(b,c){d.size=a.byteLength,b()}function c(b,c,d,e){d(new Uint8Array(a.slice(b,b+c)))}var d=this;d.size=0,d.init=b,d.readUint8Array=c}function k(){}function l(a){function b(a){e=new Blob([],{type:R}),a()}function c(a,b){e=new Blob([e,G?a:a.buffer],{type:R}),b()}function d(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=c,d.readAsText(e,a)}var e,f=this;f.init=b,f.writeUint8Array=c,f.getData=d}function m(b){function c(a){g+="data:"+(b||"")+";base64,",a()}function d(b,c){var d,e=h.length,f=h;for(h="",d=0;d<3*Math.floor((e+b.length)/3)-e;d++)f+=String.fromCharCode(b[d]);for(;d<b.length;d++)h+=String.fromCharCode(b[d]);f.length>2?g+=a.btoa(f):h=f,c()}function e(b){b(g+a.btoa(h))}var f=this,g="",h="";f.init=c,f.writeUint8Array=d,f.getData=e}function n(a){function b(b){e=new Blob([],{type:a}),b()}function c(b,c){e=new Blob([e,G?b:b.buffer],{type:a}),c()}function d(a){a(e)}var e,f=this;f.init=b,f.writeUint8Array=c,f.getData=d}function o(){function a(a,b){d=new Uint8Array,a()}function b(a,b,c){var e=new Uint8Array(d.length+a.length);e.set(d),e.set(a,d.length),d=e,b()}function c(a){a(d.buffer)}var d,e=this;e.init=a,e.writeUint8Array=b,e.getData=c}function p(a,b,c,d,e,f,g,h,i,j){function k(){a.removeEventListener("message",l,!1),h(o,p)}function l(b){var c=b.data,e=c.data,h=c.error;if(h)return h.toString=function(){return"Error: "+this.message},void i(h);if(c.sn===r)switch("number"==typeof c.codecTime&&(a.codecTime+=c.codecTime),"number"==typeof c.crcTime&&(a.crcTime+=c.crcTime),c.type){case"append":e?(o+=e.length,d.writeUint8Array(e,function(){m()},j)):m();break;case"flush":p=c.crc,e?(o+=e.length,d.writeUint8Array(e,function(){k()},j)):k();break;case"progress":g&&g(n+c.loaded,f);break;case"importScripts":case"newTask":case"echo":}}function m(){n=q*Q,n<=f?c.readUint8Array(e+n,Math.min(Q,f-n),function(c){g&&g(n,f);var d=0===n?b:{sn:r};d.type="append",d.data=c;try{a.postMessage(d,[c.buffer])}catch(b){a.postMessage(d)}q++},i):a.postMessage({sn:r,type:"flush"})}var n,o,p,q=0,r=b.sn;o=0,a.addEventListener("message",l,!1),m()}function q(a,c,d,e,f,g,h,i,j,k){function l(){var b;if(m=n*Q,m<f)c.readUint8Array(e+m,Math.min(Q,f-m),function(b){var c;try{c=a.append(b,function(a){h&&h(m+a,f)})}catch(a){return void j(a)}c?(o+=c.length,d.writeUint8Array(c,function(){n++,setTimeout(l,1)},k),q&&r.append(c)):(n++,setTimeout(l,1)),p&&r.append(b),h&&h(m,f)},j);else{try{b=a.flush()}catch(a){return void j(a)}b?(q&&r.append(b),o+=b.length,d.writeUint8Array(b,function(){i(o,r.get())},k)):i(o,r.get())}}var m,n=0,o=0,p="input"===g,q="output"===g,r=new b;l()}function r(b,c,d,e,f,g,h,i,j,k,l){var m=h?"output":"none";if(a.zip.useWebWorkers){var n={sn:c,codecClass:"Inflater",crcType:m};p(b,n,d,e,f,g,j,i,k,l)}else q(new a.zip.Inflater,d,e,f,g,m,j,i,k,l)}function s(b,c,d,e,f,g,h,i,j){var k="input";if(a.zip.useWebWorkers){var l={sn:c,options:{level:f},codecClass:"Deflater",crcType:k};p(b,l,d,e,0,d.size,h,g,i,j)}else q(new a.zip.Deflater,d,e,0,d.size,k,h,g,i,j)}function t(b,d,e,f,g,h,i,j,k,l,m){var n="input";if(a.zip.useWebWorkers&&i){var o={sn:d,codecClass:"NOOP",crcType:n};p(b,o,e,f,g,h,k,j,l,m)}else q(new c,e,f,g,h,n,k,j,l,m)}function u(a){var b,c,d="",e=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(b=0;b<a.length;b++)c=255&a.charCodeAt(b),d+=c>127?e[c-128]:String.fromCharCode(c);return d}function v(a){return decodeURIComponent(escape(a))}function w(a){var b,c="";for(b=0;b<a.length;b++)c+=String.fromCharCode(a[b]);return c}function x(a){var b=(4294901760&a)>>16,c=65535&a;try{return new Date(1980+((65024&b)>>9),((480&b)>>5)-1,31&b,(63488&c)>>11,(2016&c)>>5,2*(31&c),0)}catch(a){}}function y(a,b,c,d,e){return a.version=b.view.getUint16(c,!0),a.bitFlag=b.view.getUint16(c+2,!0),a.compressionMethod=b.view.getUint16(c+4,!0),a.lastModDateRaw=b.view.getUint32(c+6,!0),a.lastModDate=x(a.lastModDateRaw),1===(1&a.bitFlag)?void e(J):((d||8!=(8&a.bitFlag))&&(a.crc32=b.view.getUint32(c+10,!0),a.compressedSize=b.view.getUint32(c+14,!0),a.uncompressedSize=b.view.getUint32(c+18,!0)),4294967295===a.compressedSize||4294967295===a.uncompressedSize?void e(K):(a.filenameLength=b.view.getUint16(c+22,!0),void(a.extraFieldLength=b.view.getUint16(c+24,!0))))}function z(b,c,d){function f(){}function g(a){function c(c,f){b.readUint8Array(b.size-c,c,function(b){for(var c=b.length-e;c>=0;c--)if(80===b[c]&&75===b[c+1]&&5===b[c+2]&&6===b[c+3])return void a(new DataView(b.buffer,c,e));f()},function(){d(L)})}var e=22;if(b.size<e)return void d(H);var f=65536,g=e+f;c(e,function(){c(Math.min(g,b.size),function(){d(H)})})}var h=0;f.prototype.getData=function(a,c,f,g){function i(a){var b=e(4);return b.view.setUint32(0,a),m.crc32==b.view.getUint32(0)}function j(b,e){g&&!i(e)?d(I):a.getData(function(a){c(a)})}function k(a){d(a||O)}function l(a){d(a||N)}var m=this;b.readUint8Array(m.offset,30,function(c){var i,n=e(c.length,c);return 1347093252!=n.view.getUint32(0)?void d(H):(y(m,n,4,!1,d),i=m.offset+30+m.filenameLength+m.extraFieldLength,void a.init(function(){0===m.compressionMethod?t(m._worker,h++,b,a,i,m.compressedSize,g,j,f,k,l):r(m._worker,h++,b,a,i,m.compressedSize,g,j,f,k,l)},l))},k)};var i={getEntries:function(a){var c=this._worker;g(function(g){var h,i;return h=g.getUint32(16,!0),i=g.getUint16(8,!0),h<0||h>=b.size?void d(H):void b.readUint8Array(h,b.size-h,function(b){var g,h,j,k,l=0,m=[],n=e(b.length,b);for(g=0;g<i;g++){if(h=new f,h._worker=c,1347092738!=n.view.getUint32(l))return void d(H);y(h,n,l+6,!0,d),h.commentLength=n.view.getUint16(l+32,!0),h.directory=16==(16&n.view.getUint8(l+38)),h.offset=n.view.getUint32(l+42,!0),j=w(n.array.subarray(l+46,l+46+h.filenameLength)),h.filename=2048===(2048&h.bitFlag)?v(j):u(j),h.directory||"/"!=h.filename.charAt(h.filename.length-1)||(h.directory=!0),k=w(n.array.subarray(l+46+h.filenameLength+h.extraFieldLength,l+46+h.filenameLength+h.extraFieldLength+h.commentLength)),h.comment=2048===(2048&h.bitFlag)?v(k):u(k),m.push(h),l+=46+h.filenameLength+h.extraFieldLength+h.commentLength}a(m)},function(){d(L)})})},close:function(a){this._worker&&(this._worker.terminate(),this._worker=null),a&&a()},_worker:null};a.zip.useWebWorkers?E("inflater",function(a){i._worker=a,c(i)},function(a){d(a)}):c(i)}function A(a){return unescape(encodeURIComponent(a))}function B(a){var b,c=[];for(b=0;b<a.length;b++)c.push(a.charCodeAt(b));return c}function C(b,c,d,f){function g(a){d(a||M)}function h(a){d(a||O)}var i={},j=[],k=0,l=0,m={add:function(a,c,m,n,o){function p(c){var d;w=o.lastModDate||new Date,u=e(26),i[a]={headerArray:u.array,directory:o.directory,filename:v,offset:k,comment:B(A(o.comment||""))},u.view.setUint32(0,335546376),o.version&&u.view.setUint8(0,o.version),f||0===o.level||o.directory||u.view.setUint16(4,2048),u.view.setUint16(6,(w.getHours()<<6|w.getMinutes())<<5|w.getSeconds()/2,!0),u.view.setUint16(8,(w.getFullYear()-1980<<4|w.getMonth()+1)<<5|w.getDate(),!0),u.view.setUint16(22,v.length,!0),d=e(30+v.length),d.view.setUint32(0,1347093252),d.array.set(u.array,4),d.array.set(v,30),k+=d.array.length,b.writeUint8Array(d.array,c,g)}function q(a,d){var f=e(16);k+=a||0,f.view.setUint32(0,1347094280),"undefined"!=typeof d&&(u.view.setUint32(10,d,!0),f.view.setUint32(4,d,!0)),c&&(f.view.setUint32(8,a,!0),u.view.setUint32(14,a,!0),f.view.setUint32(12,c.size,!0),u.view.setUint32(18,c.size,!0)),b.writeUint8Array(f.array,function(){k+=16,m()},g)}function r(){return o=o||{},a=a.trim(),o.directory&&"/"!=a.charAt(a.length-1)&&(a+="/"),i.hasOwnProperty(a)?void d(P):(v=B(A(a)),j.push(a),void p(function(){c?f||0===o.level?t(x,l++,c,b,0,c.size,!0,q,n,h,g):s(x,l++,c,b,o.level,q,n,h,g):q()},g))}var u,v,w,x=this._worker;c?c.init(r,h):r()},close:function(a){this._worker&&(this._worker.terminate(),this._worker=null);var c,d,f,h=0,l=0;for(d=0;d<j.length;d++)f=i[j[d]],h+=46+f.filename.length+f.comment.length;for(c=e(h+22),d=0;d<j.length;d++)f=i[j[d]],c.view.setUint32(l,1347092738),c.view.setUint16(l+4,5120),c.array.set(f.headerArray,l+6),c.view.setUint16(l+32,f.comment.length,!0),f.directory&&c.view.setUint8(l+38,16),c.view.setUint32(l+42,f.offset,!0),c.array.set(f.filename,l+46),c.array.set(f.comment,l+46+f.filename.length),l+=46+f.filename.length+f.comment.length;c.view.setUint32(l,1347093766),c.view.setUint16(l+8,j.length,!0),c.view.setUint16(l+10,j.length,!0),c.view.setUint32(l+12,h,!0),c.view.setUint32(l+16,k,!0),b.writeUint8Array(c.array,function(){b.getData(a)},g)},_worker:null};a.zip.useWebWorkers?E("deflater",function(a){m._worker=a,c(m)},function(a){d(a)}):c(m)}function D(a){var b=document.createElement("a");return a.map(function(a){return b.href=a})}function E(b,c,d){function e(a){var b=a.data;return b.error?(h.terminate(),void d(b.error)):void("importScripts"===b.type&&(h.removeEventListener("message",e),h.removeEventListener("error",f),c(h)))}function f(a){h.terminate(),d(a)}if(null!==a.zip.workerScripts&&null!==a.zip.workerScriptsPath)return void d(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));var g;if(a.zip.workerScripts){if(g=a.zip.workerScripts[b],!Array.isArray(g))return void d(new Error("zip.workerScripts."+b+" is not an array!"));g=D(g)}else g=S[b].slice(0),g[0]=(a.zip.workerScriptsPath||"")+g[0];var h=new Worker(g[0]);h.codecTime=h.crcTime=0,h.postMessage({type:"importScripts",scripts:g.slice(1)}),h.addEventListener("message",e),h.addEventListener("error",f)}function F(a){}var G,H="File format is not recognized.",I="CRC failed.",J="File contains encrypted entry.",K="File is using Zip64 (4gb+ file size).",L="Error while reading zip file.",M="Error while writing zip file.",N="Error while writing file data.",O="Error while reading file data.",P="File already exists.",Q=524288,R="text/plain";try{G=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(a){}b.prototype.append=function(a){for(var b=0|this.crc,c=this.table,d=0,e=0|a.length;d<e;d++)b=b>>>8^c[255&(b^a[d])];this.crc=b},b.prototype.get=function(){return~this.crc},b.prototype.table=function(){var a,b,c,d=[];for(a=0;a<256;a++){for(c=a,b=0;b<8;b++)1&c?c=c>>>1^3988292384:c>>>=1;d[a]=c}return d}(),c.prototype.append=function(a,b){return a},c.prototype.flush=function(){},g.prototype=new f,g.prototype.constructor=g,h.prototype=new f,h.prototype.constructor=h,i.prototype=new f,i.prototype.constructor=i,j.prototype=new f,j.prototype.constructor=j,k.prototype.getData=function(a){a(this.data)},l.prototype=new k,l.prototype.constructor=l,m.prototype=new k,m.prototype.constructor=m,n.prototype=new k,n.prototype.constructor=n,o.prototype=new k,o.prototype.constructor=o;var S={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};a.zip={Reader:f,Writer:k,BlobReader:i,ArrayBufferReader:j,Data64URIReader:h,TextReader:g,BlobWriter:n,ArrayBufferWriter:o,Data64URIWriter:m,TextWriter:l,createReader:function(a,b,c){c=c||F,a.init(function(){z(a,b,c)},c)},createWriter:function(a,b,c,d){c=c||F,d=!!d,a.init(function(){C(a,b,c,d)},c)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this);var H=function(){var a={};return a.init=function(){E.on(p.command,function(a){switch(a){case q.newFile:U.new();break;case q.openFile:n.mainPanel.setView("diskop_load");break;case q.saveFile:n.mainPanel.setView("diskop_save");break;case q.clearTrack:U.clearTrack();break;case q.clearPattern:U.clearPattern();break;case q.clearInstruments:U.clearInstruments();break;case q.showMain:n.mainPanel.setView("main");break;case q.showTop:n.mainPanel.setView("resetTop");break;case q.showOptions:n.mainPanel.setView("options"==n.mainPanel.getCurrentView()?"resetTop":"options");break;case q.showFileOperations:n.mainPanel.setView("diskop_load"==n.mainPanel.getCurrentView()?"main":"diskop_load");break;case q.showSampleEditor:n.mainPanel.setView("sample"==n.mainPanel.getCurrentView()?"resetBottom":"sample");break;case q.togglePiano:n.mainPanel.togglePiano();break;case q.showAbout:var b=n.modalDialog();b.setProperties({width:n.mainPanel.width,height:n.mainPanel.height,top:0,left:0,ok:!0}),b.onClick=b.close;var c="undefined"==typeof versionNumber?"dev":versionNumber;"undefined"==typeof buildNumber?(new Date).getTime():buildNumber;b.setText("Bassoontracker//Old School 4-channel Amiga mod tracker/in plain javascript//©2017 by Steffest//version "+c+"//Fork me on Github!"),n.setModalElement(b);break;case q.showHelp:window.open("https://www.stef.be/bassoontracker/docs/");break;case q.randomSong:n.diskOperations.playRandomSong();break;case q.showGithub:window.open("https://github.com/steffest/bassoontracker")}})},a.doCommand=function(a){E.trigger(p.command,a)},a}(),I=function(){var a={},b=3e4;return a.get=function(b,c){a.ajax({url:b,success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.json=function(b,c){"undefined"==typeof c&&(c=function(){}),a.ajax({url:b,cache:!1,datatype:"json",headers:[{key:"Accept",value:"application/json"}],success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.html=function(b,c){a.ajax({url:b,cache:!1,datatype:"html",success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.ajax=function(a){var c=new XMLHttpRequest;a.error=a.error||function(){a.success(!1)},"jsonp"===a.datatype&&a.error(c);var d=a.url;if("boolean"==typeof a.cache&&!a.cache){var e=(new Date).getTime();d+=d.indexOf("?")>0?"&r="+e:"?r="+e}var f=a.method||"GET";c.onreadystatechange=function(){if(!(c.readyState<4)&&4===c.readyState)if(200!==c.status&&201!==c.status)a.error(c);else{var b=c.responseText;"json"===a.datatype&&(b=JSON.parse(b)),"html"===a.datatype&&(b=document.createElement("div"),b.innerHTML=c.responseText),a.success(b)}},c.ontimeout=function(a){},c.open(f,d,!0),c.timeout=a.timeout||b,a.headers&&a.headers.forEach(function(a){c.setRequestHeader(a.key,a.value)});var g=a.data||"";"POST"==f&&a.data&&c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(g)},a}();document.addEventListener("DOMContentLoaded",function(){U.init(),F.init(),n.init(function(){if(F.context)M.readSettings(),H.init();else{var a=n.modalDialog();a.setProperties({width:n.mainPanel.width,height:n.mainPanel.height,top:0,left:0,ok:!0}),a.onTouchDown=function(){window.location.href="https://www.google.com/chrome/"},a.setText("Sorry//Your browser does not support WebAudio//Supported browsers are/Chrome,Firefox,Safari and Edge"),n.setModalElement(a)}})});var J,K,L=function(){var a={};a.load=function(c,d,e){a.type=d||o.image,a.loadCount=0,a.max=c.length,a.next=e;for(var f=0,g=c.length;f<g;f++)b(c[f])};var b=function(b){if(a.type==o.image){var c=new Image;c.onload=function(){m.images[b]=this,++a.loadCount==a.max&&a.next&&a.next()},c.onerror=function(){alert("BufferLoader: XHR error")},c.src=b}if(a.type==o.audio){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.open("GET",b,!0),d.onload=function(){F.context.decodeAudioData(d.response,function(c){return c?(m.audio[b]=c,void(++a.loadCount==a.max&&a.next&&a.next())):void alert("error decoding file data: "+b)},function(a){})},d.onerror=function(){alert("BufferLoader: XHR error")},d.send()}};return a},M=function(){function a(){D.keyboardTable="qwerty",D.vubars="colour",D.stereoSeparation=u.BALANCED}var b={};return b.readSettings=function(){a();var b=N.get("bassoonTrackerSettings");if(b){try{b=JSON.parse(b)}catch(a){return!1}for(var c in b)D.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(D[c]=b[c]);D.stereoSeparation&&F.setStereoSeparation(D.stereoSeparation)}},b.saveSettings=function(){var a={vubars:D.vubars,keyboardTable:D.keyboardTable,stereoSeparation:D.stereoSeparation};N.set("bassoonTrackerSettings",JSON.stringify(a))},b.reset=function(){a(),b.saveSettings()},b}(),N=function(){var a={};return a.get=function(a){return localStorage.getItem(a)},a.set=function(a,b){return localStorage.setItem(a,b)},a}(),O={},P={},Q={},R=[],S=[],T=[],U=function(){function a(a){a=a||0,o=o||new WAAClock(F.context),o.start(),F.enable(),n&&n.setStatus("Playing"),ma=[],na=[],x=q.patterns[a];var c=x.length,d={},e=0,f=F.context.currentTime+.01,g=.1,h=1,j=x,k=$;la=[],C=o.setTimeout(function(l){e>1&&(g=h,C.repeat(g));for(var m=l.deadline+g;f<m;)if(H.setStateAtTime(f,{patternPos:e,songPos:k}),d.patternDelay){for(d.patternDelay--,oa=0;oa<ea;oa++)i(oa,f);f+=ca*da}else if(d=b(e,f,j,k),f+=ca*da,e++,e>=c||d.patternBreak)if(d.positionBreak&&d.targetSongPosition==k||(ma=[],na=[]),e=0,U.getPlayType()==r.song){var n=d.positionBreak?d.targetSongPosition:++k;n>=q.length&&(n=0),k=n,a=q.patternTable[k],j=q.patterns[a],d.patternBreak&&(e=d.targetPatternPosition||0)}else d.patternBreak&&(e=d.targetPatternPosition||0)},.01).repeat(g).tolerance({early:.1})}function b(a,b,c,d){c=c||x;for(var e,g=c[a],h=g.length,j={},k=0;k<h;k++)l=g[k],l&&l.effect&&15==l.effect&&(l.param<=32?(0==l.param&&(l.param=1),U.setAmigaSpeed(l.param)):U.setBPM(l.param));for(var k=0;k<h;k++){var l=g[k],m={position:d,step:a},n=b;if(ga){var o=(Math.random()*ga*2-ga)/1e3;n+=o}e=f(l,k,n,m),e.patternBreak&&(j.patternBreak=!0,j.targetPatternPosition=e.targetPatternPosition||0),e.positionBreak&&(j.positionBreak=!0,j.targetPatternPosition=e.targetPatternPosition||0,j.targetSongPosition=e.targetSongPosition||0),e.patternDelay&&(j.patternDelay=e.patternDelay)}for(k=0;k<h;k++)i(k,b);return j}function f(a,b,c,d){var e=100,f={},g=a.sample,i=a.period,j=a.note;if(a.note){var k=S[a.note];k&&(i=k.period)}i&&!g&&(g=ja[b].currentSample,e="number"==typeof ja[b].currentVolume?ja[b].currentVolume:e,D.emulateProtracker1OffsetBug&&g&&ka[b].offset&&ka[b].offset.sample==g&&(f.offset=ka[b].offset)),"number"==typeof a.sample&&(v=H.getSample(a.sample),v&&(e=100*(v.volume/64),D.emulateProtracker1OffsetBug&&(ka[b].offset=ka[b].offset||{},ka[b].offset.value=0,ka[b].offset.sample=a.sample))),"number"==typeof g&&(v=H.getSample(g),j&&v.relativeNote&&(j+=v.relativeNote,k=S[j],k&&(i=k.period)));var l,m,n=e,o=!0,p=a.param,q={};switch(a.effect){case 0:if(p){l=p>>4,m=15&p;var r=i||ja[b].startPeriod,s=0,t=g||ja[b]?ja[b].currentSample:0;t&&(v=H.getSample(t),v&&v.finetune&&(s=v.finetune,r=F.getFineTuneForPeriod(r,s))),f.arpeggio={root:r,interval1:r-F.getSemiToneFrom(r,l,s),interval2:r-F.getSemiToneFrom(r,m,s),step:1}}a.sample&&(f.volume={value:e});break;case 1:p*=-1,f.slide={value:p},ka[b].slideUp=f.slide;break;case 2:f.slide={value:p},ka[b].slideDown=f.slide;break;case 3:o=!1;var u=i;if(ja[b].currentSample&&(g=ja[b].currentSample),u&&g){var v=H.getSample(g);v&&v.finetune&&(u=F.getFineTuneForPeriod(u,v.finetune))}var w=ka[b].slide;w&&(p||(p=w.value)),u||(u=ka[b].defaultSlideTarget),f.slide={value:p,target:u,canUseGlissando:!0},ka[b].slide=f.slide,a.sample&&(f.volume={value:e});break;case 4:a.sample&&(ja[b].startVolume&&(f.volume={value:n}),ja[b].vibratoTimer=0),l=p>>4,m=15&p;var x=l*ca/64,z=ka[b].vibrato;0==l&&z&&(x=z.freq),0==m&&z&&(m=z.amplitude),f.vibrato={amplitude:m,freq:x},ka[b].vibrato=f.vibrato;break;case 5:o=!1,u=i,u&&g&&(v=H.getSample(g),v&&v.finetune&&(u=F.getFineTuneForPeriod(u,v.finetune))),p=1;var w=ka[b].slide;w&&(u||(u=w.target||0),p=w.value),f.slide={value:p,target:u},ka[b].slide=f.slide,a.sample&&(f.volume={value:e}),p=a.param,p&&(a.param<16?p*=-1:p=a.param>>4,p=100*p/64,f.fade={value:p,resetOnStep:!!a.sample},ka[b].fade=f.fade);break;case 6:a.sample&&(ja[b].startVolume&&(f.volume={value:n}),ja[b].vibratoTimer=0),a.param&&(a.param<16?p*=-1:p=15&a.param,p=100*p/64,f.fade={value:p},ka[b].fade=f.fade),ka[b].vibrato&&(f.vibrato=ka[b].vibrato);break;case 7:i&&!a.sample&&(ja[b].startVolume&&(f.volume={value:n}),ja[b].tremoloTimer=0),l=p>>4,m=15&p;var A=m,x=l*ca/64,C=ka[b].tremolo;0==l&&C&&(x=C.freq),0==m&&C&&(A=C.amplitude),f.tremolo={amplitude:A,freq:x},ka[b].tremolo=f.tremolo;break;case 8:break;case 9:p<<=8,!p&&ka[b].offset&&(p=ka[b].offset.stepValue||ka[b].offset.value||0);var E=p;D.emulateProtracker1OffsetBug&&!a.sample&&ka[b].offset&&(p+=ka[b].offset.value),f.offset={value:p,stepValue:E},ka[b].offset=ka[b].offset||{},ka[b].offset.value=f.offset.value,ka[b].offset.stepValue=f.offset.stepValue,D.emulateProtracker1OffsetBug&&(a.sample&&(ka[b].offset.sample=a.sample),i&&(ka[b].offset.value+=E)),a.sample&&(f.volume={value:e});break;case 10:if(a.param<16?p*=-1:p=a.param>>4,p=100*p/64,!a.param){var G=ka[b].fade;G&&(p=G.value)}f.fade={value:p,resetOnStep:!!a.sample};break;case 11:q.patternBreak=!0,q.positionBreak=!0,q.targetSongPosition=a.param,q.targetPatternPosition=0;break;case 12:n=a.param/64*100,f.volume={value:n};break;case 13:q.patternBreak=!0,l=p>>4,m=15&p,q.targetPatternPosition=10*l+m,q.targetPatternPosition>=fa&&(q.targetPatternPosition=0);break;case 14:var I=p>>4,J=15&p;switch(I){case 0:F.setAmigaLowPassFilter(!J,c);break;case 1:J*=-1,!J&&ka[b].fineSlide&&(J=ka[b].fineSlide.value),f.slide={value:J,fine:!0},ka[b].fineSlide=f.slide;break;case 2:!J&&ka[b].fineSlide&&(J=ka[b].fineSlide.value),f.slide={value:J,fine:!0},ka[b].fineSlide=f.slide;break;case 3:ka[b].glissando=!!J;break;case 4:switch(J){case 1:y=F.waveFormFunction.saw;break;case 2:y=F.waveFormFunction.square;break;case 3:y=F.waveFormFunction.sine;break;case 4:y=F.waveFormFunction.sine;break;case 5:y=F.waveFormFunction.saw;break;case 6:y=F.waveFormFunction.square;break;case 7:y=F.waveFormFunction.sine;break;default:y=F.waveFormFunction.sine}break;case 5:if(g){var v=H.getSample(g);f.fineTune={original:v.finetune,sample:v},v.finetune=J,J>7&&(v.finetune=J-15)}break;case 6:J?(na[b]=na[b]||0,na[b]<J?(na[b]++,q.patternBreak=!0,q.positionBreak=!0,q.targetSongPosition=d.position,q.targetPatternPosition=ma[b]||0):na[b]=0):ma[b]=d.step;break;case 7:switch(J){case 1:B=F.waveFormFunction.saw;break;case 2:B=F.waveFormFunction.square;break;case 3:B=F.waveFormFunction.sine;break;case 4:B=F.waveFormFunction.sine;break;case 5:B=F.waveFormFunction.saw;break;case 6:B=F.waveFormFunction.square;break;case 7:B=F.waveFormFunction.sine;break;default:B=F.waveFormFunction.sine}break;case 8:break;case 9:J&&(f.reTrigger={value:J});break;case 10:J=100*J/64,f.fade={value:J,fine:!0};break;case 11:J=100*J/64,f.fade={value:-J,fine:!0};break;case 12:J?J<ca&&(f.cutNote={value:J}):o=!1;break;case 13:J&&(J<ca?c+=da*J:o=!1);break;case 14:q.patternDelay=J;break;case 15:}break;case 15:a.param<=32?(0==a.param&&(a.param=1),U.setAmigaSpeed(a.param)):U.setBPM(a.param)}return o&&g&&i&&(h(b,c),ja[b]=F.playSample(g,i,n,b,f,c,a.note),ka[b].defaultSlideTarget=ja[b].startPeriod),g&&(ja[b].currentSample=g,f.fineTune&&f.fineTune.sample&&(f.fineTune.sample.finetune=f.fineTune.original||0)),ja[b].effects=f,ja[b].note=a,q}function h(a,b){try{if(ja[a].source){var c=ja[a].volume.gain;c.setValueAtTime(ja[a].currentVolume/100,b-.002),c.linearRampToValueAtTime(0,b),ja[a].source.stop(b+.02)}}catch(a){}}function i(a,b){var c=ja[a],d=c.effects;if(c&&d){var e;if(c.resetPeriodOnStep&&c.source){var f=c.currentPeriod||c.startPeriod,g=c.startPeriod/f;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b),c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b+.01),c.resetPeriodOnStep=!1}if(d.volume){var i=d.volume.value;c.volume&&c.volume.gain.setValueAtTime(i/100,b),c.currentVolume=i}if(d.fade){e=d.fade.value;var j,k=1;j=d.fade.resetOnStep?c.startVolume:c.currentVolume;var l=ca;d.fade.fine&&(k=0,l=1);for(var m=k;m<l;m++)c.volume&&(c.volume.gain.setValueAtTime(j/100,b+m*da),j+=e,j=Math.max(j,0),j=Math.min(j,100));c.currentVolume=j}if(d.slide&&c.source){var n=c.currentPeriod||c.startPeriod,f=n;e=Math.abs(d.slide.value);var l=ca;d.slide.fine&&(l=2);for(var m=1;m<l;m++){d.slide.target?(ka[a].defaultSlideTarget=d.slide.target,f<d.slide.target?(f+=e,f>d.slide.target&&(f=d.slide.target)):(f-=e,f<d.slide.target&&(f=d.slide.target))):(f+=d.slide.value,ka[a].defaultSlideTarget&&(ka[a].defaultSlideTarget+=d.slide.value)),f=F.limitAmigaPeriod(f);var o=f;if(d.slide.canUseGlissando&&ka[a].glissando&&(o=F.getNearestSemiTone(f,c.sampleIndex)),o!=c.currentPeriod){c.currentPeriod=f;var g=c.startPeriod/o;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b+m*da),c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b+m*da+.005)}}}if(d.arpeggio&&c.source){var f,n=c.currentPeriod||c.startPeriod;c.resetPeriodOnStep=!0;for(var m=0;m<ca;m++){var p=m%3;0==p&&(f=n),1==p&&d.arpeggio.interval1&&(f=n-d.arpeggio.interval1),2==p&&d.arpeggio.interval2&&(f=n-d.arpeggio.interval2);var g=n/f;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b+m*da)}}if(d.vibrato){var q=d.vibrato.freq,r=d.vibrato.amplitude;if(c.vibratoTimer=c.vibratoTimer||0,c.source){c.resetPeriodOnStep=!0,n=c.currentPeriod||c.startPeriod;for(var m=0;m<ca;m++){f=y(n,c.vibratoTimer,q,r);var g=c.startPeriod/f;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*g,b+m*da),c.vibratoTimer++}}}if(d.tremolo){var q=d.tremolo.freq,r=d.tremolo.amplitude;if(c.tremoloTimer=c.tremoloTimer||0,c.volume)for(var s=c.startVolume,m=0;m<ca;m++)s=B(s,c.tremoloTimer,q,r),s<0&&(s=0),s>100&&(s=100),c.volume.gain.setValueAtTime(s/100,b+m*da),c.currentVolume=s,c.tremoloTimer++}if(d.cutNote&&(c.volume.gain.setValueAtTime(0,b+d.cutNote.value*da),c.currentVolume=0),d.reTrigger){var t=c.sampleIndex,u=c.startPeriod;i=c.startVolume;for(var v=d.reTrigger.value||1;v<ca;){var w=b+v*da;h(a,w),ja[a]=F.playSample(t,u,i,a,d,w),v+=v}}}}function j(){n&&n.setInfo(q.title),q.channels&&H.setTrackCount(q.channels),v=void 0,s=void 0,u=void 0,aa=void 0,H.setCurrentSongPosition(0),H.setCurrentPatternPos(0),H.setCurrentSampleIndex(1),H.clearEffectCache(),E.trigger(p.songLoaded,q),E.trigger(p.songPropertyChange,q)}function k(){H.setAmigaSpeed(6),H.setBPM(125),y=F.waveFormFunction.sine,B=F.waveFormFunction.sine,ka=[],ja=[];for(var a=0;a<ea;a++)ja.push({}),ka.push({})}function l(){for(var a=[],b=0;b<fa;b++){var c,d=[];for(c=0;c<4;c++)d.push({note:0,effect:0,sample:0,param:0});a.push(d)}return a}function m(){return{length:0,finetune:0,volume:100,loopStart:0,loopRepeatLength:0,name:"",data:[]}}var o,q,s,u,v,w,x,y,B,C,H={},I=!1,J=!1,K=[],L=1,M=0,N=0,V=0,W=0,X=0,Y=r.song,$=0,aa=0,ba=125,ca=6,da=2.5/ba,ea=4,fa=64,ga=0,ha={},ia=c("tracks");8==ia&&(ea=8),16==ia&&(ea=16),22==ia&&(ea=22),32==ia&&(ea=32),64==ia&&(ea=64),128==ia&&(ea=128),256==ia&&(ea=256),512==ia&&(ea=512),1024==ia&&(ea=1024);for(var ja=[],ka=[],la=[],ma=[],na=[],oa=0;oa<ea;oa++)ja.push({}),ka.push({});H.init=function(a){for(var b=-8;b<8;b++)P[b]={};for(var c in z)if(z.hasOwnProperty(c)){var d=z[c];if(O[d.period]=d,Q[d.name]=d,R.push(d.name),d.tune)for(b=-8;b<8;b++){var e=P[b],f=b+8;e[d.tune[f]]=d.period}}var g=0;for(c in A)if(A.hasOwnProperty(c)){var h=A[c];h.period||(h.period=453),S.push(h),T[h.period]=g,g++}a&&(F.init(),a.plugin&&n.initPlugin(a))},H.setCurrentSampleIndex=function(a){q.samples[a]&&(L=a,s!=L&&E.trigger(p.sampleChange,L),s=L)},H.getCurrentSampleIndex=function(){return L},H.getCurrentSample=function(){return K[L]},H.setCurrentPattern=function(a){M=a,x=q.patterns[M],x||(x=l(),q.patterns[M]=x),fa=x.length,u!=M&&E.trigger(p.patternChange,M),u=M},H.getCurrentPattern=function(){return M},H.updatePatternTable=function(a,b){q.patternTable[a]=b,E.trigger(p.patternTableChange,b),a==$&&(u=void 0,U.setCurrentPattern(b))},H.setCurrentPatternPos=function(a){N=a,v!=N&&E.trigger(p.patternPosChange,N),v=N},H.getCurrentPatternPos=function(){return N},H.moveCurrentPatternPos=function(a){var b=N+a,c=63;b<0&&(b=c),b>c&&(b=0),H.setCurrentPatternPos(b)},H.setCurrentCursorPosition=function(a){X=a,V=Math.floor(X/6),W=X%6,w!=X&&E.trigger(p.cursorPositionChange,X),w=W},H.getCurrentCursorPosition=function(){return X},H.moveCursorPosition=function(a){var b=X+a,c=6*ea-1;b>c&&(b=0),b<0&&(b=c),H.setCurrentCursorPosition(b)},H.getCurrentTrack=function(){return V},H.getCurrentTrackPosition=function(){return W},H.getCurrentSongPosition=function(){return $},H.setCurrentSongPosition=function(a,b){$=a,$!=aa&&(E.trigger(p.songPositionChange,$),q.patternTable&&H.setCurrentPattern(q.patternTable[$]),aa=$,b&&H.isPlaying()&&(H.stop(),H.togglePlay()))},H.addToPatternTable=function(a,b){"undefined"==typeof a&&(a=q.length),b=b||0,a==q.length&&(q.patternTable[a]=b,q.length++),E.trigger(p.songPropertyChange,q),E.trigger(p.patternTableChange)},H.removeFromPatternTable=function(a){q.length<2||("undefined"==typeof a&&(a=q.length-1),a==q.length-1&&(q.patternTable[a]=0,q.length--),$==q.length&&H.setCurrentSongPosition($-1),E.trigger(p.songPropertyChange,q),E.trigger(p.patternTableChange))},H.setPlayType=function(a){Y=a,E.trigger(p.playTypeChange,Y)},H.getPlayType=function(){return Y},H.playSong=function(){H.stop(),F.checkState(),H.setPlayType(r.song),J=!0,a(M),E.trigger(p.playingChange,J)},H.playPattern=function(){H.stop(),F.checkState(),N=0,H.setPlayType(r.pattern),J=!0,a(M),E.trigger(p.playingChange,J)},H.stop=function(){o&&o.stop(),F.disable(),n&&(n.setStatus("Ready"),Z.clearInputNotes()),H.clearEffectCache();for(var a=0;a<ea;a++)if(ja[a].source)try{ja[a].source.stop()}catch(a){}J=!1,E.trigger(p.playingChange,J)},H.togglePlay=function(){H.isPlaying()?H.stop():Y==r.pattern?H.playPattern():H.playSong()},H.save=function(a){H.buildBinary(t.mod,function(b){var c=new Blob([b.buffer],{type:"application/octet-stream"}),d=a||H.getFileName();G(c,d)})},H.getProperties=function(){return{ticksPerStep:ca,tickTime:da}},H.playPatternStep=b,H.renderTrackToBuffer=function(a){var c=0,d=0,e=64,f=0,g=ca*da*e;for(F.startRendering(g);c<e;){b(c,f);f+=ca*da,c++}c=0,d++,F.stopRendering(function(b){var c=new Blob([b],{type:"octet/stream"});a=a||H.getSong().title.replace(/ /g,"-").replace(/\W/g,"")+".wav"||"module-export.wav",G(c,a)})},H.setBPM=function(a){o&&o.timeStretch(F.context.currentTime,[C],ba/a),ba=a,da=2.5/ba,E.trigger(p.songBPMChange,ba)},H.getBPM=function(){return ba},H.setAmigaSpeed=function(a){ca=a},H.getAmigaSpeed=function(){return ca},H.getSwing=function(){return ga},H.setSwing=function(a){ga=a},H.getPatternLength=function(){return fa},H.getTrackCount=function(){return ea},H.setTrackCount=function(a){
ea=a;for(var b=ja.length;b<ea;b++)ja.push({}),ka.push({});E.trigger(p.trackCountChange,ea)},H.toggleRecord=function(){H.stop(),I=!I,E.trigger(p.recordingChange,I)},H.isPlaying=function(){return J},H.isRecording=function(){return I},H.putNote=function(a,b){var c=q.patterns[M][N][V];c&&(c.sample=a,c.period=b),q.patterns[M][N][V]=c,E.trigger(p.patternChange,M)},H.putNoteParam=function(a,b){var c,d,e=q.patterns[M][N][V];if(e){if(1==a||2==a){var f=e.sample;c=f>>4,d=15&f,1==a&&(c=b),2==a&&(d=b),e.sample=(c<<4)+d}if(3==a&&(e.effect=b),4==a||5==a){var g=e.param;c=g>>4,d=15&g,4==a&&(c=b),5==a&&(d=b),e.param=(c<<4)+d}}q.patterns[M][N][V]=e,E.trigger(p.patternChange,M)},H.setStateAtTime=function(a,b){la.push({time:a,state:b})},H.getStateAtTime=function(a){for(var b=void 0,c=0,d=la.length;c<d;c++){var e=la[0];if(!(e.time<a))return b;b=la.shift().state}return b},H.getTimeStates=function(){return la},H.load=function(a,b,c){a=a||"demomods/StardustMemories.mod",n&&(n.setInfo(""),n.setLoading());var e=function(d){H.processFile(d,f,function(d){if(n&&n.setStatus("Ready"),d){var e="",g="";if("string"==typeof a){if(a.indexOf("modarchive.org")>0){var h=a.split("moduleid=")[1];q.filename=h.split("#")[1]||h,h=h.split("#")[0],h=h.split("&")[0],g="modArchive",e="https://modarchive.org/index.php?request=view_by_moduleid&query="+h,E.trigger(p.songPropertyChange,q)}a.indexOf("modules.pl")>0&&(h=a.split("modules.pl/")[1],q.filename=h.split("#")[1]||h,h=h.split("#")[0],h=h.split("&")[0],g="modules.pl",e="http://www.modules.pl/?id=module&mod="+h,E.trigger(p.songPropertyChange,q))}n&&n.setInfo(q.title,g,e)}if(n&&d&&!b){var i=window.location.pathname,j=i.substring(i.lastIndexOf("/")+1);window.history.pushState&&window.history.pushState({},f,j+"?file="+encodeURIComponent(a))}d&&pa(b),c&&c()})},f="";"string"==typeof a?(f=a.substr(a.lastIndexOf("/")+1),d(a,function(a){e(a)})):(f=a.name||"",b=!0,e(a.buffer||a))};var pa=function(a){var b=c("autoplay");!n&&a&&(b="1"),"true"!=b&&"1"!=b||U.playSong()};return H.handleUpload=function(a){if(a.length){var b=a[0],c=new FileReader;c.onload=function(){H.processFile(c.result,b.name,function(a){n&&n.setStatus("Ready")})},c.readAsArrayBuffer(b)}},H.processFile=function(a,b,c){var d=!1,f=new e(a,!0),g=_.detect(f,b);g&&"ZIP"==g.name&&(n&&n.setStatus("Extracting Zip file"),zip.workerScriptsPath="script/src/lib/zip/",zip.createReader(new zip.ArrayBufferReader(a),function(a){var d,e=0;a.getEntries(function(a){a&&a.length&&a.forEach(function(a){a.uncompressedSize>e&&(e=a.uncompressedSize,d=a)}),d?d.getData(new zip.ArrayBufferWriter,function(a){a&&a.byteLength&&H.processFile(a,b,c)}):c&&c(!1)})},function(a){c&&c(!1)})),g.isMod&&g.loader&&(d=!0,H.isPlaying()&&H.stop(),k(),q=g.loader().load(f,b),q.filename=b,j()),g.isSample&&H.importSample(f,b),c&&c(d)},H.getSong=function(){return q},H.getSamples=function(){return K},H.getSample=function(a){return K[a]},H.setSample=function(a,b){K[a]=b},H.importSample=function(a,b){var c=K[L]||{};c.name=b,c.length=a.length,c.loopStart=0,c.loopRepeatLength=0,c.finetune=0,c.volume=100,c.data=[],g(a,c),E.trigger(p.sampleChange,L),E.trigger(p.sampleNameChange,L)},H.buildBinary=function(a,b){a=a||t.mod;var c=1084,d=0;for(g=0;g<128;g++){var f=q.patternTable[g]||0;d=Math.max(d,f)}c+=(d+1)*(256*ea),K.forEach(function(a){a&&(c+=a.length)});var g,h=new ArrayBuffer(c),i=new e(h,!0);for(i.writeStringSection(q.title,20),K.forEach(function(a){a?(a.length=Math.min(a.length,131070),i.writeStringSection(a.name,22),i.writeWord(a.length>>1),i.writeUByte(a.finetune),i.writeUByte(a.volume),i.writeWord(a.loopStart>>1),i.writeWord(a.loopRepeatLength>>1)):i.clear(30)}),i.writeUByte(q.length),i.writeUByte(127),g=0;g<128;g++){var f=q.patternTable[g]||0;i.writeUByte(f)}for(i.writeString(8==ea?"8CHN":"M.K."),g=0;g<=d;g++)for(var j=q.patterns[g],k=0;k<fa;k++)for(var l=j[k],m=0;m<ea;m++){var n=l[m],o=0,p=n.sample;p>15&&(o=16,p=n.sample-16);var r=(o<<24)+(n.period<<16)+(p<<12)+(n.effect<<8)+n.param;i.writeUint(r)}K.forEach(function(a){if(a&&a.data&&a.length){i.clear(2);var b;for(g=0;g<a.length-2;g++)b=a.data[g]||0,i.writeByte(Math.round(127*b))}}),b&&b(i)},H.clearTrack=function(){for(var a=x.length,b=0;b<a;b++){var c=q.patterns[M][b][V];c&&(c.sample=0,c.period=0,c.effect=0,c.param=0,c.note=void 0)}E.trigger(p.patternChange,M)},H.clearPattern=function(){for(var a=x.length,b=0;b<a;b++)for(var c=0;c<ea;c++){var d=q.patterns[M][b][c];d&&(d.sample=0,d.period=0,d.effect=0,d.param=0,d.note=void 0)}E.trigger(p.patternChange,M)},H.copyTrack=function(a){var b="undefined"!=typeof a;b||(a=M);for(var c=x.length,d=[],e=0;e<c;e++){var f=q.patterns[M][e][a];d.push({sample:f.sample,period:f.period,effect:f.effect,param:f.param,note:f.note})}return b?d:void(ha.track=d)},H.copyPattern=function(){for(var a=[],b=0;b<ea;b++){var c=H.copyTrack(b);a.push(c)}ha.pattern=a},H.getPasteData=function(){return ha},H.pasteTrack=function(a,b){var c="undefined"!=typeof a,d=b;if(c||(a=V,d=ha.track),d){for(var e=x.length,f=0;f<e;f++){var g=q.patterns[M][f][a],h=d[f];g.sample=h.sample,g.period=h.period,g.effect=h.effect,g.param=h.param,g.note=h.note}return c||E.trigger(p.patternChange,M),!0}return!1},H.pastePattern=function(){var a=ha.pattern;if(a){for(var b=0;b<ea;b++)H.pasteTrack(b,a[b]);return E.trigger(p.patternChange,M),!0}return!1},H.clearEffectCache=function(){ka=[];for(var a=0;a<ea;a++)ka.push({})},H.clearInstruments=function(){var a=[];for(oa=1;oa<=31;++oa)K[oa]=m(),a.push({label:oa+" ",data:oa});q.samples=K,n&&n.mainPanel.setInstruments(a),E.trigger(p.sampleChange,L)},H.new=function(){k(),q={patterns:[],samples:[]},K=[],q.typeId="M.K.",q.title="new song",q.length=1,q.patterns.push(l()),H.clearInstruments();for(var a=[],b=0;b<128;++b)a[b]=0;q.patternTable=a,j()},H.clearSample=function(){K[L]=m(),E.trigger(p.sampleChange,L),E.trigger(p.sampleNameChange,L)},H.getFileName=function(){return q.filename||(q.title?q.title.replace(/ /g,"-").replace(/\W/g,"")+".mod":"new.mod")},H}(),V=function(){var a={};return a.sprites={},a.getImage=function(b){return a.sprites[b]?a.sprites[b].canvas:void 0},a.loadImage=function(a,b){var c=new Image;c.onload=function(){b&&b(c)},c.onerror=function(){},c.src=a},a}(),W=V,n=function(){var a,b,d,e,f={},g=[],h=960,i=!0,j=0,k=0,l=0,m=0,o={},q=c("tracks");8==q&&(h=1200),16==q&&(h=1600),q>=32&&(h=3200),f.init=function(a){J=document.getElementById("canvas"),K=J.getContext("2d");var b=window.innerWidth;b>h&&(b=h),J.width=b,J.height=window.innerHeight,K.fillStyle="black",K.fillRect(0,0,J.width,J.height),n.Assets.preLoad(function(){r(),s();var b=c("file");b=b?decodeURIComponent(b):"demomods/Tinytune.mod",U.load(b,!0),a&&a()})},f.initPlugin=function(a){if(a.canvas)J=a.canvas;else{J=document.getElementById("canvas");var b=window.innerWidth;b>h&&(b=h),J.width=b,J.height=window.innerHeight}K=J.getContext("2d"),K.fillStyle="black",K.fillRect(0,0,J.width,J.height),M.baseUrl=a.baseUrl,H.isPlugin=!0,buildNumber=Math.random(),n.Assets.preLoad(function(){r(),s(),M.readSettings(),H.init(),a.callback&&a.callback()})},f.setSize=function(a,b){a>h&&(a=h),a==J.width&&b==J.height||(K.clearRect(0,0,J.width,J.height),J.width=a,J.height=b,f.mainPanel.setLayout(0,0,a,b),e&&e.setProperties({width:a,height:b}),i=!0)};var r=function(){var c=W.getImage("font");a=Y(),a.generate({image:c,startX:1,startY:1,charWidth:6,charHeight:6,margin:0,charsPerLine:30,chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,-_#",onlyUpperCase:!0}),window.fontSmall=a,b=Y(),b.generate({image:c,startX:1,startY:110,charWidth:8,charHeight:8,margin:1,charsPerLine:26,lineSpacing:1,chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789↑↓-#:.!©_?;()=/+<>&[]{}\\*%$'\"`°,",onlyUpperCase:!0}),b.generateColor("green","rgba(80, 140, 0,0.9)"),b.generateColor("orange","rgba(161, 82, 0,0.9)"),window.fontMed=b,d=Y(),d.generate({image:c,startX:1,startY:10,charWidth:11,charHeight:11,margin:1,charsPerLine:20,onlyUpperCase:!0}),window.fontBig=d;var e=Y();e.generate({image:c,startX:107,startY:68,charWidth:8,charHeight:13,margin:0,charsPerLine:20,chars:" 0123456789"}),window.fontLed=e,n.Assets.init(),n.mainPanel=n.MainPanel(),g.push(n.mainPanel),Z.init()},s=function(a){var b=!0;if(U.isPlaying()){var c=U.getStateAtTime(F.context.currentTime+.01);c&&(c.patternPos!=o.patternPos&&(U.setCurrentPatternPos(c.patternPos),o.patternPos=c.patternPos),c.songPos!=o.songPos&&(U.setCurrentSongPosition(c.songPos),o.songPos=c.songPos))}if(k&&(l++,b=l>k),b){l=0;var d=0;F.context&&(d=F.context.currentTime),E.trigger(p.screenRefresh),i&&(g.forEach(function(a){a.needsRendering&&a.render()}),n.mainPanel.visualiser.render(),n.mainPanel.vumeter.render(),e&&(e.render(),i=!1)),d&&(m=F.context.currentTime-d,j=Math.max(m,j),j>.06&&(k=1),j>.08&&(k=2),j>.1&&(k=4))}window.requestAnimationFrame(s)};return f.setModalElement=function(a){e=a},f.getModalElement=function(){return e},f.removeModalElement=function(){e=void 0,n.mainPanel.refresh(),i=!0,window.requestAnimationFrame(s)},f.getChildren=function(){return g},f.getEventElement=function(a,b){for(var c=void 0,d=0,e=g.length;d<e;d++){var f=g[d];if(f.isVisible()&&f.containsPoint(a,b)){c=f;break}}return c&&c.children&&c.children.length&&(c=c.getElementAtPoint(a,b)),c},f.setLoading=function(){f.setStatus("Loading"),E.trigger(p.songLoading)},f.setStatus=function(a){E.trigger(p.statusChange,{status:a})},f.setInfo=function(a,b,c){E.trigger(p.statusChange,{info:a,source:b,url:c})},f.stats=function(){return{maxRenderTime:j,currentRenderTime:m,skipRenderSteps:k}},f.children=g,f}();n.app_patternView=function(a,b,c,d){function e(a,b,c,d){fontMed.write(i.ctx,a,b,c,0,d)}function f(a,b,c){if(d=a.toString(16).toUpperCase(),b&&d.length<b)for(c=c||"0";d.length<b;)d=c+d;return d}function g(){var a=U.getCurrentPatternPos()||0;if(j){var b=1,c=b,d=i.height-2,e=d;o=0,r>1&&(e=Math.floor(j/r*d),e<12&&(e=12),o=(d-e)/(r-1)),a&&o&&(c=Math.floor(b+o*a)),s.setProperties({left:i.width-16,top:c,width:16,height:e})}}function h(){var a=i.width,b=Math.floor(a/U.getTrackCount()*k),c=(a-b)/(U.getTrackCount()-k),d=i.height-20;k>=U.getTrackCount()&&(d=-200),t.setProperties({top:d,width:b,left:0+Math.floor(q*c)})}var i=n.panel(a,b,c,d),j=0,k=8,l=13,o=0,q=0,r=U.getPatternLength(),s=n.scale9Panel(c-28,18,16,d-3,{img:W.getImage("bar"),left:2,top:2,right:3,bottom:3});s.onDragStart=function(){U.isPlaying()||(s.startDragIndex=U.getCurrentPatternPos())},s.onDrag=function(a){if(!U.isPlaying()&&j&&o){var b=a.dragY-a.startY,c=Math.floor(s.startDragIndex+b/o);c=Math.min(c,r-1),c=Math.max(c,0),U.setCurrentPatternPos(c)}},i.addChild(s),g();var t=n.scale9Panel(c-28,18,16,16,{img:W.getImage("bar"),left:2,top:2,right:3,bottom:3});t.onDragStart=function(){t.startDragIndex=q},t.onDrag=function(a){var b=U.getTrackCount()-k,c=a.dragX-a.startX,d=i.width-t.width,e=Math.floor(c/(d/b));i.setHorizontalScroll(t.startDragIndex+e)},i.addChild(t);for(var u=[],v=0,w=U.getTrackCount();v<w;v++){var x=n.fxPanel(v);u.push(x),i.addChild(x)}var y=[],z=[],A=10,B=70;return i.setHorizontalScroll=function(a){var b=U.getTrackCount()-k;a!=q&&a>=0&&a<=b&&(q=a,E.trigger(p.patternHorizontalScrollChange,q),h())},i.toggleFxPanel=function(a){if(x=u[a],x.visible)x.hide();else{var b=i.height;x.setPosition(x.left,0),x.setSize(X.trackWidth,b),x.setLayout(),x.show()}i.refresh()},i.render=function(){if(i.isVisible()){if(this.needsRendering){i.clearCanvas();var a=U.getCurrentPattern()||0,b=U.getCurrentPatternPos()||0,c=U.getSong();if(!c)return;var d=X.trackMargin;k=X.visibleTracks;var o=k<U.getTrackCount(),p=i.height-30,r=0,v=10,w=60,x=!1;r&&(v=0,w=0,x=!0),o&&(p-=24),j=Math.ceil(p/l),j%2==0&&j--;var C=Math.floor(j/2),E=b-C,F=E+j,G=l+2,H=Math.floor((p+G)/2),I=H-C*l+4,J=H,K=H+G,L=m.darkPanel;if(!L&&W.getImage("panel_dark")){var M=n.scale9Panel(0,0,X.trackWidth,J,{img:W.getImage("panel_dark"),left:3,top:3,right:2,bottom:2});m.darkPanel=M.render(!0),L=m.darkPanel}var N=[],P=!1;B>J&&(B=J,A=B/10);for(var Q=0;Q<k;Q++){var R=q+Q;if(N[R]=!(u[R]&&u[R].visible)){var T=r+Q*(X.trackWidth+d);i.ctx.drawImage(L,T,0,X.trackWidth,J),i.ctx.drawImage(L,T,K,X.trackWidth,J),u[R]&&(u[R].left=T)}}var V=c.patterns[a];if(V){i.ctx.fillStyle=U.isRecording()?"#A50B0F":"#202E58";var Y=68;i.ctx.fillRect(0,H,i.width-0,G);var Z,$=U.getCurrentTrackPosition(),_=9;x?(T=r+U.getCurrentTrack()*(X.trackWidth+d),Z=T+Math.floor((X.trackWidth-Y)/2)+$*_-1):Z=r+w+U.getCurrentTrack()*X.trackWidth+$*_-1,$>0?(Z+=2*_+1,$>2&&(Z+=2)):_=28,i.ctx.fillStyle="rgba(220,220,220,.3)",i.ctx.fillRect(Z,H,_,l+2);for(var aa=U.getTrackerMode()===TRACKERMODE.FASTTRACKER,Q=E;Q<F;Q++)if(Q>=0&&Q<U.getPatternLength()){var ba=V[Q],ca=I+(Q-E)*l,da=!0;ca<H&&(ca-=3,da=!1),ca>H+l&&(ca+=3,da=!1);var ea=""+Q;Q<10&&(ea="0"+ea);var fa=!1;Q%4==0&&(fa="orange"),e(ea,v,ca,fa),da&&(e(ea,v,ca,fa),e(ea,v,ca,fa));for(var ga=0;ga<k;ga++)if(R=ga+q,N[R]&&R<U.getTrackCount()){var ha,ia=ba[R];if(x?(T=r+ga*(X.trackWidth+d),ha=T+Math.floor((X.trackWidth-Y)/2)):ha=r+w+ga*X.trackWidth,ia.note)var ja=S[ia.note],ka=ja?ja.name:"???";else{var la=O[ia.period];ka=la?la.name:"---"}if(e(ka,ha,ca),da&&(e(ka,ha,ca),e(ka,ha,ca),U.isPlaying()||y[ga]&&"none"!=D.vubars)){var ma=a+"."+b;if(U.isPlaying()&&ia&&ia.period&&z[ga]!=ma){var na=100;if(12==ia.effect)na=100*ia.param/64;else{var oa=U.getInstrument(ia.instrument);oa&&(na=100*oa.volume/64)}y[ga]=na,z[ga]=ma}if(y[ga]){P=!0;var pa=y[ga]*B/100,qa=100*pa/B;if("colour"==D.vubars){var ra=W.getImage("vubar");i.ctx.drawImage(ra,0,100-qa,26,qa,ha-12,H-pa,10,pa)}"trans"==D.vubars&&(T=r+ga*(X.trackWidth+d),i.ctx.fillStyle="rgba(120,190,255,0.3)",i.ctx.fillRect(ha-14,H-pa,10,pa)),y[ga]-=A,y[ga]<0&&(y[ga]=0)}}if(ha+=3*fontMed.charWidth+4,ka=f(ia.instrument,2,"0"),"00"==ka&&(ka=".."),e(ka,ha,ca,"green"),aa){ha+=2*fontMed.charWidth+4;var sa=ia.volumeEffect||0;sa&&(sa-=10),ka=f(sa,2,"0"),"00"==ka&&(ka=".."),e(ka,ha,ca)}ha+=2*fontMed.charWidth+4,ka=f(ia.effect),ka+=f(ia.param,2,"0"),"000"==ka&&(ka="..."),e(ka,ha,ca,"orange")}P&&setTimeout(function(){i.refresh()},20)}}for(var ga=0;ga<k;ga++)R=ga+q,N[R]||u[R].render();if(g(),s.render(),o)for(h(),t.render(),ga=0;ga<k;ga++)R=ga+q,N[R]&&(T=r+ga*(X.trackWidth+d)+2,e(""+(R+1),T,2))}this.needsRendering=!1,i.parentCtx.drawImage(i.canvas,i.left,i.top,i.width,i.height)}},i.onMouseWheel=function(a){if(!U.isPlaying()){var b=U.getCurrentPatternPos();a.mouseWheels[0]>0?b&&U.moveCurrentPatternPos(-1):b<r-1&&U.moveCurrentPatternPos(1)}},i.onDragStart=function(a){t.startDragIndex=q,U.isPlaying()||(i.startDragPos=U.getCurrentPatternPos())},i.onDrag=function(a){if(k<U.getTrackCount()){var b=U.getTrackCount()-k,c=a.dragX-a.startX,d=i.width-t.width,e=Math.floor(c/(d/b));i.setHorizontalScroll(t.startDragIndex-e)}if(!U.isPlaying()){c=Math.round((a.dragY-a.startY)/l);var f=i.startDragPos-c;f=Math.max(f,0),f=Math.min(f,r-1),U.setCurrentPatternPos(f)}},i.getStartTrack=function(){return q},E.on(p.trackCountChange,function(a){k<a&&(k=a),q=Math.min(q,a-k),q=Math.max(q,0);for(var b=u.length,c=a;b<c;b++){var d=n.fxPanel(b);u.push(d),i.addChild(d)}}),E.on(p.songLoaded,function(){i.setHorizontalScroll(0)}),E.on(p.visibleTracksCountChange,function(){q=0,i.refresh()}),E.on(p.trackerModeChanged,function(){i.refresh()}),i},n.app_sidebar=function(){var a=n.panel();a.setProperties({name:"sideButtonPanel"});var b=n.label();b.setProperties({label:"DEMOSONGS:",font:fontFT}),a.addChild(b);for(var c=[],d=[{label:"Demomusic",onClick:function(){U.load("demomods/demomusic.mod")}},{label:"Stardust",onClick:function(){U.load("demomods/StardustMemories.mod")}},{label:"Space Debris",onClick:function(){U.load("demomods/spacedeb.mod")}},{label:"Tinytune",onClick:function(){U.load("demomods/Tinytune.mod")}},{label:"Lotus 2",onClick:function(){U.load("demomods/lotus20.mod")}},{label:"Professionaltracker",onClick:function(){U.load("demomods/hoffman_and_daytripper_-_professional_tracker.mod")}},{label:"8CHN: AceMan",onClick:function(){U.load("demomods/AceMan.mod")}},{label:"28CHN: Dope",onClick:function(){U.load("demomods/dope.mod")}},{label:"Exodus baum",onClick:function(){U.load("demomods/exodus-baum_load.mod")}},{label:"Random !",onClick:function(){H.doCommand(q.randomSong)}}],e=0;e<d.length;e++){var f=d[e],g=n.button();g.info=f,g.onClick=f.onClick,c[e]=g,a.addChild(g)}var h=n.button();return h.setProperties({label:"",textAlign:"center",background:n.Assets.buttonLightScale9,image:W.getImage("piano"),font:window.fontMed}),h.onClick=function(){H.doCommand(q.togglePiano)},a.addChild(h),a.onResize=function(){b.setSize(a.width,X.trackControlHeight);var f=30;for(h.setProperties({left:0,top:a.height-f,width:a.width,height:f}),e=0;e<d.length;e++){var g=c[e],i=e*f+b.height,j=0;i>h.top-f&&(j=-500),g.setProperties({left:j,top:i,width:a.width,height:f,label:g.info.label,textAlign:"left",background:n.Assets.buttonLightScale9,font:window.fontFT})}},a.onResize(),a},n.app_songControl=function(a,b,c,d,e){var f=n.element(a,b,c,d,e);f.type="songControl";var g=n.radioGroup();g.setItems([{label:"   song",active:!0},{label:"pattern",active:!1}]),g.onChange=function(a){U.setPlayType(0==a?r.song:r.pattern)},f.addChild(g);var h={};h.play=n.Assets.generate("buttonDarkGreen"),h.play.setProperties({image:W.getImage("play_green"),activeImage:W.getImage("play_active_red"),activeBackground:n.Assets.buttonDarkRedActiveScale9}),h.play.onClick=function(){h.play.toggleActive(),U.isPlaying()?U.stop():U.getPlayType()==r.song?U.playSong():U.playPattern()},h.play.setProperties({name:"buttonPlay"}),f.addChild(h.play),h.record=n.Assets.generate("buttonDarkRed"),h.record.setProperties({image:W.getImage("record"),activeImage:W.getImage("record_active")}),h.record.onClick=function(){U.toggleRecord()},h.record.setProperties({name:"buttonRecord"}),f.addChild(h.record),h.song=n.Assets.generate("buttonDark"),h.song.onClick=function(){U.playSong()},h.song.setProperties({label:"Song"}),f.addChild(h.song),h.pattern=n.Assets.generate("buttonDark"),h.pattern.onClick=function(){U.playPattern()},h.pattern.setProperties({label:"Pattern"}),f.addChild(h.pattern),E.on(p.recordingChange,function(a){h.record.setActive(a)}),E.on(p.playingChange,function(a){h.play.setActive(a)}),E.on(p.playTypeChange,function(a){a==r.song?g.setSelectedIndex(0,!0):g.setSelectedIndex(1,!0)});var i=["left","top","width","height","name","type","songPatternSelector"];return f.setProperties=function(a){i.forEach(function(b){if("undefined"!=typeof a[b])switch(b){default:f[b]=a[b]}}),f.setSize(f.width,f.height),f.setPosition(f.left,f.top);var b=Math.floor(f.width/3);g.setProperties({left:0,width:b,top:0,height:f.height}),h.play.setProperties({left:b,width:b,top:0,height:f.height}),h.record.setProperties({left:2*b,width:b,top:0,height:f.height}),"big"==f.songPatternSelector&&(g.left=-500,b=Math.floor(f.width/4)+1,h.play.setProperties({left:0,width:b}),h.record.setProperties({left:b,width:b}),h.song.setProperties({left:2*b,width:b,top:0,height:f.height}),h.pattern.setProperties({left:3*b,width:b,top:0,height:f.height}))},f.render=function(a){return a=!!a,f.needsRendering&&(f.clearCanvas(),"small"==f.songPatternSelector&&g.render(),h.play.render(),h.record.render(),"big"==f.songPatternSelector&&(h.song.render(),h.pattern.render())),f.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top,f.width,f.height)},f},n.app_songPatternList=function(a){function b(a){return a=""+a,a.length<2&&(a="0"+a),a}var c=n.panel(),d=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);c.addChild(d);var e=n.listbox();e.setItems([{label:"00:00",data:1}]),c.addChild(e);var f=n.Assets.generate("button20_20");f.setLabel("↑"),f.onClick=function(){var a=e.getSelectedIndex(),b=U.getSong().patternTable[a];b++,U.updatePatternTable(a,b)},c.addChild(f);var g=n.Assets.generate("button20_20");return g.setLabel("↓"),g.onClick=function(){var a=e.getSelectedIndex(),b=U.getSong().patternTable[a];b>0&&b--,U.updatePatternTable(a,b)},c.addChild(g),c.onResize=function(){d.setSize(c.width,c.height),e.setProperties({left:0,top:0,width:c.width-40,height:c.height,centerSelection:!0,onChange:function(){U.setCurrentSongPosition(e.getSelectedIndex(),!0)}}),g.setPosition(c.width-20,Math.floor(c.height/2)-10),f.setPosition(c.width-40,g.top)},E.on(p.patternTableChange,function(a){c.setPatternTable(U.getSong().patternTable)}),c.setPatternTable=function(a){for(var c=[],d=0,f=U.getSong().length;d<f;d++){var g=a[d];c.push({label:b(d)+":"+b(g),data:g})}e.setItems(c)},E.on(p.songLoaded,function(a){c.setPatternTable(a.patternTable)}),E.on(p.songPositionChange,function(a){e.setSelectedIndex(a,!0)}),c},n.trackControl=function(a,b,c,d,e){function f(a){E.trigger(p.trackStateChange,{track:g.track,solo:j.solo.isActive,mute:j.mute.isActive,wasSolo:a})}var g=n.element(a,b,c,d,e);g.type="trackControl",g.track=0;var h,i="test",j={};j.solo=n.Assets.generate("buttonDark"),j.solo.setProperties({activeImage:W.getImage("solo.png"),activeBackground:n.Assets.buttonDarkGreenActiveScale9}),j.solo.onClick=function(){var a=j.solo.isActive;j.solo.toggleActive(),j.mute.isActive&&j.mute.toggleActive(),f(a)},j.solo.setProperties({name:"buttonSolo",label:"S"}),g.addChild(j.solo),j.mute=n.Assets.generate("buttonDark"),j.mute.setProperties({activeImage:W.getImage("mute"),activeBackground:n.Assets.buttonDarkRedActiveScale9}),j.mute.onClick=function(){j.mute.toggleActive(),j.solo.isActive&&j.solo.toggleActive(),f()},j.mute.setProperties({name:"buttonMute",label:"M"}),g.addChild(j.mute),j.fx=n.Assets.generate("buttonDark"),j.fx.onClick=function(){j.fx.toggleActive(),n.mainPanel.toggleFxPanel(g.track)},j.fx.setProperties({name:"buttonFX",label:"FX"}),g.addChild(j.fx);var k=["left","top","width","height","name","type","track","solo","mute"];return g.setProperties=function(a){k.forEach(function(b){if("undefined"!=typeof a[b])switch(b){case"solo":j.mute.isActive&&j.mute.setActive(!1),j.solo.setActive(a[b]),f();break;case"mute":j.solo.isActive&&j.solo.setActive(!1),j.mute.setActive(a[b]),f();break;default:g[b]=a[b]}}),g.setSize(g.width,g.height),g.setPosition(g.left,g.top);var b=Math.floor(g.width/3)+1;j.solo.setProperties({left:0,width:b,top:0,height:g.height}),j.mute.setProperties({left:b-1,width:b,top:0,height:g.height}),j.fx.setProperties({left:2*b-2,width:b,top:0,height:g.height})},g.render=function(a){return a=!!a,g.needsRendering&&(g.clearCanvas(),h?h.write(g.ctx,i.toUpperCase(),6,11,0):(g.ctx.fillStyle="white",g.ctx.fillText(i,10,10)),j.solo.render(),j.mute.render(),j.fx.render()),g.needsRendering=!1,a?g.canvas:void g.parentCtx.drawImage(g.canvas,g.left,g.top,g.width,g.height)},g},n.visualiser=function(){var a,b=n.panel(),c=["wave","spectrum","tracks"],d=2,e=c[d],f=[];return b.ctx.fillStyle="black",b.ctx.lineWidth=2,b.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",b.init=function(){function c(){var a=F.context.createAnalyser();a.minDecibels=-90,a.maxDecibels=-10,a.smoothingTimeConstant=.85,a.fftSize=64,f.push(a)}if(F.context){a=F.context.createAnalyser(),a.minDecibels=-90,a.maxDecibels=-10,a.smoothingTimeConstant=.85;for(var d=0;d<U.getTrackCount();d++)c()}E.on(p.trackCountChange,function(a){for(var b=f.length;b<a;b++)c()}),b.needsRendering=!0},b.connect=function(b){if(F.context){b.connect(a);for(var c=0;c<U.getTrackCount();c++)F.filterChains[c].output().connect(f[c])}},b.nextMode=function(){d++,d>=c.length&&(d=0),e=c[d]},b.render=function(){function c(){a.getByteTimeDomainData(g),b.ctx.beginPath();for(var c=1*b.width/d,e=0,f=0;f<d;f++){var h=g[f]/128,i=h*height/2;0===f?b.ctx.moveTo(e,i):b.ctx.lineTo(e,i),e+=c}b.ctx.lineTo(b.width,height/2),b.ctx.stroke(),b.parentCtx.drawImage(b.canvas,x,y)}if(F.context){var d,g;if("wave"==e)a.fftSize=256,d=a.fftSize,g=new Uint8Array(d),c();else if("spectrum"==e){a.fftSize=128,d=a.frequencyBinCount,g=new Uint8Array(d);var h=8,i=8,j=d-i,k=d-h-i;a.getByteFrequencyData(g);for(var l,m=(b.width-k)/k,n=0,o=h;o<j;o++)l=g[o],b.ctx.fillStyle="rgb("+(l+100)+",50,50)",b.ctx.fillRect(n,height-l/2,m,l/2),n+=m+1;K.drawImage(b.canvas,x,y)}else if("tracks"==e){for(var p=!F.cutOff,q=0;q<U.getTrackCount();q++){var r=f[q],s=b.width/U.getTrackCount(),t=s*q,u=W.getImage("oscilloscope");if(b.ctx.drawImage(u,t,0,s,b.height),r){b.ctx.lineWidth=2,b.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",b.ctx.beginPath();var v;if(s-=5,t+=4,p){d=r.fftSize,g=new Uint8Array(d),r.getByteTimeDomainData(g);for(var w=1*s/d,n=t,o=0;o<d;o++){var z=g[o]/128;v=z*b.height/2,0===o?b.ctx.moveTo(n,v):b.ctx.lineTo(n,v),n+=w}}else v=b.height/2,b.ctx.moveTo(t,v),b.ctx.lineTo(t+s,v);b.ctx.stroke()}}K.drawImage(b.canvas,b.left,b.top)}}},b.init(),b},n.vumeter=function(){function a(){l.width=m.width=g,l.height=m.height=h;var a=Math.floor(g/(i+j));o.clearRect(0,0,l.width,l.height),q.clearRect(0,0,m.width,m.height);for(var b=0;b<a;b++){var c=r,d=s;b>=a/3&&(c=t,d=u),b>=a/1.5&&(c=v,d=w),o.drawImage(c,b*(i+j),0,i,h),q.drawImage(d,b*(i+j),0,i,h)}}function b(a){for(var b=a.length,c=128,d=128,e=0;e<b;e++){var f=a[e];f<c?c=f:f>d&&(d=f)}return(d-c)/255}var c=n.panel();c.left=400,c.top=7;var d,e,f;F.context&&(d=F.context.createAnalyser(),d.minDecibels=-90,d.maxDecibels=-10,d.smoothingTimeConstant=.85,e=F.context.createAnalyser(),e.minDecibels=-90,e.maxDecibels=-10,e.smoothingTimeConstant=.85);var g=500,h=5,i=10,j=2,k=4,l=document.createElement("canvas"),m=document.createElement("canvas"),o=l.getContext("2d"),q=m.getContext("2d"),r=W.getImage("vu_green"),s=W.getImage("vu_green_active"),t=W.getImage("vu_yellow"),u=W.getImage("vu_yellow_active"),v=W.getImage("vu_red"),w=W.getImage("vu_red_active");return c.setSize(g,2*h+k),a(),c.needsRendering=!0,c.connect=function(a){if(F.context){var b=F.context.createChannelSplitter(2);a.connect(b),b.connect(d,0),b.connect(e,1),f=!0}},c.setProperties=function(b){g=b.width,c.left=b.left,c.setSize(g,2*h+k),a()},c.render=function(){if(f){var a,i;d.fftSize=32,e.fftSize=32,a=d.fftSize,i=new Uint8Array(a),d.getByteTimeDomainData(i);var j=b(i)*(Math.E-1);e.getByteTimeDomainData(i);var n=b(i)*(Math.E-1);c.ctx.fillStyle="#253352",c.ctx.fillRect(0,0,c.width,c.height),c.ctx.drawImage(l,0,0),c.ctx.drawImage(l,0,h+k);var o=Math.min(Math.floor(j*g),g),p=Math.min(Math.floor(n*g),g);o&&c.ctx.drawImage(m,0,0,o,h,0,0,o,h),p&&c.ctx.drawImage(m,0,0,p,h,0,h+k,p,h),K.drawImage(c.canvas,c.left,c.top)}},E.on(p.screenRender,function(){c.render()}),c},n.app_controlPanel=function(){var a=n.app_panelContainer(40),b=n.app_songControl();a.addChild(b);var c=n.checkboxbutton({label:"File",onDown:function(){var a=this.isActive?"diskop_load":"topmain";E.trigger(p.showView,a)}}),d=n.checkboxbutton({label:"Options",onDown:function(){var a=this.isActive?"options":"topmain";E.trigger(p.showView,a)}}),e=n.checkboxbutton({label:"Sample Edit",onDown:function(){var a=this.isActive?"sample":"bottommain";E.trigger(p.showView,a)}});a.addChild(c),a.addChild(d),a.addChild(e);var f={background:n.Assets.buttonKeyScale9,activeBackground:n.Assets.buttonKeyActiveScale9,isActive:!1,textAlign:"center",font:window.fontDark,paddingTopActive:1},g=n.button(),h=n.button();g.setProperties(f),g.setLabel("Mod"),g.onDown=function(){U.setTrackerMode(TRACKERMODE.PROTRACKER)},a.addChild(g),h.setProperties(f),h.setLabel("XM"),h.onDown=function(){U.setTrackerMode(TRACKERMODE.FASTTRACKER)},a.addChild(h);var i=[4,8,12,16],j=[];i.forEach(function(a){j.push(n.button())}),j.forEach(function(b,c){b.setProperties(f),b.setLabel(""+i[c]),b.index=c,b.onDown=function(){var a=this.index;j.forEach(function(b,c){b.setActive(c===a)}),X.setVisibleTracks(i[a])},a.addChild(b)});var k=n.label();k.setProperties({label:"Mode:",font:fontFT,width:100,height:20,textAlign:"right"}),a.addChild(k);var l=n.label();return l.setProperties({label:"Display:",font:fontFT,width:100,height:20,textAlign:"right"}),a.addChild(l),a.onPanelResize=function(){a.innerHeight=a.height-2*X.defaultMargin,b.setProperties({left:X.col1X,top:X.defaultMargin,width:X.col1W,height:a.innerHeight,songPatternSelector:"small"});var f=X.col1W-60;f=Math.max(f,115);var m=Math.floor((X.col1W-f)/2);c.setProperties({left:X.col2X+1.5*m,top:X.defaultMargin,width:f,height:a.innerHeight}),d.setProperties({left:c.left+f+m,top:X.defaultMargin,width:f,height:a.innerHeight}),e.setProperties({left:X.col4X+m,top:X.defaultMargin,width:f,height:a.innerHeight});var n=X.col1W-101;g.setProperties({left:X.col5X+n,top:X.defaultMargin,width:51,height:16}),h.setProperties({left:g.left+g.width-1,top:g.top,width:g.width,height:g.height});var o=g.left;j.forEach(function(a,b){a.setProperties({left:o,top:g.top+g.height,width:26,height:g.height}),o+=a.width-1,i[b]===X.visibleTracks&&a.setActive(!0)}),k.setProperties({left:X.col5X,top:X.defaultMargin-2,width:X.col1W-95,height:20}),l.setProperties({left:k.left,top:k.top+g.height,width:k.width,height:k.height})},a.onPanelResize(),a.renderInternal=function(){a.ctx.drawImage(W.getImage("line_ver"),X.col2X-2,0,2,a.height-1),a.ctx.drawImage(W.getImage("line_ver"),X.col4X-2,0,2,a.height-1),a.ctx.drawImage(W.getImage("line_ver"),X.col5X-2,0,2,a.height-1),a.ctx.translate(.5,.5),a.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",a.ctx.lineWidth=1,a.ctx.beginPath(),a.ctx.moveTo(X.col2X+10,10),a.ctx.lineTo(X.col2X+10,20),a.ctx.lineTo(X.col4X-14,20),a.ctx.lineTo(X.col4X-14,10),a.ctx.moveTo(X.col4X+10,30),a.ctx.lineTo(X.col4X+10,20),a.ctx.lineTo(X.col5X-14,20),a.ctx.lineTo(X.col5X-14,30),a.ctx.stroke(),a.ctx.setTransform(1,0,0,1,0,0),c.render(),d.render(),e.render()},E.on(p.showView,function(a){switch(a){case"diskop_load":case"diskop_save":c.setActive(!0),d.setActive(!1);break;case"options":c.setActive(!1),d.setActive(!0);break;case"topmain":c.setActive(!1),d.setActive(!1);break;case"main":c.setActive(!1),d.setActive(!1),e.setActive(!1);break;case"bottommain":e.setActive(!1);break;case"sample":e.setActive(!0)}}),E.on(p.trackerModeChanged,function(a){g.setActive(a===TRACKERMODE.PROTRACKER),h.setActive(a===TRACKERMODE.FASTTRACKER)}),a};var X=function(){var a={};return a.defaultMargin=4,a.setLayout=function(b,c){a.col1W=Math.floor((b-6*a.defaultMargin-3)/5),a.col2W=2*a.col1W+a.defaultMargin,a.col3W=3*a.col1W+2*a.defaultMargin,a.col4W=4*a.col1W+3*a.defaultMargin,a.col5W=5*a.col1W+4*a.defaultMargin,a.marginLeft=Math.floor((b-a.col5W)/2),a.marginRight=b-a.marginLeft-a.col5W,a.col1X=a.marginLeft,a.col2X=a.col1X+a.defaultMargin+a.col1W,a.col3X=a.col2X+a.defaultMargin+a.col1W,a.col4X=a.col3X+a.defaultMargin+a.col1W,a.col5X=a.col4X+a.defaultMargin+a.col1W,a.trackWidth=a.col1W,a.trackMargin=a.defaultMargin,a.visibleTracks=4,a.infoPanelHeight=24,a.trackControlHeight=32,a.analyserHeight=66,a.pianoHeight=200,c<800&&(a.pianoHeight=150),c<650&&(a.pianoHeight=100),a.showSideBar=!0},a.setVisibleTracks=function(b){a.visibleTracks=b;var c=a.defaultMargin*(b-1),d=b>4?a.col5W:a.col4W;a.trackWidth=Math.floor((d-c)/b),a.showSideBar=b<5,E.trigger(p.visibleTracksCountChange,b)},a}();n.app_mainPanel=function(){var a=n.app_panelContainer(160),b="",c=n.button();c.setProperties({background:n.Assets.panelInsetScale9,activeBackground:n.Assets.buttonDarkScale9,image:W.getImage("logo_grey_70"),activeImage:W.getImage("logo_colour_70")}),c.onDown=function(){c.toggleActive()},a.addChild(c);var d=n.inputbox({name:"modName",onChange:function(a){U.getSong().title=a,n.setInfo(a)}});a.addChild(d);var e=n.listbox();e.setItems([{label:"loading ...",data:1}]),a.addChild(e),e.onClick=function(a){Z.setFocusElement(e);var b=e.getItemAtPosition(e.eventX,e.eventY);b&&U.setCurrentInstrumentIndex(b.data)};var f=n.app_songPatternList();a.addChild(f);var g=window.fontFT,h=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);a.addChild(h);var i=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);a.addChild(i);var j=n.spinBox();j.setProperties({name:"Pattern",label:"Pattern",value:0,max:100,min:0,font:g,onChange:function(a){U.setCurrentPattern(a)}}),a.addChild(j);var k=n.spinBox({name:"Instrument",label:"Instrument",value:1,max:64,min:1,font:g,onChange:function(a){U.setCurrentInstrumentIndex(a)}});a.addChild(k);var l=n.spinBox({name:"SongLength",label:"Song length",value:1,max:200,min:1,font:g,onChange:function(a){var b=U.getSong().length;b>a?U.removeFromPatternTable():b<a&&U.addToPatternTable()}});a.addChild(l);var m=n.spinBox({name:"PatternLength",label:"Pattern length",value:64,max:128,
min:1,font:g,onChange:function(a){U.setPatternLength(a)}});a.addChild(m);var o=n.spinBox({name:"BPMLength",label:"BPM",value:1,max:400,min:1,font:g,onChange:function(a){}});a.addChild(o);var q=n.DiskOperations();q.setProperties({name:"diskoperations",zIndex:100}),a.addChild(q),n.diskOperations=q;var r=n.OptionsPanel();return r.setProperties({name:"options",zIndex:100}),a.addChild(r),a.onPanelResize=function(){var b=20,g=X.defaultMargin,n=b+2*g,p=50,s=p+g+g,t=a.height-p-4*g,u=28,v=X.col1W-2;c.setDimensions({left:X.col1X,top:g,width:X.col2W,height:p}),d.setDimensions({left:X.col4X,width:X.col2W,top:g,height:b}),e.setDimensions({left:X.col4X,width:X.col2W,top:n,height:a.height-n-2*g}),f.setDimensions({left:X.col1X,width:X.col1W,top:s,height:t}),h.setDimensions({left:X.col2X,width:X.col1W,top:s,height:t}),i.setDimensions({left:X.col3X,width:X.col1W,top:s,height:t}),o.setDimensions({left:X.col2X,top:h.top+3,width:v,height:u}),l.setDimensions({left:X.col2X,top:h.top+3+u,width:v,height:u}),j.setDimensions({left:X.col3X,top:h.top+3,width:v,height:u}),m.setDimensions({left:X.col3X,top:h.top+3+u,width:v,height:u}),k.setDimensions({left:X.col3X,top:h.top+3+2*u,width:v,height:u}),q.setSize(a.width,a.height),r.setSize(a.width,a.height)},a.onPanelResize(),a.getCurrentView=function(){return b},E.on(p.songLoading,function(){d.setValue("Loading ...",!0)}),E.on(p.songPropertyChange,function(a){d.setValue(a.title,!0),l.setValue(a.length,!0),k.setMax(a.instruments.length-1)}),E.on(p.songBPMChange,function(a,b){o.setValue(b,!0)}),E.on(p.instrumentChange,function(a){e.setSelectedIndex(a-1),k.setValue(a,!0)}),E.on(p.instrumentNameChange,function(b){var c=U.getInstrument(b);if(c)for(var d=a.getInstruments(),e=0,f=d.length;e<f;e++)if(d[e].data==b){d[e].label=b+" "+c.name,E.trigger(p.instrumentListChange,instrumentContainer);break}}),E.on(p.instrumentListChange,function(a){e.setItems(a)}),E.on(p.patternChange,function(a){j.setValue(a,!0),m.setValue(U.getPatternLength(),!0)}),E.on(p.trackerModeChanged,function(a){m.setDisabled(a===TRACKERMODE.PROTRACKER)}),E.on(p.showView,function(c){switch(c){case"diskop_load":case"diskop_save":q.setView(c),q.show(),r.hide(),b=c,a.refresh();break;case"options":q.hide(),r.show(!0),b=c,a.refresh();break;case"topmain":case"main":q.hide(),r.hide(),b="",a.refresh()}}),a},n.app_menu=function(a){var b=n.app_panelContainer(32),c=n.scale9Panel(5,0,20,26,{img:W.getImage("menu"),left:4,top:0,right:40,bottom:0});b.addChild(c);var d=n.menu(5,0,b.width,26,a);b.addChild(d),d.setItems([{label:"File",subItems:[{label:"New",command:q.newFile},{label:"Open Module",command:q.openFile},{label:"Save Module",command:q.saveFile},{label:"Open Random Song",command:q.randomSong}]},{label:"Edit",subItems:[{label:"Clear Track",command:q.clearTrack},{label:"Clear Pattern",command:q.clearPattern},{label:"Clear Song",command:q.clearSong},{label:"Clear Instruments",command:q.clearInstruments}]},{label:"View",subItems:[{label:"Main",command:q.showMain},{label:"Options",command:q.showOptions},{label:"File Operations",command:q.showFileOperations},{label:"Sample Editor",command:q.showSampleEditor},{label:"Piano",command:q.togglePiano}]},{label:"Help",subItems:[{label:"About",command:q.showAbout},{label:"Documentation",command:q.showHelp},{label:"Sourcecode on Github",command:q.showGithub}]}]);var e=n.vumeter();return e.connect(F.cutOffVolume),window.vumeter=e,b.onPanelResize=function(){c.setDimensions({left:X.marginLeft,top:0,height:26,width:X.col2W}),e.setProperties({width:X.col3W,left:X.col3X})},b.onPanelResize(),b},n.app_panelContainer=function(a){var b=n.panel(0,0,J.width,a,!0),c=n.scale9Panel(0,0,b.width,b.height,n.Assets.panelMainScale9);return c.ignoreEvents=!0,b.addChild(c),b.onResize=function(){c.setSize(b.width,b.height),b.onPanelResize&&b.onPanelResize()},b},n.app_patternPanel=function(){function a(){var a=l.getStartTrack(),d=Math.min(a+X.visibleTracks,U.getTrackCount());for(b=0;b<e.length;b++)e[b].setProperties(b>=a&&b<d?{track:b,left:c+(X.trackWidth+X.trackMargin)*(b-a),top:X.defaultMargin+X.infoPanelHeight+X.analyserHeight,width:X.trackWidth,height:X.trackControlHeight,visible:!0}:{track:b,top:-100,visible:!1})}var b,c,d=n.app_panelContainer(80),e=[],f=4,g="main",h=n.editPanel();d.addChild(h);var i=n.InfoPanel();for(d.addChild(i),b=0;b<U.getTrackCount();b++)e[b]=n.trackControl(),d.addChild(e[b]);var j=n.visualiser();j.connect(F.cutOffVolume),j.name="mainAnalyser",j.onClick=function(){j.nextMode()},window.visualiser=j;var k=n.app_sidebar();d.addChild(k);var l=n.app_patternView();l.setProperties({name:"patternViewPanel"}),d.addChild(l);var m=n.SampleView();return m.setProperties({name:"sampleViewPanel"}),d.addChild(m),d.onPanelResize=function(){var b=X.infoPanelHeight+X.trackControlHeight+X.analyserHeight+2*X.defaultMargin,e=d.height-b-X.defaultMargin;c=k.isVisible()?X.col2X:X.col1X;var f=k.isVisible()?X.col4W:X.col5W;h.setDimensions({left:X.col1X,top:X.defaultMargin,width:X.col1W,height:X.infoPanelHeight+X.analyserHeight}),i.setDimensions({left:X.col2X,top:0,width:X.col4W,height:X.infoPanelHeight}),l.setDimensions({left:c,top:b,width:f,height:e}),k.setDimensions({left:X.col1X,top:l.top-X.trackControlHeight,width:X.col1W,height:e+X.trackControlHeight}),j.setProperties({left:c,top:d.top+X.infoPanelHeight+3,width:f,height:X.analyserHeight}),m.setProperties({left:X.col1X,top:b,width:X.col5W,height:e}),a()},d.onPanelResize(),E.on(p.patternChange,function(){l.refresh()}),E.on(p.patternPosChange,function(){l.refresh()}),E.on(p.cursorPositionChange,function(){l.refresh()}),E.on(p.recordingChange,function(){l.refresh()}),E.on(p.trackStateChange,function(a){if("undefined"!=typeof a.track)if(a.solo)for(b=0;b<U.getTrackCount();b++)b!=a.track&&e[b].setProperties({mute:!0});else if(a.wasSolo)for(b=0;b<U.getTrackCount();b++)b!=a.track&&e[b].setProperties({mute:!1})}),E.on(p.trackCountChange,function(a){for(d.visibleTracks=Math.min(f,a),b=e.length;b<a;b++)e[b]=n.trackControl(),e[b].setProperties({track:b,top:-200}),d.addChild(e[b])}),E.on(p.patternHorizontalScrollChange,function(){a()}),E.on(p.showView,function(a){switch(a){case"sample":m.show(),l.hide(),k.hide(),g=a,d.refresh();break;case"bottommain":case"main":m.hide(),l.show(),X.showSideBar&&(k.show(),h.show()),g="main",d.onPanelResize(),d.refresh()}}),E.on(p.visibleTracksCountChange,function(a){X.showSideBar?"main"===g&&(k.show(),h.show()):(k.hide(),h.hide()),d.onResize()}),d},n.app_pianoView=function(){var a=n.app_panelContainer(200);a.name="pianoViewPanel";var b=64,c=[],d=[],e={},f=[],g=[],h={},i=W.getImage("pianokey_white"),j=W.getImage("pianokey_white_down"),k=W.getImage("pianokey_black"),l=W.getImage("pianokey_black_down"),m=1,o=30,r=0,s=n.Assets.generate("button20_20");s.setLabel("x"),s.onClick=function(){H.doCommand(q.togglePiano)},a.addChild(s);var t=n.spinBox();if(t.setProperties({name:"Octave",label:"Octave",value:1,max:3,min:1,left:4,top:2,height:28,width:150,font:window.fontMed,onChange:function(a){m=a}}),a.addChild(t),a.onShow=function(){a.onPanelResize()},a.onPanelResize=function(){a.innerHeight=a.height-2*X.defaultMargin,s.setProperties({top:4,left:a.width-24})},a.onPanelResize(),!c.length)for(var u in z)z.hasOwnProperty(u)&&(u.indexOf("s")<0?(e[z[u].period]=c.length,c.push(u)):(e[z[u].period]=1e3+d.length,d.push(u)));E.on(p.pianoNoteOn,function(b){if(a.isVisible()&&b&&b.basePeriod){var c=e[b.basePeriod];c>=0&&(c-=c>=1e3?5*(m-1):7*(m-1),f[c]={startTime:F.context.currentTime,source:b.source},a.refresh())}}),E.on(p.pianoNoteOff,function(b){if(a.isVisible()&&b&&b.basePeriod){var c=e[b.basePeriod];c-=c>=1e3?5*(m-1):7*(m-1),c>=0&&(f[c]=!1,a.refresh())}});var v=function(a){var b;if(a<1e3&&c[a])b=z[c[a+7*(m-1)]];else{var e=a-1e3;d[e]&&(b=z[d[e+5*(m-1)]])}if(b&&b.period){U.isRecording()&&(U.getCurrentTrackPosition()>0||(U.putNote(U.getCurrentInstrumentIndex(),b.period),U.isPlaying()||U.moveCurrentPatternPos(1)));var f=F.playSample(U.getCurrentInstrumentIndex(),b.period);g[a]=f,E.trigger(p.pianoNoteOn,f)}},w=function(a){var b;if(g[a]){if(a<1e3&&c[a])b=z[c[a+7*(m-1)]];else{var e=a-1e3;d[e]&&(b=z[d[e+5*(m-1)]])}b&&b.period&&(E.trigger(p.pianoNoteOff,g[a]),g[a].volume?g[a].volume.gain.linearRampToValueAtTime(0,F.context.currentTime+.5):g[a].source.stop(),g[a]=!1)}},x=function(a,c){var d=-1;if(c-=o,c>=0)if(c>r)d=Math.floor(a/(b-4));else{var e=(b-4)/2,f=e/2,g=Math.floor((a-f)/e);if(g<0&&(g=0),g%2==0)d=g/2;else{var h={1:0,3:1,5:-1,7:2,9:3,11:4,13:-1,15:5,17:6,19:-1,21:7,23:8,25:9,27:-1,29:10,31:11,33:-1,35:12,37:13,39:14,41:-1};d=1e3+h[g],d<1e3&&(d=Math.floor(a/(b-4)))}}return d};return a.onDown=function(b){var c=x(a.eventX,a.eventY);c>=0&&(h[b.id]=c,v(c))},a.onTouchUp=function(b){var c=b.dragX||a.eventX,d=x(c,a.eventY);d>=0&&(h[b.id]=!1,w(d))},a.onDrag=function(b){var c=b.dragX,d=b.dragY-a.top-o,e=x(c,d);e>=0&&h[b.id]!=e&&(w(h[b.id]),h[b.id]=e,v(e))},a.renderInternal=function(c){if(a.isVisible()){if(c=!!c,this.needsRendering){for(var d=a.height-o,e=0,g=4,h=0;e<a.width;){var m=f[h]?j:i;a.ctx.drawImage(m,e,o,b,d),h++,e+=b-g}var n=48;r=Math.floor(d/1.7);var p=b-n/2-2;h=0;for(var q=0;p<a.width;){var s=h%7,t=f[1e3+q]?l:k;2!=s&&6!=s&&(a.ctx.drawImage(t,p,o,n,r),q++),h++,p+=b-g}}return this.needsRendering=!1,c?a.canvas:void a.parentCtx.drawImage(a.canvas,a.left,a.top,a.width,a.height)}},a},n.Assets=function(){var a={},b={};a.preLoad=function(a){var b,c,d=M.baseUrl||"",e=function(){b&&c&&(b.forEach(function(a){a.img=c,W.sprites[a.name]=W.sprite(a)}),a&&a())};I.json(d+"skin/spritemap.json?v="+buildNumber,function(a){b=a,e()}),W.loadImage(d+"skin/spritesheet.png?v="+buildNumber,function(a){c=a,e()})},a.buttonLightScale9={left:2,top:2,right:4,bottom:4},a.buttonDarkScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkBlueScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkRedScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkGreenScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkActiveScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkGreenActiveScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkRedActiveScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkBlueActiveScale9={left:5,top:5,right:5,bottom:5},a.buttonDarkYellowActiveScale9={left:5,top:5,right:5,bottom:5},a.panelMainScale9={left:2,top:2,right:3,bottom:3},a.panelDarkScale9={left:3,top:3,right:3,bottom:2},a.panelDarkGreyScale9={left:3,top:3,right:3,bottom:2},a.panelDarkGreyBlueScale9={left:3,top:3,right:3,bottom:2},a.panelTransScale9={left:3,top:3,right:3,bottom:2},a.panelInsetScale9={left:2,top:2,right:2,bottom:2},a.panelDarkInsetScale9={left:2,top:2,right:2,bottom:2},a.menuMainScale9={img:W.getImage("menu"),left:1,top:1,right:20,bottom:1};var c={button20_20:{generate:function(c){var d,e=a.panelDarkScale9;return d=n.button(0,0,20,20),d.setProperties({background:e,textAlign:"center",font:window.fontMed,paddingTop:2}),c?void(b.buttonUp20_20=d):d}},button30_30:{generate:function(c){var d,e=a.buttonLightScale9;return d=n.scale9Panel(0,0,30,30,e),c?void(b.buttonUp30_30=d):d}},buttonLight:{generate:function(c){var d,e=a.buttonLightScale9;return d=n.button(),d.setProperties({background:e,textAlign:"center",font:window.fontMed}),c?void(b.buttonLight=d):d}},buttonDark:{generate:function(c){var d,e=a.buttonDarkScale9;return d=n.button(0,0,20,20),d.setProperties({background:e,activeBackground:n.Assets.buttonDarkActiveScale9,isActive:!1,textAlign:"center",font:window.fontMed}),c?void(b.buttonDark=d):d}},buttonDarkBlue:{generate:function(c){var d;return d=n.button(0,0,20,20),d.setProperties({background:a.buttonDarkBlueScale9,activeBackground:n.Assets.buttonDarkBlueActiveScale9,isActive:!1,textAlign:"center",font:window.fontMed}),c?void(b.buttonDarkBlue=d):d}},buttonDarkRed:{generate:function(c){var d;return d=n.button(0,0,20,20),d.setProperties({background:a.buttonDarkRedScale9,activeBackground:n.Assets.buttonDarkRedActiveScale9,isActive:!1,textAlign:"center",font:window.fontMed}),c?void(b.buttonDarkRed=d):d}},buttonDarkGreen:{generate:function(c){var d;return d=n.button(0,0,20,20),d.setProperties({background:a.buttonDarkGreenScale9,activeBackground:n.Assets.buttonDarkGreenActiveScale9,isActive:!1,textAlign:"center",font:window.fontMed}),c?void(b.buttonDarkGreen=d):d}}};return a.init=function(){a.buttonLightScale9.img=W.getImage("button_light"),a.buttonDarkScale9.img=W.getImage("button_inlay"),a.buttonDarkBlueScale9.img=W.getImage("button_inlay_blue"),a.buttonDarkRedScale9.img=W.getImage("button_inlay_red"),a.buttonDarkGreenScale9.img=W.getImage("button_inlay_green"),a.buttonDarkActiveScale9.img=W.getImage("button_inlay_active"),a.buttonDarkGreenActiveScale9.img=W.getImage("button_inlay_green_active"),a.buttonDarkRedActiveScale9.img=W.getImage("button_inlay_red_active"),a.buttonDarkBlueActiveScale9.img=W.getImage("button_inlay_blue_active"),a.buttonDarkYellowActiveScale9.img=W.getImage("button_inlay_yellow_active"),a.panelMainScale9.img=W.getImage("background"),a.panelDarkScale9.img=W.getImage("bar"),a.panelDarkGreyScale9.img=W.getImage("panel_dark_greyish"),a.panelDarkGreyBlueScale9.img=W.getImage("panel_dark_blueish"),a.panelTransScale9.img=W.getImage("panel_trans"),a.panelInsetScale9.img=W.getImage("panel_inset"),a.panelDarkInsetScale9.img=W.getImage("panel_dark"),a.menuMainScale9.img=W.getImage("menu")},a.get=function(a){var d=b[a];if(d)return d;var e=c[a];e&&(e.isLoading||(e.isLoading=!0,e.generate(!0)))},a.put=function(a,c){b[a]=c},a.generate=function(a){return c[a]?c[a].generate():void 0},a}();var Y=function(){var a,b,c,d={},e=!1;return d.generate=function(f){var g=f.image,h=f.startX,i=f.startY,j=f.charWidth,k=f.charHeight,l=f.margin,m=f.lineSpacing||0,n=f.charsPerLine,o=f.chars||"ABCDEFGHIJKLMNOPQRSTUVWXYZ";e=f.onlyUpperCase,d.fontArray=[],d.colors={},c=l,a=j,b=k,d.charWidth=j,d.charHeight=k;for(var p=0,q=o.length;p<=q;p++){var r=document.createElement("canvas");r.width=j,r.height=k;var s=r.getContext("2d"),t=h+p%n*(j+l),u=i+Math.floor(p/n)*(k+m);s.drawImage(g,t,u,j,k,0,0,j,k);var v=o.charCodeAt(p);d.fontArray[v]=r}},d.generateColor=function(a,b){a=a||"green",b=b||"rgba(107, 161, 65,0.9)";var c=[];d.fontArray.forEach(function(a,d){var e=document.createElement("canvas"),f=document.createElement("canvas");e.width=a.width,e.height=a.height,f.width=a.width,f.height=a.height;var g=e.getContext("2d"),h=f.getContext("2d");h.fillStyle=b,h.fillRect(0,0,16,16),h.globalCompositeOperation="destination-atop",h.drawImage(a,0,0),g.drawImage(f,0,0),g.globalCompositeOperation="darken",g.drawImage(a,0,0),c[d]=e}),d.colors[a]=c},d.write=function(f,g,h,i,j,k){e&&(g=g.toUpperCase());var l=d.colors[k]||d.fontArray;j=j||c,h=h||0,i=i||0;for(var m=h,n=0,o=g.length;n<o;n++){var p=g.charCodeAt(n),q=l[p];q&&f.drawImage(q,m,i,a,b),m+=a+j}},d};n.button=function(a,b,c,d,e){var f=n.element(a,b,c,d);f.type="button",f.isActive=!1;var g,h,i,j,k,l,m=e||"",o="left",p=0,q=["left","top","width","height","name","type","image","backgroundImage","background","active","activeBackground","activeImage","font","label","textAlign","paddingTop"];return f.setProperties=function(a){q.forEach(function(b){if("undefined"!=typeof a[b])switch(b){case"label":m=a[b];break;case"font":l=a[b];break;case"textAlign":o=a[b];break;case"paddingTop":p=parseInt(a[b]);break;case"image":g=a[b];break;case"backgroundImage":h=a[b];break;case"activeImage":k=a[b];break;case"background":a[b].img&&(h=void 0,i=n.scale9Panel(0,0,0,0,a[b]),i.setParent(f));break;case"activeBackground":a[b].img&&(h=void 0,j=n.scale9Panel(0,0,0,0,a[b]),j.setParent(f));break;default:f[b]=a[b]}}),i&&i.setSize(f.width,f.height),j&&j.setSize(f.width,f.height),f.setSize(f.width,f.height),f.setPosition(f.left,f.top)},f.setBackgroundImage=function(a){h=a,f.refresh()},f.setFont=function(a){l=a,f.refresh()},f.setLabel=function(a){m=a,f.refresh()},f.toggleActive=function(){f.isActive=!f.isActive,f.refresh()},f.setActive=function(a){"undefined"==typeof a&&(a=!0),f.isActive=a,f.refresh()},f.render=function(a){if(f.isVisible()){if(f.needsRendering){a=!!a;var b=!0;if(h)f.ctx.drawImage(h,0,0,f.width,f.height);else if(i){if(f.isActive&&j){if(j.render(),k){var c=Math.floor((f.height-k.height)/2),d=Math.floor((f.width-k.width)/2);f.ctx.drawImage(k,d,c)}}else if(i.render(),g){var c=Math.floor((f.height-g.height)/2),d=Math.floor((f.width-g.width)/2);f.ctx.drawImage(g,d,c)}}else f.ctx.fillStyle="grey",f.ctx.fillRect(0,0,f.width,f.height),f.ctx.fillStyle="black",f.ctx.rect(0,0,f.width,f.height),f.ctx.stroke();if(m&&b){var e=10,n=8,q=Math.floor((f.height-e)/2)+p,r=10;if(l){if("center"==o){var s=m.length*n;r=Math.floor((f.width-s)/2)}"right"==o&&(s=m.length*n,r=f.width-s-5),l.write(f.ctx,m,r,q,0)}else f.ctx.fillStyle="white",f.ctx.fillText(m,r,q)}}return f.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top,f.width,f.height)}},f},n.checkbox=function(a,b,c,d){c=c||14,d=d||14;var e=n.element(a,b,c,d,!0),f=["left","top","width","height","name","type","checked"];return e.setProperties=function(a){f.forEach(function(b){"undefined"!=typeof a[b]&&(e[b]=a[b])}),e.setSize(e.width,e.height),e.setPosition(e.left,e.top)},e.setState=function(a){e.checked=a,e.refresh(),e.onToggle&&e.onToggle(e.checked)},e.onClick=function(a){e.setState(!e.checked)},e.check=function(){e.setState(!0)},e.unCheck=function(){e.setState(!1)},e.render=function(a){if(a=!!a,this.needsRendering){e.clearCanvas();var b=W.getImage(e.checked?"checkbox_on":"checkbox_off");e.ctx.drawImage(b,0,0)}return this.needsRendering=!1,a?e.canvas:void e.parentCtx.drawImage(e.canvas,e.left,e.top,e.width,e.height)},e},n.checkboxbutton=function(a){var b=n.button(0,0,20,20);return a=a||{},b.setProperties({background:n.Assets.buttonDarkBlueScale9,activeBackground:n.Assets.buttonDarkBlueActiveScale9,isActive:!1,textAlign:"left",paddingLeft:30,font:window.fontFT,label:a.label||""}),b.renderInternal=function(){var a=W.getImage(b.isActive?"radio_active":"radio_inactive");b.ctx.drawImage(a,8,Math.floor(b.height/2)-5)},b.onDown=function(){b.toggleActive(),a.onDown&&a.onDown.bind(b).call()},b},n.element=function(a,b,c,d){var e={};return e.left=a||0,e.top=b||0,e.width=c||20,e.height=d||20,e.visible=!0,e.needsRendering=!0,e.parentCtx=K,e.canvas=document.createElement("canvas"),e.canvas.width=c,e.canvas.height=d,e.ctx=e.canvas.getContext("2d"),e.children=[],e.hide=function(){e.visible=!1},e.show=function(a,b){e.visible=!0,a&&e.refresh(b)},e.toggle=function(){e.visible?e.hide():e.show()},e.isVisible=function(){for(var a=e.visible,b=e.parent;a&&b;)a=b.visible,b=b.parent;return a},e.containsPoint=function(a,b){var c=this.left,d=this.left+this.width,e=this.top,f=this.top+this.height;return a>=c&&a<=d&&b>=e&&b<=f},e.getElementAtPoint=function(a,b){a-=e.left+(e.scrollOffsetX||0),b-=e.top+(e.scrollOffsetY||0),e.scaleX&&(a/=e.scaleX),e.scaleY&&(b/=e.scaleY);for(var c,d=e.children.length-1;d>=0;d--){var f=e.children[d];if(f.isVisible()&&!f.ignoreEvents&&f.containsPoint(a,b)){c=f;break}}if(c){var g=c.getElementAtPoint(a,b);g?c=g:(c.eventX=a,c.eventY=b)}else c=e,c.eventX=a,c.eventY=b;return c},e.setParent=function(a){e.parent=a,a&&(e.parentCtx=a.ctx)},e.addChild=function(a){a.setParent(e),a.zIndex=a.zIndex||e.children.length,e.children.push(a)},e.getChild=function(a){for(var b,c=e.children.length;c;){if(b=e.children[c],b&&b.name&&b.name==a)return b;c--}},e.refresh=function(a){if(e.needsRendering=!0,a)for(var b,c=e.children.length;c;)b=e.children[c],b&&b.refresh(),c--;this.visible&&e.parent&&e.parent.refresh&&e.parent.refresh()},e.setSize=function(a,b){e.width=a,e.height=b,e.canvas.width=e.width,e.canvas.height=e.height,e.refresh()},e.setPosition=function(a,b){e.left=a,e.top=b,e.refresh()},e.clearCanvas=function(){e.ctx.clearRect(0,0,e.width,e.height)},e},n.inputbox=function(a){var b,c,d,e=n.element(),f=["left","top","width","height","name","type","onChange","backgroundImage"],g="",h="panel_dark";e.setProperties=function(a){f.forEach(function(b){"undefined"!=typeof a[b]&&(e[b]=a[b])}),e.setSize(e.width,e.height),e.setPosition(e.left,e.top),i&&i.setSize(e.width,e.height),a.value&&(g=a.value),a.backgroundImage&&(h=a.backgroundImage)},a&&e.setProperties(a);var i=n.scale9Panel(0,0,e.width,e.height,{img:W.getImage(h),left:3,top:3,right:2,bottom:2});i.ignoreEvents=!0,e.addChild(i),e.render=function(a){if(a=!!a,this.needsRendering){i.render();var b=0;if(g&&fontMed){b=10;var f=6;fontMed.write(e.ctx,g,b,f,0)}if(c){e.ctx.fillStyle="rgba(255,255,255,0.7)";var h=9,j=b+d*h+8;e.ctx.fillRect(j,4,2,e.height-8)}}return this.needsRendering=!1,a?e.canvas:void e.parentCtx.drawImage(e.canvas,e.left,e.top,e.width,e.height)},e.setValue=function(a,b){g=a,e.refresh(),!b&&e.onChange&&e.onChange(g)},e.getValue=function(){return g},e.getItemAtPosition=function(a,b){b-=startY;var c=Math.floor(b/lineHeight)+visibleIndex;return c>=0&&c<items.length?items[c]:void 0},e.onClick=function(){b||e.activate()},e.activate=function(){d=-1,!b&&g&&(d=g.length-1),b=!0,Z.setFocusElement(e),j()},e.deActivate=function(){b&&(c=!1,b=!1,e.refresh(),Z.clearFocusElement())},e.onKeyDown=function(a,b){var c=!1;switch(a){case 8:g&&(g=g.substr(0,d)+g.substr(d+1),d--,e.onChange&&e.onChange(g)),c=!0;break;case 13:e.deActivate(),c=!0;break;case 37:d>0&&d--,e.refresh(),c=!0;break;case 39:g&&(d++,d=Math.min(d,g.length-1),e.refresh()),c=!0;break;case 46:c=!0}if(!c&&a>31){var f=b.key;1==f.length&&f.match(/[a-z0-9\._\-\ #]/i)&&(g=g.substr(0,d+1)+f+g.substr(d+1),e.onChange&&e.onChange(g),d++,e.refresh()),c=!0}return c};var j=function(){b&&(c=!c,e.refresh(),setTimeout(j,200))};return e},n.knob=function(a){var b=n.element();b.type="knob";var c,d="",e="left",f=0,g=0,h=50,i=h,j=["left","top","width","height","name","font","label","textAlign","paddingTop"],k=W.getImage("knob_back"),l=W.getImage("knob_front"),m=16;return b.width=k.width+2*m,b.height=k.height+2*m,b.setSize(b.width,b.height),b.setProperties=function(a){j.forEach(function(g){if("undefined"!=typeof a[g])switch(g){case"label":d=a[g];break;case"font":c=a[g];break;case"textAlign":e=a[g];break;case"paddingTop":f=parseInt(a[g]);break;default:b[g]=a[g]}}),b.setSize(b.width,b.height),b.setPosition(b.left,b.top)},b.setFont=function(a){c=a,b.refresh()},b.setLabel=function(a){d=a,b.refresh()},b.getLabel=function(){return d},b.setValue=function(a){g=a,b.refresh()},b.render=function(a){if(b.needsRendering){a=!!a,b.clearCanvas();var c=1;c=.8;var e=k.width*c,f=k.height*c,g=e/2,i=f/2;b.ctx.save(),b.ctx.translate(m+g,m+i),b.ctx.drawImage(k,-g,-i,e,f);var j=-230,n=50,o=Math.abs(j)+n,p=j+h/100*o,q=j*Math.PI/180,r=p*Math.PI/180;b.ctx.fillStyle="rgba(130,200,255,0.5)",b.ctx.beginPath(),b.ctx.arc(0,0,30,q,r,!1),b.ctx.arc(0,0,25,r,q,!0),b.ctx.fill();var s=h/100*320-160;if(b.ctx.rotate(s*Math.PI/180),b.ctx.drawImage(l,-g,-i,e,f),b.ctx.restore(),d){var t=(b.width-6*d.length)/2;t=m+g-3*d.length,fontSmall.write(b.ctx,d,t,f+m+4)}}return b.needsRendering=!1,a?b.canvas:void b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)},b.onDragStart=function(){i=h},b.onDrag=function(a){var c=a.dragY-a.startY;h=i+c,h=Math.max(h,0),h=Math.min(h,100),b.refresh(),b.onChange&&b.onChange(h)},b},n.label=function(a){var b=n.element();b.type="label";var c,d="",e="left",f=0,g=["left","top","width","height","name","font","label","textAlign","paddingTop"];return b.setProperties=function(a){g.forEach(function(g){if("undefined"!=typeof a[g])switch(g){case"label":d=a[g];break;case"font":c=a[g];break;case"textAlign":e=a[g];break;case"paddingTop":f=parseInt(a[g]);break;default:b[g]=a[g]}}),b.setSize(b.width,b.height),b.setPosition(b.left,b.top)},b.setFont=function(a){c=a,b.refresh()},b.setLabel=function(a){d=a,b.refresh()},b.render=function(a){if(b.needsRendering&&(a=!!a,b.clearCanvas(),d)){var g=10,h=8,i=Math.floor((b.height-g)/2)+f,j=10;if(c){var k;"center"==e&&(k=d.length*h,j=Math.floor((b.width-k)/2)),"right"==e&&(k=d.length*h,j=Math.floor(b.width-k)-10),c.write(b.ctx,d,j,i,0)}else b.ctx.fillStyle="white",b.ctx.fillText(d,j,i)}return b.needsRendering=!1,a?b.canvas:void b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)},a&&b.setProperties(a),b},n.listbox=function(a,b,c,d){function e(){var a=i.length;k=Math.floor(g.height/l),g.centerSelection&&(k=1);var b=18,c=b,d=g.height-4-32,e=d;o=0,a>k&&(e=Math.floor(k/a*d),e<12&&(e=12),o=(d-e)/(a-k)),j&&o&&(c=Math.floor(b+o*j)),t.setProperties({left:g.width-18,top:c,width:16,height:e})}function f(){var a=i.length-1;return g.centerSelection||(a=i.length-k),a<0&&(a=0),a}var g=n.element(a,b,c,d,!0);g.selectedIndex=0;var h=0,i=[],j=0,k=0,l=18,m=10,o=0,p=["left","top","width","height","name","type","onChange","selectedIndex","centerSelection"];g.setProperties=function(a){p.forEach(function(b){"undefined"!=typeof a[b]&&(g[b]=a[b])}),g.setSize(g.width,g.height),g.setPosition(g.left,g.top),q.setSize(g.width,g.height),e(),r.setProperties({left:g.width-18,top:2,width:16,height:16,label:"↑"}),s.setProperties({left:g.width-18,top:g.height-19,width:16,height:16,label:"↓"}),g.centerSelection&&(m=Math.ceil((g.height-l)/2))},g.setSelectedIndex=function(a,b){g.selectedIndex=a,g.centerSelection&&(j=g.selectedIndex),g.refresh(),!b&&g.onChange&&h!=g.selectedIndex&&g.onChange(),h=g.selectedIndex},g.getSelectedIndex=function(){return g.selectedIndex};var q=n.scale9Panel(0,0,g.width,g.height,{img:W.getImage("panel_dark"),left:3,top:3,right:2,bottom:2});q.ignoreEvents=!0,g.addChild(q);var r=n.Assets.generate("button20_20");g.addChild(r),r.onClick=function(){g.navigateUp()};var s=n.Assets.generate("button20_20");g.addChild(s),s.onClick=function(){g.navigateDown()};var t=n.scale9Panel(c-28,18,16,d-3,{img:W.getImage("bar"),left:2,top:2,right:3,bottom:3});return t.onDragStart=function(){t.startDragIndex=j},t.onDrag=function(a){if(i.length>k&&o){var b=a.dragY-a.startY;j=Math.floor(t.startDragIndex+b/o),j=Math.min(j,f()),j=Math.max(j,0),e(),g.centerSelection&&g.setSelectedIndex(j)}},g.addChild(t),g.navigateUp=function(){j>0&&(j--,e()),g.centerSelection?g.setSelectedIndex(j):g.refresh()},g.navigateDown=function(){j<f()&&(j++,e()),g.centerSelection?g.setSelectedIndex(j):g.refresh()},g.render=function(a){if(a=!!a,g.isVisible()){if(this.needsRendering){q.render();for(var b=W.getImage("line_hor"),c=0,d=i.length;c<d;c++){var e=i[c],f=10,h=10,k=m+(c-j)*l;k>0&&k<g.height&&(g.selectedIndex==c&&(g.ctx.fillStyle="rgba(100,100,255,0.1",g.ctx.fillRect(0,k-4,g.width-2,l)),e.level&&(f+=e.level*h),e.icon&&(g.ctx.drawImage(e.icon,f,k-2),f+=e.icon.width+4),fontMed&&fontMed.write(g.ctx,e.label,f,k,0),k+=11,b&&g.ctx.drawImage(b,0,k,g.width-2,2))}t.render(),r.render(),s.render()}return this.needsRendering=!1,a?g.canvas:void g.parentCtx.drawImage(g.canvas,g.left,g.top,g.width,g.height)}},g.setItems=function(a){i=a,j=Math.min(j,f()+1),e(),g.refresh()},g.getItems=function(){return i},g.getItemAtPosition=function(a,b){b-=m;var c=Math.floor(b/l)+j;return c>=0&&c<i.length?i[c]:void 0},g.insertItemAfterIndex=function(a,b,c){},g.onMouseWheel=function(a){a.mouseWheels[0]>0?g.navigateUp():g.navigateDown()},g.onDragStart=function(a){g.startDragIndex=j},g.onDrag=function(a){if(i.length>k){var b=Math.round((a.dragY-a.startY)/l);j=g.startDragIndex-b,j=Math.max(j,0),j=Math.min(j,f()),g.centerSelection&&g.setSelectedIndex(j),e()}},g},n.menu=function(a,b,c,d){var e,f=n.element(a,b,c,d),g=["left","top","width","height","name","type"];return f.setProperties=function(a){g.forEach(function(b){"undefined"!=typeof a[b]&&(f[b]=a[b])}),f.setSize(f.width,f.height),f.setPosition(f.left,f.top)},f.onClick=function(a){if(e&&e.length){var b,c=a.x,d=0,g=e.length;for(b=0;b<g&&!(c<e[b].startX);b++)d=b;for(selectedItem=e[d],b=0;b<g;b++)b!==d&&e[b].subMenu&&e[b].subMenu.hide();selectedItem&&(selectedItem.subMenu&&(selectedItem.subMenu.setPosition(selectedItem.startX||0,f.height),selectedItem.subMenu.toggle(),selectedItem.subMenu.parent.refresh()),selectedItem.command&&E.trigger(p.command,selectedItem.command))}},f.render=function(a){if(a=!!a,this.needsRendering){var b=10,c=10,d=9,g=24;e.forEach(function(a){a.startX=b,fontMed.write(f.ctx,a.label,b,c),b+=a.label.length*d+g})}return this.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top,f.width,f.height)},f.setItems=function(a){e=a,e.forEach(function(a){if(a.subItems){var b=n.submenu();b.setProperties({background:n.Assets.buttonLightScale9}),b.hide(),b.setItems(a.subItems),b.zIndex=200,f.parent.addChild(b),a.subMenu=b}}),f.zIndex=9,f.refresh()},f.getItems=function(){return e},f.getItemAtPosition=function(a,b){b-=startY;var c=Math.floor(b/lineHeight)+visibleIndex;return c>=0&&c<e.length?e[c]:void 0},f},n.modalDialog=function(a){var b=n.element(),c="test",d=["left","top","width","height","name","ok"];b.setProperties=function(a){d.forEach(function(c){"undefined"!=typeof a[c]&&(b[c]=a[c])}),b.setSize(b.width,b.height),b.setPosition(b.left,b.top);var c=200;b.height<c&&(c=b.height-20);var g=Math.max(Math.floor(b.width/2),380);e.setSize(g,c),e.setPosition((b.width-g)/2,(b.height-c)/2),f.setPosition(e.left+e.width/2-50,e.top+e.height-40)};var e=n.scale9Panel(0,0,b.width/2,200,n.Assets.panelMainScale9);e.ignoreEvents=!0,b.addChild(e);var f=n.Assets.generate("buttonLight");return f.setProperties({label:"OK",width:100,height:28}),b.addChild(f),b.render=function(a){if(a=!!a,this.needsRendering){if(b.ctx.fillStyle="rgba(0,0,0,0.6)",b.ctx.fillRect(0,0,b.width,b.height),e.render(),c){var d=c.split("/"),g=e.top+20,h=e.width-20,i=9;d.forEach(function(a){var c=10;if(fontMed){var d=a.length*i;c=e.left+10+Math.floor((h-d)/2),fontMed.write(b.ctx,a,c,g,0)}g+=12})}b.ok&&f.render()}return this.needsRendering=!1,a?b.canvas:void b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)},b.setText=function(a){c=a},b.getText=function(){return c},b.close=function(){b.hide(),b.onClose&&b.onClose(),n.removeModalElement(),delete b},b},n.panel=function(a,b,c,d){var e=n.element(a,b,c,d);e.type="panel";var f=["left","top","width","height","name","type","zIndex","backgroundColor","borderColor"];return e.setProperties=function(a){f.forEach(function(b){"undefined"!=typeof a[b]&&(e[b]=a[b])}),e.setSize(e.width,e.height),e.setPosition(e.left,e.top),e.setLayout&&e.setLayout(e.left,e.top,e.width,e.height)},e.render=function(a){if(e.isVisible())return a=!!a,this.needsRendering&&(e.clearCanvas(),e.backgroundColor&&(e.ctx.fillStyle=e.backgroundColor,e.ctx.fillRect(0,0,e.width,e.height)),e.borderColor&&(e.ctx.fillStyle=e.borderColor,e.ctx.rect(0,0,e.width,e.height),e.ctx.stroke()),this.children.forEach(function(a){a.render()})),e.renderInternal&&e.renderInternal(),this.needsRendering=!1,a?e.canvas:void e.parentCtx.drawImage(e.canvas,e.left,e.top,e.width,e.height)},e.onClick=function(){},e.sortZIndex=function(){this.children.sort(function(a,b){return a.zIndex==b.zIndex?0:a.zIndex>b.zIndex||-1})},e},n.radioGroup=function(a,b,c,d){var e,f,g,h=n.element(a,b,c,d,!0),i=[],j=0,k="small",l="right",m=-3,o=13,p=["left","top","width","height","name","type"];return h.setProperties=function(a){p.forEach(function(b){"undefined"!=typeof a[b]&&(h[b]=a[b])}),h.setSize(h.width,h.height),h.setPosition(h.left,h.top),a.align&&(l=a.align),a.size&&(k=a.size),a.divider&&(f=a.divider),a.highLightSelection&&(g=!0)},h.onClick=function(a){h.setSelectedIndex(Math.floor((h.eventY-j+m)/o))},h.setSelectedIndex=function(a,b){a=Math.min(a,i.length-1);for(var c=0,d=i.length;c<d;c++)i[c].active=c==a;h.selectedIndex=a,h.refresh(),!b&&h.onChange&&e!=h.selectedIndex&&h.onChange(h.selectedIndex),e=h.selectedIndex},h.getSelectedIndex=function(){return h.selectedIndex},h.getSelectedItem=function(){return i[h.selectedIndex]},h.render=function(a){if(a=!!a,this.needsRendering){h.clearCanvas();var b=W.getImage("radio_active"),c=W.getImage("radio_inactive");o=Math.floor(h.height/i.length);var d=fontSmall,e=5,n=h.width-15;m=-3,"med"==k&&(b=W.getImage("radio_big_active"),c=W.getImage("radio_big_inactive"),m=-6,n=h.width-20,d=fontMed);var p=(o-d.charHeight)/2;"left"==l&&(e=30,n=5);for(var q=W.getImage("line_hor"),r=0,s=i.length;r<s;r++){var t=i[r],u=j+r*o,v=u+p;"line"==f&&r>0&&h.ctx.drawImage(q,0,u,h.width,2),d&&d.write(h.ctx,t.label,e,v,0),t.active?(g&&(h.ctx.fillStyle="rgba(100,100,255,0.1",h.ctx.fillRect(0,u,h.width-2,o)),
h.ctx.drawImage(b,n,v+m)):h.ctx.drawImage(c,n,v+m)}}return this.needsRendering=!1,a?h.canvas:void h.parentCtx.drawImage(h.canvas,h.left,h.top,h.width,h.height)},h.setItems=function(a){h.selectedIndex=void 0,i=a;for(var b=0,c=i.length;b<c;b++)i[b].active&&(h.selectedIndex=b);h.refresh()},h.getItemAtPosition=function(a,b){b-=j;var c=Math.floor(b/o)+visibleIndex;return c>=0&&c<i.length?(i[c].index=c,i[c]):void 0},h},n.rangeSlider=function(a){var b=n.element();b.type="rangeslider";var c=["left","top","width","height","name","onChange"],d=W.getImage("slider_knob"),e=W.getImage("slider_back"),f=n.scale9Panel(0,0,0,0,{img:e,left:4,right:4,top:0,bottom:0,scale:"repeat"});b.addChild(f),f.ignoreEvents=!0;var g=0,h=0,i=0,j=100,k=0;return b.setProperties=function(a){c.forEach(function(c){"undefined"!=typeof a[c]&&(b[c]=a[c])}),b.setSize(b.width,b.height),b.setPosition(b.left,b.top),"undefined"!=typeof a.min&&(i=a.min),"undefined"!=typeof a.max&&(j=a.max),"undefined"!=typeof a.value&&b.setValue(a.value,!0)},b.getValue=function(){return k},b.setValue=function(a,c){a>j&&(a=j),a<i&&(a=i);var e=!c&&k!==a;k=a;var f=b.width-d.width;g=f*a/j,b.refresh(),e&&b.onChange&&b.onChange(k)},b.render=function(a){return b.needsRendering&&(a=!!a,b.clearCanvas(),f.render(),b.ctx.drawImage(d,g,-1,d.width,d.height)),b.needsRendering=!1,a?b.canvas:void b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)},b.onResize=function(){f.setSize(b.width,b.height),b.setValue(k,!0)},b.onDragStart=function(){h=g},b.onDrag=function(a){var c=a.dragX-a.startX;g=h+c,g<0&&(g=0);var e=b.width-d.width;g>e&&(g=e),k=e>d.width?Math.round(j*g/e):0,b.refresh(),b.onChange&&b.onChange(k)},a&&b.setProperties(a),b},n.scale9Panel=function(a,b,c,d,e){var f=n.element(a,b,c,d,!0);f.type="scale9",f.setProperties=function(a){var b=["left","top","width","height","name","type"];if(!a){var c={};return b.forEach(function(a){c[a]=f[a]}),c}b.forEach(function(b){"undefined"!=typeof a[b]&&(f[b]=a[b])}),f.setSize(f.width,f.height),f.setPosition(f.left,f.top)};var g=function(){var a=e.img;if(a){var b=a.width-e.left-e.right,c=a.height-e.top-e.bottom,d=f.width-e.left-e.right,g=f.height-e.top-e.bottom;f.clearCanvas(),f.ctx.drawImage(a,0,0,e.left,e.top,0,0,e.left,e.top),f.ctx.drawImage(a,e.left,0,b,e.top,e.left,0,d,e.top),f.ctx.drawImage(a,e.left+b,0,e.right,e.top,e.left+d,0,e.right,e.top),f.ctx.drawImage(a,0,e.top,e.left,c,0,e.top,e.left,g),f.ctx.drawImage(a,e.left,e.top,b,c,e.left,e.top,d,g),f.ctx.drawImage(a,e.left+b,e.top,e.right,c,e.left+d,e.top,e.right,g),f.ctx.drawImage(a,0,e.top+c,e.left,e.bottom,0,e.top+g,e.left,e.bottom),f.ctx.drawImage(a,e.left,e.top+c,b,e.bottom,e.left,e.top+g,d,e.bottom),f.ctx.drawImage(a,e.left+b,e.top+c,e.right,e.bottom,e.left+d,e.top+g,e.right,e.bottom)}};return f.render=function(a){return a=!!a,f.needsRendering&&g(),f.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top)},f},n.submenu=function(a,b,c,d){var e,f,g,h,i=n.element(a,b,c,d),j=26,k=["left","top","width","height","name","type"],l=9,m=9,o=9;return i.setProperties=function(a){k.forEach(function(b){"undefined"!=typeof a[b]&&(i[b]=a[b])}),a.background&&(f=n.scale9Panel(0,0,i.width,i.height,a.background),f.ignoreEvents=!0,i.addChild(f)),i.setSize(i.width,i.height),i.setPosition(i.left,i.top)},i.onHover=function(a){var b=Math.floor(i.eventY/j);b!=h&&(g=b,h=g,i.refresh())},i.onHoverExit=function(){g&&(g=void 0,h=void 0,i.refresh())},i.onClick=function(a){if(e&&e.length){var b=e[Math.floor(i.eventY/j)];b&&b.command&&(i.hide(),i.parent.refresh(),E.trigger(p.command,b.command))}},i.render=function(a){if(i.isVisible()){if(a=!!a,this.needsRendering){f&&f.render();for(var b=W.getImage("line_hor"),c=0,d=0,h=i.width-3,k=e.length-1,n=0;n<=k;n++){var o=e[n];n==g&&(i.ctx.fillStyle="rgba(255,255,255,0.2)",i.ctx.fillRect(d,c,h,j)),o.label&&fontMed.write(i.ctx,o.label,d+m,c+l),c+=j,n<k&&i.ctx.drawImage(b,d,c,h,2)}}return this.needsRendering=!1,a?i.canvas:void i.parentCtx.drawImage(i.canvas,i.left,i.top,i.width,i.height)}},i.setItems=function(a){e=a;var b=50;e.forEach(function(a){var c=a.label?a.label.length*o:0;c+=2*m+6,b=Math.max(b,c)});var c=e.length*j+4;i.setSize(b,c),f&&f.setSize(i.width,i.height),i.refresh()},i.getItems=function(){return e},i},n.DiskOperationActions=function(){var a=n.panel(),b=n.scale9Panel(0,0,20,20,n.Assets.panelDarkInsetScale9);b.ignoreEvents=!0,a.addChild(b);var c=n.scale9Panel(0,0,20,20,n.Assets.panelDarkGreyScale9);c.ignoreEvents=!0,a.addChild(c);var d=n.label({label:"Load",font:fontSmall});a.addChild(d);var e=n.radioGroup();e.setProperties({align:"right",size:"med",divider:"line",highLightSelection:!0}),e.setItems([{label:"module",active:!0,fileType:s.module},{label:"sample",active:!1,fileType:s.sample}]),e.onChange=function(a){E.trigger(p.diskOperationTargetChange,this.getSelectedItem())},a.addChild(e);var f=n.button();return f.setProperties({label:"Exit",textAlign:"center",background:n.Assets.buttonLightScale9,font:window.fontMed}),f.onClick=function(){H.doCommand(q.showTop)},a.addChild(f),a.setLayout=function(){var g=a.width-2,h=70;a.height<100?(f.hide(),h=a.height-20):f.show(),n.mainPanel&&(a.clearCanvas(),b.setProperties({left:0,top:0,height:a.height,width:a.width}),c.setProperties({left:1,top:1,height:16,width:g}),d.setProperties({left:-1,top:3,height:16,width:g}),e.setProperties({left:4,width:g-4,height:h,top:18}),f.setProperties({left:2,width:g,height:30,top:a.height-29}))},a.getAction=function(){var a=e.getSelectedIndex(),b="modules";return 1==a&&(b="samples"),2==a&&(b="patterns"),b},a},n.DiskOperationSave=function(){function a(){var a=b,c=b.lastIndexOf("."),d="";c>=0&&(a=b.substr(0,c),d=b.substr(c));var e=l.getSelectedItem();e&&e.extention&&(d=e.extention),o.setValue(a+d)}var b,c=n.panel(),d=s.module,f=s.module,g=n.scale9Panel(0,0,20,20,n.Assets.panelDarkInsetScale9);g.ignoreEvents=!0,c.addChild(g);var h=n.scale9Panel(0,0,20,20,n.Assets.panelDarkGreyScale9);h.ignoreEvents=!0,c.addChild(h);var j=n.label({label:"Export Module as",font:fontSmall});c.addChild(j);var k={};k[s.module]=[{label:"module",active:!0,extention:".mod",fileType:s.module},{label:"wav",active:!1,extention:".wav",fileType:s.sample}],k[s.sample]=[{label:"wav 16 bit",active:!1,extention:".wav",fileType:s.sample},{label:"wav 8 bit",active:!0,extention:".wav",fileType:s.sample},{label:"RAW 8 bit",active:!1,extention:".sample",fileType:s.sample}];var l=n.radioGroup();l.setProperties({align:"right",size:"med",divider:"line",highLightSelection:!0}),l.setItems(k[s.module]),l.onChange=function(b){var c=this.getSelectedItem();d=c&&c.fileType?c.fileType:s.module,a()},c.addChild(l);var m=n.button();m.setProperties({label:"Export",textAlign:"center",background:n.Assets.buttonLightScale9,font:window.fontMed}),m.onClick=function(){if(f==s.module&&(d==s.module&&U.save(b),d==s.sample&&U.renderTrackToBuffer(b)),f==s.sample){var a=U.getCurrentSample();if(a){var c=a.length,g=new ArrayBuffer(c),h=new e(g,!0);h.clear(2);var j;for(i=0;i<a.length-2;i++)j=a.data[i]||0,h.writeByte(Math.round(127*j));var k=new Blob([h.buffer],{type:"application/octet-stream"});G(k,b)}}},c.addChild(m);var o=n.inputbox({name:"fileNameInput",height:20,onChange:function(a){b=a},backgroundImage:"panel_mid"});return c.addChild(o),E.on(p.songPropertyChange,function(c){b=c.filename||"",a()}),E.on(p.diskOperationTargetChange,function(a){if(a&&a.fileType){f=a.fileType;var c="Export as";f==s.sample&&(c="Export Sample as",b=U.getCurrentSample().name.replace(/ /g,"-").replace(/\W/g,"")),f==s.module&&(c="Export Module as",b=U.getFileName()),j.setLabel(c),k[f]&&(l.setItems(k[f]),l.onChange())}}),E.on(p.sampleChange,function(d){c.isVisible()&&f==s.sample&&(b=U.getCurrentSample().name.replace(/ /g,"-").replace(/\W/g,"")||"Sample-"+U.getCurrentSampleIndex(),a())}),c.setLayout=function(){var a=c.width-2;n.mainPanel&&(c.clearCanvas(),g.setProperties({left:0,top:0,height:c.height,width:c.width}),h.setProperties({left:1,top:1,height:16,width:a}),j.setProperties({left:-1,top:3,height:16,width:a}),o.setProperties({left:6,width:a-8,top:24}),l.setProperties({left:4,width:a-4,height:64,top:48}),m.setProperties({left:2,width:a,height:30,top:c.height-29}))},c},n.DiskOperationTargets=function(){var a=n.panel(),b="bassoon",c=n.scale9Panel(0,0,20,20,n.Assets.panelDarkInsetScale9);c.ignoreEvents=!0,a.addChild(c);var d=n.scale9Panel(0,0,20,20,n.Assets.panelDarkGreyScale9);d.ignoreEvents=!0,a.addChild(d);var e=n.label({label:"From",font:fontSmall});a.addChild(e);var f=[{label:"Bassoon:",target:"bassoon",active:!0},{label:"Modarchive:",target:"modarchive"},{label:"Modules.pl:",target:"modulespl"},{label:"local:",target:"local"}],g=n.radioGroup();return g.setProperties({align:"right",size:"med",divider:"line",highLightSelection:!0}),g.setItems(f),g.onChange=function(a){E.trigger(p.diskOperationTargetChange,this.getSelectedItem())},a.addChild(g),E.on(p.diskOperationTargetChange,function(a){a&&a.fileType&&g.setSelectedIndex(0)}),a.setLayout=function(){var b=a.width-3;if(n.mainPanel){a.clearCanvas(),c.setProperties({left:0,top:0,height:a.height,width:a.width}),d.setProperties({left:2,top:1,height:16,width:b}),e.setProperties({left:-1,top:3,height:16,width:b});var f=18;g.setProperties({width:b,height:a.height-f-2,left:2,top:f})}},a.getTarget=function(){return b},a},n.DiskOperations=function(){function a(a,d){v.setSelectedIndex(d),k=d,a.isExpanded?(a.isExpanded=!1,b.refreshList()):(a.isExpanded=!0,a.children.length?b.refreshList():(a.children=[{title:"loading ..."}],b.refreshList(),c?c.get(a.url,function(b){l(a,b)}):I.json(a.url,function(b){l(a,b)})))}var b=n.panel();b.hide();var c,d="modules",e=[],f=[],g=[],h=[],i=[],j=0,k=0,l=function(){},m=n.scale9Panel(0,0,20,20,n.Assets.panelMainScale9);m.ignoreEvents=!0,b.addChild(m);var o=n.DiskOperationActions();b.addChild(o);var q=n.DiskOperationTargets();b.addChild(q);var r=n.DiskOperationSave();b.addChild(r);var t=n.label({label:"Load module",font:fontMed});b.addChild(t);var u=n.Assets.generate("button20_20");u.setLabel("x"),u.onClick=function(){n.mainPanel.setView("main")},b.addChild(u);var v=n.listbox();b.addChild(v);var w=n.button();return w.setProperties({background:n.Assets.buttonDarkActiveScale9,image:W.getImage("dropzone"),font:fontSmall,textAlign:"center"}),b.addChild(w),w.hide(),E.on(p.diskOperationTargetChange,function(a){a&&a.target&&(a=a.target),a&&a.fileType&&(a.fileType==s.module&&(a="modules"),a.fileType==s.sample&&(a="samples")),"undefined"==typeof a&&(a=q.getTarget()),b.refreshList(a)}),b.setLayout=function(a){if(n.mainPanel){b.clearCanvas(),m.setProperties({left:0,top:0,height:b.height,width:b.width});var c=5;u.setProperties({top:c-2,width:20,heigth:18,left:b.width-30}),b.width>=730?(o.setProperties({top:c,left:n.mainPanel.defaultMargin,width:n.mainPanel.col1W,height:b.height-10}),q.setProperties({top:c,left:n.mainPanel.col2X,width:n.mainPanel.col1W,height:b.height-10}),t.setProperties({left:n.mainPanel.col3X,top:c,height:20,width:n.mainPanel.col2W}),v.setProperties({left:n.mainPanel.col3X,width:n.mainPanel.col2W,top:c+19,height:b.height-(19+c)-5}),r.show(),r.setProperties({top:v.top,left:n.mainPanel.col5X,width:n.mainPanel.col1W,height:v.height})):(o.setProperties({top:c,left:n.mainPanel.defaultMargin,width:n.mainPanel.col2W,height:b.height/2-c-16}),q.setProperties({top:b.height/2-16,left:n.mainPanel.defaultMargin,width:n.mainPanel.col2W,height:b.height/2+16}),v.setProperties({left:n.mainPanel.col3X,width:n.mainPanel.col3W,top:c+19,height:b.height-(19+c)-5}),t.setProperties({left:n.mainPanel.col3X,top:c,height:20,width:n.mainPanel.col3W}),"save"==a?(r.setProperties({left:n.mainPanel.defaultMargin,width:n.mainPanel.col2W,top:c,height:b.height-10}),o.hide(),q.hide(),r.show()):(o.show(),q.show(),r.hide())),w.setProperties({left:v.left,width:v.width,top:v.top,height:v.height})}},b.refreshList=function(m){function p(a,b){a.forEach(function(a){var c=W.getImage("modules"==d?"module":"sample");a.children&&(c=W.getImage("disk")),r.push({label:a.title,data:a,level:b,index:s,icon:c}),e[s]=a,s++,a.children&&a.children.length&&a.isExpanded&&p(a.children,b+1)})}function q(a,b){e=[],s=0,b=b||0,p(a,0),v.setItems(r),v.setSelectedIndex(b)}var r=[],s=0;switch(d!=m&&v.setSelectedIndex(0,!0),d=m||d,"local"==d?(v.hide(),w.show()):(v.show(),w.hide(),"bassoon"==d&&(d=o.getAction())),d){case"modules":c=!1,t.setLabel("Load Module"),v.onClick=function(b){var c=v.getItemAtPosition(v.eventX,v.eventY);if(c&&c.data){var d=c.index;c=e[d],c.children?a(c,d):(v.setSelectedIndex(d),U.load(c.url),n.mainPanel.setView("main"))}},f.length?q(f,k):I.json("data/modules.json",function(a){a&&a.modules&&(f=a.modules,q(f,k))});break;case"modarchive":c=ea,t.setLabel("Browse Modarchive"),v.onClick=function(b){var c=v.getItemAtPosition(v.eventX,v.eventY);if(c&&c.data){var d=c.index;c=e[d],c.children?a(c,d):(v.setSelectedIndex(d),U.load(c.url),n.mainPanel.setView("main"))}},l=function(a,c){c&&c.length?"... load more ..."==a.title&&a.parent?(a=a.parent,c.forEach(function(b){b.parent=a}),a.children.pop(),a.children=a.children.concat(c)):(c.forEach(function(b){b.parent=a}),a.children=c):a.children=[{title:"error loading data"}],b.refreshList()},h.length?q(h,0):(v.setItems([{label:"loading ..."}]),I.json("data/modarchive.json",function(a){a&&a.modarchive&&(h=a.modarchive,q(h,0))}));break;case"modulespl":c=fa,t.setLabel("Browse Modules.pl"),v.onClick=function(b){var c=v.getItemAtPosition(v.eventX,v.eventY);if(c&&c.data){var d=c.index;c=e[d],c.children?a(c,d):(v.setSelectedIndex(d),U.load(c.url),n.mainPanel.setView("main"))}},l=function(a,c){c&&c.length?"... load more ..."==a.title&&a.parent?(a=a.parent,c.forEach(function(b){b.parent=a}),a.children.pop(),a.children=a.children.concat(c)):(c.forEach(function(b){b.parent=a}),a.children=c):a.children=[{title:"error loading data"}],b.refreshList()},i.length?q(i,0):(v.setItems([{label:"loading ..."}]),I.json("data/modulespl.json",function(a){a&&a.modulespl&&(i=a.modulespl,q(i,0))}));break;case"dropbox":c=da,t.setLabel("Browse Your Dropbox"),v.setItems([{label:"loading ..."}]),v.onClick=function(b){var c=v.getItemAtPosition(v.eventX,v.eventY);if(c&&c.data){var d=c.index;c=e[d],c.children?a(c,d):(v.setSelectedIndex(d),n.setInfo(c.title),n.setStatus("Loading from Dropbox"),da.getFile(c.url,function(a){var b=new FileReader;b.onload=function(){U.processFile(b.result,c.title,function(a){n.setStatus("Ready"),n.mainPanel.setView("main")})},b.readAsArrayBuffer(a)}))}},da.list("",function(a){q(a,0)});break;case"samples":c=!1,t.setLabel("Load Sample to slot "+U.getCurrentSampleIndex()),v.onClick=function(a){var c=v.getItemAtPosition(v.eventX,v.eventY);if(c&&c.data){var d=c.index;c=e[d],c.children?(v.setSelectedIndex(d),j=d,c.isExpanded?(c.isExpanded=!1,b.refreshList()):(c.isExpanded=!0,c.children.length?b.refreshList():I.json(c.url,function(a){a&&a.samples&&(c.children=a.samples,b.refreshList())}))):(v.setSelectedIndex(d),U.load(c.url))}},l=function(a,c){c&&c.samples&&(a.children=c.samples,b.refreshList())},g.length?q(g,j):I.json("data/samples.json",function(a){a&&a.samples&&(g=a.samples,q(g,j))});break;case"local":c=!1,t.setLabel("Upload files")}},b.playRandomSong=function(){n.setStatus("Fetching random song"),n.setInfo(""),I.json("https://www.stef.be/bassoontracker/api/random",function(a){a&&a.modarchive&&a.modarchive.module&&U.load(a.modarchive.module.url)})},E.on(p.sampleChange,function(a){b.isVisible()&&"samples"==d&&t.setLabel("Load Sample to slot "+U.getCurrentSampleIndex())}),b},n.editPanel=function(a,b,c,d,e){var f=n.element(a,b,c,d,e);f.type="EditPanel";var g=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);f.addChild(g);for(var h=["clear","copy","paste"],i=function(a){switch(a.index){case 0:U.clearTrack(),n.setStatus("Track cleared");break;case 1:U.clearPattern(),n.setStatus("Pattern cleared");break;case 2:U.copyTrack(),n.setStatus("Track copied");break;case 3:U.copyPattern(),n.setStatus("Pattern copied");break;case 4:n.setStatus(U.pasteTrack()?"Track pasted":"Nothing to paste!");break;case 5:n.setStatus(U.pastePattern()?"Pattern pasted":"Nothing to paste!")}},j=[],k=0;k<6;k++){var l;l=n.Assets.generate("buttonDark"),l.index=k,l.onClick=function(){i(this)},l.setProperties({label:"  "+h[Math.floor(k/2)],font:fontSmall,textAlign:"center",paddingTop:3}),f.addChild(l),j.push(l)}var m=["left","top","width","height","name","type"];return f.setProperties=function(a){m.forEach(function(b){if("undefined"!=typeof a[b])switch(b){default:f[b]=a[b]}}),f.setSize(f.width,f.height),f.setPosition(f.left,f.top),g.setSize(f.width,f.height);for(var b=Math.floor(f.width/2)-2,c=21,d=0;d<6;d++){var e=d%2,h=Math.floor(d/2);j[d].setProperties({left:e*b+2,width:b,top:25+h*c,height:c})}},f.render=function(a){if(a=!!a,f.needsRendering){f.clearCanvas(),g.render(),window.fontMed.write(f.ctx,"↓Track",6,11,0),window.fontMed.write(f.ctx,"↓Pattern",j[1].left+6,11,0);for(var b=0;b<6;b++)j[b].render()}return f.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top,f.width,f.height)},f},n.Envelope=function(a){var b=n.element();b.type=a;var c=n.scale9Panel(0,0,b.width,b.height,{img:W.getImage("panel_dark"),left:3,top:3,right:2,bottom:2});c.ignoreEvents=!0;var d,e,f,g,h,i,j,k,l=-1;return b.onResize=function(){j=b.width/324,k=b.height/64},b.onHover=function(a){if(!f){var c=Math.round(b.eventX/j),d=Math.round((b.height-b.eventY)/k);if(l=-1,h=void 0,e){for(var g=0,m=e.count;g<m;g++){var n=e.points[g];if(Math.abs(c-n[0])<6&&Math.abs(d-n[1])<6){l=g,h={p:e.points[g],minY:0,maxY:64},0===g?(h.minX=0,h.maxX=0):(h.minX=e.points[g-1][0],h.maxX=324,g<e.count-1&&(h.maxX=e.points[g+1][0]));break}}i!==l&&(i=l,b.refresh())}}},b.onDragStart=function(a){h&&(g={startX:a.startX,startY:a.startY,pX:h.p[0],pY:h.p[1]},f=!0)},b.onDrag=function(a){if(f){g.deltaX=(g.startX-a.dragX)/j,g.deltaY=(g.startY-a.dragY)/k;var c=g.pX-g.deltaX;c=Math.min(h.maxX,c),c=Math.max(h.minX,c);var d=g.pY+g.deltaY;d=Math.min(h.maxY,d),d=Math.max(h.minY,d),h.p[0]=c,h.p[1]=d,b.refresh()}},b.onTouchUp=function(a){f=!1},b.setInstrument=function(a){d=a,e=a?a[b.type+"Envelope"]:void 0,b.refresh()},b.render=function(){if(this.needsRendering&&(c.width!==b.width&&c.setSize(b.width,b.height),b.ctx.drawImage(c.render(!0),0,0,b.width,b.height),e&&e.count)){var a=b.width/324,d=b.height/64;b.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",b.ctx.beginPath();for(var f=0;f<e.count;f++){var g=e.points[f],h=g[0]*a,i=b.height-g[1]*d,j=4,k="#D2861B";f===l&&(j=6,k="#FFFFFF"),b.ctx.fillStyle=k,0===f?b.ctx.moveTo(h,i):b.ctx.lineTo(h,i);var m=j/2;b.ctx.fillRect(h-m,i-m,j,j)}b.ctx.stroke()}this.needsRendering=!1,b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)},b},n.EnvelopePanel=function(a){var b=n.panel();b.type=a;var c,d,e=n.scale9Panel(0,0,20,20,n.Assets.panelDarkGreyScale9);e.ignoreEvents=!0,b.addChild(e);var f=n.label({label:a+" Envelope",font:fontSmall});b.addChild(f);var g=n.checkbox();g.onToggle=function(a){d&&(d.enabled=a)},b.addChild(g);var h=n.Envelope(a);return b.addChild(h),b.setInstrument=function(b){d=b[a+"Envelope"],c=b,h.setInstrument(b),g.setState(d&&d.enabled)},b.onResize=function(){e.setSize(b.width,18),f.setSize(b.width,20),g.setPosition(2,2),f.setPosition(12,2),h.setPosition(0,20),h.setSize(b.width,b.height-20)},b},n.fxPanel=function(a){function b(a,b){if(m){var c=a.getLabel();switch(c){case"volume":m.volumeValue(b);break;case"panning":m.panningValue((b-50)/50);break;case"high":m.highValue(b/100);break;case"mid":m.midValue(b/100);break;case"low":m.lowValue(b/100);break;case"lowPass":m.lowPassFrequencyValue(b/100);break;case"reverb":m.reverbValue(b)}}}var c=n.panel();c.hide(),a=a||0;var d=n.scale9Panel(0,0,20,20,n.Assets.buttonDarkScale9);d.ignoreEvents=!0,c.addChild(d);for(var e=70,f=70,g=["volume","panning","high","mid","low","lowPass","reverb"],h=0,i=10,j=0,k=g.length;j<k;j++){var l=n.knob();l.setProperties({top:h,left:i,label:g[j]}),l.onChange=function(a){b(this,a)},c.addChild(l),j%2==0?i+=e:(i=10,h+=f)}var m;return F.filterChains&&(m=F.filterChains[a]),c.setLayout=function(){n.mainPanel&&d.setSize(c.width,c.height)},c},n.InfoPanel=function(){var a,b=n.element(),c="",d="",e="",f=n.Assets.generate("buttonDark");f.setLabel("More info "),f.onClick=function(){a&&window.open(a)},b.addChild(f),E.on(p.statusChange,function(f){f&&("undefined"!=typeof f.status&&(e=f.status),"undefined"!=typeof f.info&&(c=f.info,d=f.source,a=f.url)),b.refresh()});var g=["left","top","width","height","name","type","zIndex"];return b.setProperties=function(a){g.forEach(function(c){"undefined"!=typeof a[c]&&(b[c]=a[c])}),b.setSize(b.width,b.height),b.setPosition(b.left,b.top),b.setLayout&&b.setLayout(b.left,b.top,b.width,b.height)},b.setLayout=function(){var a=b.parent.col1W,c="More info";a<100&&(c="info"),a<45&&(c="i"),f.setProperties({width:b.parent.col1W,height:26,top:2,left:b.parent.col5X-2-b.left,label:c})},b.render=function(d){if(b.isVisible()){if(d=!!d,this.needsRendering){b.clearCanvas(),a&&f.render();var g=c;e&&(g=e+": "+g),window.fontMed.write(b.ctx,g,6,11,0)}return this.needsRendering=!1,d?b.canvas:void b.parentCtx.drawImage(b.canvas,b.left,b.top,b.width,b.height)}},b};var Z=function(){function a(){if(i.length){var a=i.shift();if(a.source)try{a.source.stop()}catch(a){}}}var b={},c={};c.touches=[],c.mouseWheels=[];var d,e,f,g=0,h=!1,i=[],j={};b.init=function(){function a(a){function b(a,b,d){c.isTouchDown=!0;var f=J.getBoundingClientRect();b-=f.left+window.pageXOffset,d-=f.top+window.pageYOffset,e=n.getModalElement()||n.getEventElement(b,d);var g={id:a,x:b,y:d,startX:b,startY:d,UIobject:e};c.touches.push(g),g.UIobject&&(g.UIobject.onDragStart&&g.UIobject.onDragStart(g),g.UIobject.onTouchDown&&g.UIobject.onTouchDown(g))}if(a.preventDefault(),h||("undefined"!=typeof F&&F.playSilence&&F.playSilence(),h=!0),a.touches&&a.touches.length>0)for(var d=a.changedTouches,f=0;f<d.length;f++){var g=d[f];b(g.identifier,g.pageX,g.pageY)}else{var i=k("notouch");i>=0&&c.touches.splice(i,1),b("notouch",a.pageX,a.pageY)}}function b(a){function b(a,b,d){if(a>=0){var e=c.touches[a];e.x=b-window.pageXOffset,e.y=d-window.pageYOffset,c.touches.splice(a,1,e),c.isTouchDown&&e.UIobject&&e.UIobject.onDrag&&(e.dragX=b,e.dragY=d,e.UIobject.onDrag(e))}}a.preventDefault();var d=J.getBoundingClientRect();if(a.touches&&a.touches.length>0)for(var e=a.changedTouches,g=0;g<e.length;g++){var h=e[g];b(k(h.identifier),h.pageX-d.left,h.pageY-d.top)}else{var i=a.pageX-d.left,j=a.pageY-d.top;if(b(k("notouch"),a.pageX-d.left,a.pageY-d.top),c.currentMouseX=i,c.currentMouseY=j,c.mouseMoved=(new Date).getTime(),D.useHover){var l=n.getEventElement(i,j);l&&l.onHover&&l.onHover(c),f&&f!=l&&f.onHoverExit&&f.onHoverExit(c,l),f=l}}}function l(a){function b(a){if(a>=0){var b=c.touches[a];if(b.UIobject){var d=b.UIobject;if(d.onClick){var e=b.startX-b.x,f=b.startY-b.y,g=Math.sqrt(e*e+f*f);g<8&&d.onClick(b)}d.onTouchUp&&d.onTouchUp(b)}c.touches.splice(a,1)}}function d(){}if(c.isTouchDown=!1,a&&a.touches){for(var e=a.changedTouches,f=0;f<e.length;f++){var g=e[f];b(k(g.identifier))}0==a.touches.length&&d()}else b(k("notouch")),d()}function m(a){var b=C[D.keyboardTable]||C.azerty,c=a.keyCode,e=a.key;if(!e&&a.keyIdentifier){var f=a.keyIdentifier;f=f.replace("U+",""),e=String.fromCharCode(parseInt(f,16)).toLowerCase()}if(d&&d.onKeyDown){var g=d.onKeyDown(c,a);if(g)return}if(e&&c>40&&c<200){112==c&&(m=1),113==c&&(m=2),114==c&&(m=3);var h,k=b[e];if(k){var l=k.name+(m+k.octave);h=z[l];var m=4,n=k.index+12*m,o=S[n];o&&(h={period:o.period,note:n})}var q=!0;if(U.isRecording())if(U.getCurrentTrackPosition()>0){q=!1;var r=/[0-9A-Fa-f]/g;r.test(e)&&(U.putNoteParam(U.getCurrentTrackPosition(),parseInt(e,16)),U.moveCurrentPatternPos(1))}else h&&(U.putNote(U.getCurrentSampleIndex(),h.period),U.isPlaying()?q=!1:U.moveCurrentPatternPos(1));if(q&&h){if(j[e])return;var s=U.getCurrentSample();if(h.note&&s&&s.relativeNote){h.note+=s.relativeNote;var t=S[h.note];t&&(h.period=t.period)}return j[e]=F.playSample(U.getCurrentSampleIndex(),h.period),i.push(j[e]),void E.trigger(p.pianoNoteOn,j[e])}}switch(c){case 8:U.isRecording()?(U.putNote(0,0),U.moveCurrentPatternPos(1)):(U.playPatternStep(U.getCurrentTrackPosition()),U.moveCurrentPatternPos(-1));break;case 13:U.togglePlay();break;case 16:break;case 32:U.toggleRecord();break;case 35:U.setCurrentPatternPos(63);break;case 36:U.setCurrentPatternPos(0);break;case 37:U.moveCursorPosition(-1);break;case 38:U.moveCurrentPatternPos(-1);break;case 39:U.moveCursorPosition(1);break;case 40:U.moveCurrentPatternPos(1);break;case 46:U.isRecording()&&(U.putNote(0,0),U.moveCurrentPatternPos(1))}}function o(a){var b=a.key;if(!b&&a.keyIdentifier){var c=a.keyIdentifier;c=c.replace("U+",""),b=String.fromCharCode(parseInt(c,16)).toLowerCase()}if(!D.sustainKeyboardNotes&&j[b]&&j[b].source&&F.context){E.trigger(p.pianoNoteOff,j[b]);try{j[b].volume?j[b].volume.gain.linearRampToValueAtTime(0,F.context.currentTime+.5):j[b].source.stop()}catch(a){}}j[b]=!1}function q(a){if(c.currentMouseX){var b=c.currentMouseX,d=c.currentMouseY,e=n.getEventElement(b,d);if(e&&e.onMouseWheel){var f=a.wheelDeltaY||a.wheelDelta||-a.detail;c.mouseWheels.unshift(f),c.mouseWheels.length>10&&c.mouseWheels.pop(),e.onMouseWheel(c)}}}function r(a){a.stopPropagation(),a.preventDefault()}function s(a){a.stopPropagation(),a.preventDefault()}function t(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer,c=b.files;U.handleUpload(c)}function u(){clearTimeout(g),g=setTimeout(function(){n.setSize(window.innerWidth,window.innerHeight)},100)}J.addEventListener("mousedown",a,!1),J.addEventListener("mousemove",b,!1),J.addEventListener("mouseup",l,!1),J.addEventListener("touchstart",a,!1),J.addEventListener("touchmove",b,!1),J.addEventListener("touchend",l,!1),window.navigator.msPointerEnabled&&(J.addEventListener("MSPointerDown",a,!1),J.addEventListener("MSPointerMove",b,!1),J.addEventListener("MSPointerEnd",l,!1)),J.addEventListener("mousewheel",q,!1),J.addEventListener("DOMMouseScroll",q,!1),document.addEventListener("keydown",m,!1),document.addEventListener("keyup",o,!1),J.addEventListener("dragenter",r,!1),J.addEventListener("dragover",s,!1),J.addEventListener("drop",t,!1),H.isPlugin||window.addEventListener("resize",u,!1),H.isPlugin||u()};var k=function(a){for(var b=0;b<c.touches.length;b++)if(c.touches[b].id===a)return b;return-1};return b.setFocusElement=function(a){d&&d.deActivate&&d.deActivate(),d=a},b.clearFocusElement=function(){d&&d.deActivate&&d.deActivate(),d=void 0},b.clearInputNotes=function(){for(;i.length;)a()},b}();n.MainPanel=function(){function a(a,b){var c="boolean"!=typeof b.visible||b.visible;c&&a.setProperties({left:b.left,width:b.width,top:b.top,height:b.height})}function b(){var a=Y.getStartTrack(),b=Math.min(a+e.visibleTracks,U.getTrackCount());for(f=0;f<g.length;f++)g[f].setProperties(f>=a&&f<b?{track:f,left:e.patternViewLeft+e.patternMargin+(e.trackWidth+e.trackMargin)*(f-a),top:e.controlBarTop,width:e.trackWidth,height:e.controlBarHeight,visible:!0}:{top:-100,visible:!1})}function d(a){return a=""+a,a.length<2&&(a="0"+a),a}var e=n.panel(0,0,J.width,J.height,!0);e.name="mainPanel";var f,g=[],h="main",i=4,j=w.column5,k=c("tracks");k&&k>4&&(j=w.column5Full),"full"==c("layout")&&(j=w.column5Full);var l=j,m=n.scale9Panel(0,0,e.width,e.height,n.Assets.panelMainScale9);e.addChild(m);var o=n.scale9Panel(0,0,0,0,n.Assets.menuMainScale9);e.addChild(o);var r=n.menu(0,0,0,0);e.addChild(r),r.setProperties({zIndex:200}),r.setItems([{label:"File",subItems:[{label:"new",command:q.newFile},{label:"open module",command:q.openFile},{label:"save module",command:q.saveFile},{label:"open random song",command:q.randomSong}]},{label:"Edit",subItems:[{label:"clear track",command:q.clearTrack},{label:"clear pattern",command:q.clearPattern},{label:"clear song",command:q.clearSong},{label:"clear instruments",command:q.clearInstruments}]},{label:"View",subItems:[{label:"main",command:q.showMain},{label:"options",command:q.showOptions},{label:"file operations",command:q.showFileOperations},{label:"sample editor",command:q.showSampleEditor},{label:"piano",command:q.togglePiano}]},{label:"Help",subItems:[{label:"about",command:q.showAbout},{label:"documentation",command:q.showHelp},{label:"Sourcecode on github",command:q.showGithub}]}]);var s=n.button();s.setProperties({background:n.Assets.panelInsetScale9,activeBackground:n.Assets.buttonDarkScale9,image:W.getImage("logo_grey_70"),activeImage:W.getImage("logo_colour_70")}),s.onClick=function(){s.toggleActive()},e.addChild(s);var t=n.inputbox({name:"modName",onChange:function(a){U.getSong().title=a,n.setInfo(a)}});e.addChild(t);var u=n.listbox();u.setItems([{label:"loading ...",data:1}]),e.addChild(u),u.onClick=function(a){Z.setFocusElement(u);var b=u.getItemAtPosition(u.eventX,u.eventY);b&&U.setCurrentSampleIndex(b.data)};var v=n.InfoPanel(0,0,0,0);e.addChild(v);var x=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);e.addChild(x);var y=n.listbox();y.setItems([{label:"00:00",data:1}]),e.addChild(y);var z=n.Assets.generate("button20_20");z.setLabel("↑"),z.onClick=function(){var a=y.getSelectedIndex(),b=U.getSong().patternTable[a];b++,U.updatePatternTable(a,b)},e.addChild(z);var A=n.Assets.generate("button20_20");for(A.setLabel("↓"),A.onClick=function(){var a=y.getSelectedIndex(),b=U.getSong().patternTable[a];b>0&&b--,U.updatePatternTable(a,b)},e.addChild(A),f=0;f<U.getTrackCount();f++)g[f]=n.trackControl(),e.addChild(g[f]);var B=n.editPanel();e.addChild(B);var C=n.songControl();e.addChild(C);var D=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);e.addChild(D);var G=n.spinBox();G.setProperties({name:"Pattern",label:"Pattern",value:0,max:100,min:0,font:window.fontMed,onChange:function(a){U.setCurrentPattern(a)}}),e.addChild(G);var I=n.spinBox({name:"Sample",label:"Sample",value:1,max:64,min:1,font:window.fontMed,onChange:function(a){U.setCurrentSampleIndex(a)}});e.addChild(I);var K=[],L=[],M=[{label:"Play",onClick:function(){U.playSong()},hideOnSmallScreen:!0},{label:"Play Pattern",onClick:function(){U.playPattern()},hideOnSmallScreen:!0},{label:"Stop",onClick:function(){U.stop()},hideOnSmallScreen:!0},{label:"Options",labels:["Options","Opt.","Op"],onClick:function(){H.doCommand(q.showOptions)}},{label:"File Operations",labels:["File Operations","File Op.","File","Fi"],onClick:function(){H.doCommand(q.showFileOperations)}},{label:"Instruments",labels:["Instruments","Instr.","Inst","In"],onClick:function(){H.doCommand(q.showSampleEditor)},hideOnBigScreen:!0},{label:"Sample Editor",labels:["Sample Editor","Sample","Smp","Sm"],onClick:function(){H.doCommand(q.showSampleEditor)}}],N=function(){var a=0,b=function(a){return!a.hideOnBigScreen};return j==w.column5Full&&(b=function(a){return!a.hideOnSmallScreen}),M.forEach(function(c){b(c)&&a++}),a};for(f=0;f<M.length;f++){var O=M[f],P=n.button();P.info=O,P.onClick=O.onClick,P.getLabel=function(a){var b=Math.floor((a-30)/8);if(this.info.labels){for(var c,d=0,e=this.info.labels.length;d<e;d++)if(c=this.info.labels[d],c.length<=b)return c;return c}return this.info.label},K[f]=P,e.addChild(P)}var Q=[{label:"Demomusic",onClick:function(){U.load("demomods/demomusic.mod")}},{label:"Stardust",onClick:function(){U.load("demomods/StardustMemories.mod")}},{label:"Space Debris",onClick:function(){U.load("demomods/spacedeb.mod")}},{label:"Tinytune",onClick:function(){U.load("demomods/Tinytune.mod")}},{label:"Lotus 2",onClick:function(){U.load("demomods/lotus20.mod")}},{label:"Professionaltracker",onClick:function(){U.load("demomods/hoffman_and_daytripper_-_professional_tracker.mod")}},{label:"8CHN: AceMan",onClick:function(){U.load("demomods/AceMan.mod")}},{label:"28CHN: Dope",onClick:function(){U.load("demomods/dope.mod")}},{label:"Exodus baum",onClick:function(){U.load("demomods/exodus-baum_load.mod")}},{label:"Random !",onClick:function(){H.doCommand(q.randomSong)}}],R=n.panel();R.setProperties({name:"sideButtonPanel"});var S=n.label();for(S.setProperties({label:"Demosongs:",font:fontMed}),R.addChild(S),f=0;f<Q.length;f++){var T=Q[f],P=n.button();P.info=T,P.onClick=T.onClick,
L[f]=P,R.addChild(P)}e.addChild(R);var V=n.button();V.setProperties({label:"",textAlign:"center",background:n.Assets.buttonLightScale9,image:W.getImage("piano"),font:window.fontMed}),V.onClick=function(){H.doCommand(q.togglePiano)},R.addChild(V);var X=n.spinBox({name:"SongLength",label:"SongLen",value:1,max:200,min:1,font:window.fontMed,onChange:function(a){var b=U.getSong().length;b>a?U.removeFromPatternTable():b<a&&U.addToPatternTable()}});e.addChild(X);var Y=n.PatternView();Y.setProperties({name:"patternViewPanel"}),e.addChild(Y);var $=n.SampleView();$.setProperties({name:"sampleViewPanel"}),e.addChild($);var _=n.DiskOperations();_.setProperties({name:"diskoperations",zIndex:100}),e.addChild(_),n.diskOperations=_;var aa=n.OptionsPanel();aa.setProperties({name:"options",zIndex:100}),e.addChild(aa);var ba=n.PianoView();ba.hide(),ba.setProperties({name:"pianoViewPanel"}),e.addChild(ba);var ca=n.visualiser();ca.connect(F.cutOffVolume),ca.name="mainAnalyser",ca.onClick=function(){ca.nextMode()},e.visualiser=ca;var da=n.vumeter();return da.connect(F.cutOffVolume),e.vumeter=da,e.sortZIndex(),E.on(p.songLoading,function(){t.setValue("Loading ...",!0)}),E.on(p.songLoaded,function(a){e.setPatternTable(a.patternTable)}),E.on(p.songPropertyChange,function(a){t.setValue(a.title,!0),X.setValue(a.length,!0),I.setMax(a.samples.length-1)}),E.on(p.sampleChange,function(a){I.setValue(a,!0)}),E.on(p.patternChange,function(a){G.setValue(a,!0),Y.refresh()}),E.on(p.patternPosChange,function(a){Y.refresh()}),E.on(p.cursorPositionChange,function(a){Y.refresh()}),E.on(p.recordingChange,function(a){Y.refresh()}),E.on(p.trackStateChange,function(a){if("undefined"!=typeof a.track)if(a.solo)for(f=0;f<U.getTrackCount();f++)f!=a.track&&g[f].setProperties({mute:!0});else if(a.wasSolo)for(f=0;f<U.getTrackCount();f++)f!=a.track&&g[f].setProperties({mute:!1})}),E.on(p.songPositionChange,function(a){y.setSelectedIndex(a,!0)}),E.on(p.patternTableChange,function(a){e.setPatternTable(U.getSong().patternTable)}),E.on(p.sampleChange,function(a){u.setSelectedIndex(a-1)}),E.on(p.sampleNameChange,function(a){var b=U.getSample(a);if(b)for(var c=e.getInstruments(),d=0,f=c.length;d<f;d++)if(c[d].data==a){c[d].label=a+" "+b.name,n.mainPanel.setInstruments(c);break}}),E.on(p.trackCountChange,function(a){for(e.visibleTracks=Math.min(i,a),f=g.length;f<a;f++)g[f]=n.trackControl(),g[f].setProperties({top:-200}),e.addChild(g[f]);ca.connect(F.cutOffVolume)}),E.on(p.patternHorizontalScrollChange,function(){b()}),e.setLayout=function(c,d,g,h){e.clearCanvas(),e.width=g,e.height=h,j=e.width<730?w.column5Full:l,e.visibleTracks=Math.min(i,U.getTrackCount()),e.defaultMargin=4,e.menuHeight=26,e.controlPanelHeight=200,e.equaliserPanelHeight=60,e.controlBarHeight=30,e.pianoHeight=220,e.infoPanelHeight=30,e.equaliserTop=e.controlPanelHeight+e.infoPanelHeight,e.controlBarTop=e.equaliserTop+e.equaliserPanelHeight,e.patternTop=e.controlBarTop+e.controlBarHeight+2,e.patternHeight=e.height-e.patternTop-e.defaultMargin,ba.isVisible()&&(e.patternHeight-=e.pianoHeight),e.col1W=Math.floor((e.width-6*e.defaultMargin-3)/5),e.col2W=2*e.col1W+e.defaultMargin,e.col3W=3*e.col1W+2*e.defaultMargin,e.col4W=4*e.col1W+3*e.defaultMargin,e.col5W=5*e.col1W+4*e.defaultMargin,e.col1X=e.defaultMargin,e.col2X=2*e.defaultMargin+e.col1W,e.col3X=3*e.defaultMargin+2*e.col1W,e.col4X=4*e.defaultMargin+3*e.col1W,e.col5X=5*e.defaultMargin+4*e.col1W;var k=e.col4W,p=e.col2X;e.patternMargin=0,e.patternMarginRight=0,e.menuWidth=e.col2W;var q=e.col3X,E=e.col3W;e.menuWidth<250&&(e.menuWidth=e.col3W,q=e.col4X,E=e.col2W,e.menuWidth<250&&(e.menuWidth=e.col4W,q=e.col5X,E=e.col1W)),j==w.column5Full&&(k=e.width-14,p=6,e.patternMargin=24,e.patternMarginRight=16,e.controlPanelHeight=204,e.equaliserTop=e.controlPanelHeight,e.controlBarTop=e.equaliserTop+e.equaliserPanelHeight,e.patternTop=e.controlBarTop+e.controlBarHeight+2,e.patternHeight=e.height-e.patternTop-e.defaultMargin,ba.isVisible()&&(e.patternHeight-=e.pianoHeight)),e.trackMargin=4,e.trackWidth=(k-e.patternMargin-e.patternMarginRight)/e.visibleTracks-e.trackMargin,e.patternViewWidth=k,e.patternViewLeft=p;var F=28,H=3*F+e.defaultMargin+2,J=e.controlPanelHeight-e.menuHeight-2*e.defaultMargin,O=Math.floor(J/N())+1,P=20,T=e.col1W-40,W=20;j==w.column5Full&&(H=4*F+e.defaultMargin+2,T=Math.floor(e.col1W/3*5),W=Math.floor(e.col1W/6),O=Math.floor((J-e.infoPanelHeight)/N())+1);var Z=e.menuHeight+e.defaultMargin,ea=e.equaliserTop-H-e.infoPanelHeight-e.defaultMargin,fa={menuBackground:e.menuWidth,logo:{left:e.col1X,width:e.col2W,height:J-H-e.defaultMargin,top:Z},modNameInputBox:{left:e.col4X,width:e.col2W,top:Z,height:P},listbox:{left:e.col4X,width:e.col2W,height:J-P-e.defaultMargin,top:e.menuHeight+e.defaultMargin+P+e.defaultMargin},songPanel:{left:e.defaultMargin,top:ea,width:e.col1W,height:H},infoPanel:{left:e.col2X,top:e.equaliserTop-e.infoPanelHeight,width:e.col5W,height:e.infoPanelHeight},patternPanel:{left:e.col2X,top:ea,width:e.col1W,height:H},sideButtonPanel:{visible:!0,left:e.col1X,top:e.patternTop,width:e.col1W,height:e.patternHeight},patternView:{left:p,top:e.patternTop,width:k,height:e.patternHeight},sampleView:{left:0,top:e.patternTop,width:e.width,height:e.patternHeight},pianoView:{left:0,top:e.height-e.pianoHeight,width:e.width,height:e.pianoHeight},diskOperations:{left:0,top:e.menuHeight,height:e.controlPanelHeight-e.menuHeight,width:e.width},editPanel:{left:e.col1X,top:e.equaliserTop-e.infoPanelHeight,width:e.col1W,height:e.controlBarHeight+e.equaliserPanelHeight},songControl:{left:e.col1X,top:e.controlBarTop,width:e.col1W,height:e.controlBarHeight,songPatternSelector:"small"},spinBoxSongLength:{left:e.col2X,top:ea+3,width:e.col1W,height:F},spinBoxPattern:{left:e.col2X,top:ea+F+3,width:e.col1W,height:F},spinBoxPatternLength:{left:e.col2X,top:ea+F+3,width:e.col1W,height:F},spinBoxSample:{left:e.col2X,top:ea+2*F+3,width:e.col1W,height:F},spinBoxBmp:{left:e.defaultMargin,top:e.equaliserTop+F,height:F,width:e.col1W},buttonsInfo:{left:e.col3X,top:Z,width:e.col1W,height:O},buttonsSideInfo:{left:0,top:e.defaultMargin,width:e.col1W,height:O}};j==w.column5Full&&(fa.sideButtonPanel.left=-500,fa.editPanel.left=-500,fa.songPanel.height=H-e.controlBarHeight,fa.songControl.top=fa.songPanel.top+fa.songPanel.height,fa.songControl.width=e.col2W,fa.patternPanel.height=fa.songPanel.height,fa.listbox.left=-500,fa.buttonsInfo.left=e.col5X,fa.patternPanel.left=e.col3X,fa.spinBoxPattern.left=e.col3X,fa.spinBoxSample.left=e.col3X,fa.spinBoxSongLength.left=e.col3X,fa.patternPanel.width=e.col2W,fa.spinBoxPattern.width=e.col2W,fa.spinBoxSample.width=e.col2W,fa.spinBoxSongLength.width=e.col2W,fa.songPanel.width=e.col2W,fa.logo.left=-500,fa.modNameInputBox.left=e.col1X,fa.modNameInputBox.width=e.col4W,fa.infoPanel.left=e.col1X,fa.songControl.songPatternSelector="big",fa.songControl.width=e.col4W),o.setSize(fa.menuBackground,e.menuHeight),r.setSize(fa.menuBackground,e.menuHeight),m.setSize(e.width,e.height),a(s,fa.logo),a(t,fa.modNameInputBox),a(u,fa.listbox);var ga=0;for(f=0;f<M.length;f++){var ha=K[f],ia=!ha.info.hideOnBigScreen;j==w.column5Full&&(ia=!ha.info.hideOnSmallScreen),ia?(ha.setProperties({left:fa.buttonsInfo.left,top:fa.buttonsInfo.top+ga*O,width:fa.buttonsInfo.width,height:fa.buttonsInfo.height,label:ha.getLabel(fa.buttonsInfo.width),textAlign:"left",background:n.Assets.buttonLightScale9,font:window.fontMed}),ga++):ha.setProperties({left:-500})}for(S.setProperties({left:fa.buttonsSideInfo.left,top:fa.buttonsSideInfo.top,width:fa.buttonsSideInfo.width,height:fa.buttonsSideInfo.height}),V.setProperties({left:ba.isVisible()?-500:fa.buttonsSideInfo.left,top:fa.sideButtonPanel.height-fa.buttonsSideInfo.height,width:fa.buttonsSideInfo.width,height:fa.buttonsSideInfo.height}),f=0;f<Q.length;f++){var ha=L[f],ja=(f+1)*O+fa.buttonsSideInfo.top,ka=fa.buttonsSideInfo.left;ja>V.top-O&&(ka=-500),ha.setProperties({left:ka,top:ja,width:fa.buttonsSideInfo.width,height:fa.buttonsSideInfo.height,label:ha.info.label,textAlign:"left",background:n.Assets.buttonLightScale9,font:window.fontMed})}a(R,fa.sideButtonPanel),a(x,fa.songPanel),a(v,fa.infoPanel),y.setProperties({left:x.left,top:x.top,width:T,height:x.height,centerSelection:!0,onChange:function(){U.setCurrentSongPosition(y.getSelectedIndex(),!0)}}),A.setProperties({left:x.left+x.width-W,top:x.top+Math.floor(x.height-z.height)/2,width:W,name:"PatternDown"}),z.setProperties({left:A.left-W,top:A.top,width:W,name:"PatternUp"}),b(),C.songPatternSelector=fa.songControl.songPatternSelector,a(B,fa.editPanel),a(C,fa.songControl),a(D,fa.patternPanel),a(G,fa.spinBoxPattern),a(I,fa.spinBoxSample),a(X,fa.spinBoxSongLength),a(Y,fa.patternView),a($,fa.sampleView),a(ba,fa.pianoView),a(_,fa.diskOperations),a(aa,fa.diskOperations),ca.setProperties({left:p+e.patternMargin,top:e.equaliserTop,width:k-e.patternMargin-e.patternMarginRight,height:e.equaliserPanelHeight}),da.setProperties({width:E,left:q}),e.setSize(e.width,e.height),v.setLayout()},e.setLayout(0,0,e.width,e.height),e.setInstruments=function(a){u.setItems(a)},e.getInstruments=function(){return u.getItems()},e.setPatternTable=function(a){for(var b=[],c=0,e=U.getSong().length;c<e;c++){var f=a[c];b.push({label:d(c)+":"+d(f),data:f})}y.setItems(b)},e.toggleFxPanel=function(a){Y.toggleFxPanel(a)},e.setView=function(a){function b(){_.hide(),aa.hide()}function c(){Y.show(),R.show(),$.hide()}function d(){b(),c()}switch(a){case"sample":c(),Y.hide(),R.hide(),$.setLayout(),$.show(!0,!0);break;case"diskop_load":b(),_.setLayout("load"),_.refreshList(),_.show();break;case"diskop_save":b(),_.setLayout("save"),_.refreshList(),_.show();break;case"diskop_samples":b(),_.setLayout(),_.refreshList("samples"),_.show();break;case"options":b(),aa.setLayout(),aa.show();break;case"resetTop":b();break;case"resetBottom":b();break;default:d()}h=a,e.refresh()},e.getCurrentView=function(){return h},e.togglePiano=function(){ba.toggle(),e.setLayout(0,0,e.width,e.height)},e},n.OptionsPanel=function(){var a=n.panel();a.hide();var b=n.scale9Panel(0,0,20,20,n.Assets.panelMainScale9);b.ignoreEvents=!0,a.addChild(b);var c=n.label({label:"Options:",font:fontMed,left:5,height:18,top:9,width:200});a.addChild(c);var d=n.scale9Panel(0,0,0,0,n.Assets.panelInsetScale9);a.addChild(d);var e=n.Assets.generate("button20_20");e.setLabel("x"),e.onClick=function(){n.mainPanel.setView("resetTop")},a.addChild(e);var f=n.Assets.generate("buttonLight");f.setLabel("Close"),f.onClick=e.onClick,a.addChild(f);var g=[{label:"Keyboard Layout:",values:["QWERTY","AZERTY","QWERTZ"],setValue:function(a){0==a&&(D.keyboardTable="qwerty"),D.keyboardTable=1==a?"azerty":"qwertz",M.saveSettings()},getValue:function(){var a=0;return"azerty"==D.keyboardTable&&(a=1),"qwertz"==D.keyboardTable&&(a=2),a}},{label:"VU bars:",values:["NONE","COLOURS: AMIGA","TRANSPARENT"],setValue:function(a){D.vubars=0==a?"none":2==a?"trans":"colour",M.saveSettings()},getValue:function(){var a=1;return"none"==D.vubars&&(a=0),"trans"==D.vubars&&(a=2),a}},{label:"Stereo:",values:["Hard: Amiga","Balanced","None: mono"],setValue:function(a){F.setStereoSeparation(0==a?u.FULL:2==a?u.NONE:u.BALANCED),M.saveSettings()},getValue:function(){var a=1;return D.stereoSeparation==u.NONE&&(a=2),D.stereoSeparation==u.FULL&&(a=0),a}}];return g.forEach(function(b){var c=n.label();c.setProperties({label:b.label,font:fontMed,textAlign:"right"}),a.addChild(c),b.label=c;for(var d=[],e=b.getValue(),f=0;f<4;f++){var g,h=b.values[f];h?(g=n.Assets.generate("buttonDarkGreen"),g.setProperties({label:h,font:fontMed,textAlign:"center"}),g.setActive(f==e),g.index=f,g.option=b,g.onClick=function(){activateOption(this)}):g=n.Assets.generate("buttonDark"),a.addChild(g),d.push(g)}b.buttons=d}),activateOption=function(a){var b=a.option;b.buttons.forEach(function(a){a.setActive(!1)}),a.setActive(!0),b.setValue(a.index)},a.setLayout=function(){if(n.mainPanel){a.clearCanvas(),b.setProperties({left:0,top:0,height:a.height,width:a.width});var h=5,i=a.height-2*n.mainPanel.defaultMargin-h;e.setProperties({top:h,left:a.width-30}),d.setProperties({left:a.left+n.mainPanel.defaultMargin,top:a.top+h,height:i-6-c.height,width:a.width-2*n.mainPanel.defaultMargin-4});var j=35,k=30,l=5,m=0;g.forEach(function(a){var b=j+m*(k+l);a.label.setProperties({top:b,width:n.mainPanel.col1W,height:k,left:0});for(var c=a.getValue(),d=0;d<4;d++){var e=a.buttons[d];e.setProperties({top:b,height:k,width:n.mainPanel.col1W,left:n.mainPanel["col"+(d+2)+"X"]}),e.setActive(d==c)}m++}),f.setProperties({left:n.mainPanel.col1X+5,width:n.mainPanel.col1W-5,height:k,top:i-k+5})}},a},n.PatternView=function(a,b,c,d){function e(a,b,c,d){fontMed.write(i.ctx,a,b,c,0,d)}function f(a,b,c){if(d=a.toString(16).toUpperCase(),b&&d.length<b)for(c=c||"0";d.length<b;)d=c+d;return d}function g(){var a=U.getCurrentPatternPos()||0;if(j){var b=1,c=b,d=i.height-2,e=d;o=0,r>1&&(e=Math.floor(j/r*d),e<12&&(e=12),o=(d-e)/(r-1)),a&&o&&(c=Math.floor(b+o*a)),s.setProperties({left:i.width-16,top:c,width:16,height:e})}}function h(){var a=n.mainPanel.patternViewWidth,b=Math.floor(a/U.getTrackCount()*k),c=(a-b)/(U.getTrackCount()-k),d=i.height-20;k>=U.getTrackCount()&&(d=-200),t.setProperties({top:d,width:b,left:n.mainPanel.patternMargin+Math.floor(q*c)})}var i=n.panel(a,b,c,d),j=0,k=4,l=13,o=0,q=0,r=U.getPatternLength(),s=n.scale9Panel(c-28,18,16,d-3,{img:W.getImage("bar"),left:2,top:2,right:3,bottom:3});s.onDragStart=function(){U.isPlaying()||(s.startDragIndex=U.getCurrentPatternPos())},s.onDrag=function(a){if(!U.isPlaying()&&j&&o){var b=a.dragY-a.startY,c=Math.floor(s.startDragIndex+b/o);c=Math.min(c,r-1),c=Math.max(c,0),U.setCurrentPatternPos(c)}},i.addChild(s),g();var t=n.scale9Panel(c-28,18,16,16,{img:W.getImage("bar"),left:2,top:2,right:3,bottom:3});t.onDragStart=function(){t.startDragIndex=q},t.onDrag=function(a){var b=U.getTrackCount()-k,c=a.dragX-a.startX,d=n.mainPanel.patternViewWidth-t.width,e=Math.floor(c/(d/b));i.setHorizontalScroll(t.startDragIndex+e)},i.addChild(t);for(var u=[],v=0,w=U.getTrackCount();v<w;v++){var x=n.fxPanel(v);u.push(x),i.addChild(x)}var y=[],z=[],A=10,B=70;return E.on(p.trackCountChange,function(a){k<a&&(k=a),q=Math.min(q,a-k),q=Math.max(q,0);for(var b=u.length,c=a;b<c;b++){var d=n.fxPanel(b);u.push(d),i.addChild(d)}}),E.on(p.songLoaded,function(){i.setHorizontalScroll(0)}),i.setHorizontalScroll=function(a){var b=U.getTrackCount()-k;a!=q&&a>=0&&a<=b&&(q=a,E.trigger(p.patternHorizontalScrollChange,q),h())},i.toggleFxPanel=function(a){if(x=u[a],x.visible)x.hide();else{var b=n.mainPanel.trackWidth,c=n.mainPanel.patternHeight;x.setPosition(x.left,0),x.setSize(b,c),x.setLayout(),x.show()}i.refresh()},i.render=function(){if(i.isVisible()){if(this.needsRendering){i.clearCanvas();var a=U.getCurrentPattern()||0,b=U.getCurrentPatternPos()||0,c=U.getSong();if(!c)return;var d=n.mainPanel.defaultMargin,o=n.mainPanel.trackWidth;k=n.mainPanel.visibleTracks;var p=k<U.getTrackCount(),r=n.mainPanel.patternHeight-30,v=n.mainPanel.patternMargin,w=10,x=60,C=!1;v&&(w=0,x=0,C=!0),p&&(r-=24),j=Math.ceil(r/l),j%2==0&&j--;var E=Math.floor(j/2),F=b-E,G=F+j,H=l+2,I=Math.floor((r+H)/2),J=I-E*l+4,K=I,L=I+H,M=m.darkPanel;if(!M&&W.getImage("panel_dark")){var N=n.scale9Panel(0,0,o,K,{img:W.getImage("panel_dark"),left:3,top:3,right:2,bottom:2});m.darkPanel=N.render(!0),M=m.darkPanel}var P=[],Q=!1;B>K&&(B=K,A=B/10);for(var R=0;R<k;R++){var T=q+R;if(P[T]=!(u[T]&&u[T].visible)){var V=v+R*(o+d);i.ctx.drawImage(M,V,0,o,K),i.ctx.drawImage(M,V,L,o,K),u[T]&&(u[T].left=V)}}var X=c.patterns[a];if(X){i.ctx.fillStyle=U.isRecording()?"#A50B0F":"#202E58";var Y=68;i.ctx.fillRect(n.mainPanel.patternMargin,I,i.width-2*n.mainPanel.patternMargin,H);var Z,$=U.getCurrentTrackPosition(),_=9;C?(V=v+U.getCurrentTrack()*(o+d),Z=V+Math.floor((o-Y)/2)+$*_-1):Z=v+x+U.getCurrentTrack()*o+$*_-1,$>0?(Z+=2*_+1,$>2&&(Z+=2)):_=28,i.ctx.fillStyle="rgba(220,220,220,.3)",i.ctx.fillRect(Z,I,_,l+2);for(var R=F;R<G;R++)if(R>=0&&R<U.getPatternLength()){var aa=X[R],ba=J+(R-F)*l,ca=!0;ba<I&&(ba-=3,ca=!1),ba>I+l&&(ba+=3,ca=!1);var da=""+R;R<10&&(da="0"+da);var ea=!1;R%4==0&&(ea="orange"),e(da,w,ba,ea),ca&&(e(da,w,ba,ea),e(da,w,ba,ea));for(var fa=0;fa<k;fa++)if(T=fa+q,P[T]){var ga,ha=aa[T];if(C?(V=v+fa*(o+d),ga=V+Math.floor((o-Y)/2)):ga=v+x+fa*o,ha.note)var ia=S[ha.note],ja=ia?ia.name:"???";else{var ka=O[ha.period];ja=ka?ka.name:"---"}if(e(ja,ga,ba),ca&&(e(ja,ga,ba),e(ja,ga,ba),U.isPlaying()||y[fa]&&"none"!=D.vubars)){var la=a+"."+b;if(U.isPlaying()&&ha&&ha.period&&z[fa]!=la){var ma=100;if(12==ha.effect)ma=100*ha.param/64;else{var na=U.getSample(ha.sample);na&&(ma=100*na.volume/64)}y[fa]=ma,z[fa]=la}if(y[fa]){Q=!0;var oa=y[fa]*B/100,pa=100*oa/B;if("colour"==D.vubars){var qa=W.getImage("vubar");i.ctx.drawImage(qa,0,100-pa,26,pa,ga-12,I-oa,10,oa)}"trans"==D.vubars&&(V=v+fa*(o+d),i.ctx.fillStyle="rgba(120,190,255,0.3)",i.ctx.fillRect(ga-14,I-oa,10,oa)),y[fa]-=A,y[fa]<0&&(y[fa]=0)}}ga+=3*fontMed.charWidth+4,ja=f(ha.sample,2,"0"),e(ja,ga,ba,"green"),ga+=2*fontMed.charWidth+4,ja=f(ha.effect),ja+=f(ha.param,2,"0"),e(ja,ga,ba,"orange")}Q&&setTimeout(function(){i.refresh()},20)}}for(var fa=0;fa<k;fa++)T=fa+q,P[T]||u[T].render();if(g(),s.render(),p)for(h(),t.render(),fa=0;fa<k;fa++)T=fa+q,P[T]&&(V=v+fa*(o+d)+2,e(""+(T+1),V,2))}this.needsRendering=!1,i.parentCtx.drawImage(i.canvas,i.left,i.top,i.width,i.height)}},i.onMouseWheel=function(a){if(!U.isPlaying()){var b=U.getCurrentPatternPos();a.mouseWheels[0]>0?b&&U.moveCurrentPatternPos(-1):b<r-1&&U.moveCurrentPatternPos(1)}},i.onDragStart=function(a){t.startDragIndex=q,U.isPlaying()||(i.startDragPos=U.getCurrentPatternPos())},i.onDrag=function(a){if(k<U.getTrackCount()){var b=U.getTrackCount()-k,c=a.dragX-a.startX,d=n.mainPanel.patternViewWidth-t.width,e=Math.floor(c/(d/b));i.setHorizontalScroll(t.startDragIndex-e)}if(!U.isPlaying()){c=Math.round((a.dragY-a.startY)/l);var f=i.startDragPos-c;f=Math.max(f,0),f=Math.min(f,r-1),U.setCurrentPatternPos(f)}},i.getStartTrack=function(){return q},i},n.PianoView=function(){var a=n.element(),b=64,c=[],d=[],e={},f=[],g=[],h={},i=W.getImage("pianokey_white"),j=W.getImage("pianokey_white_down"),k=W.getImage("pianokey_black"),l=W.getImage("pianokey_black_down"),m=1,o=30,r=0,s=n.scale9Panel(0,0,a.width,a.height,n.Assets.panelMainScale9);s.ignoreEvents=!0,a.addChild(s);var t=n.Assets.generate("button20_20");t.setLabel("x"),t.onClick=function(){H.doCommand(q.togglePiano)},a.addChild(t);var u=n.spinBox();u.setProperties({name:"Octave",label:"Octave",value:1,max:3,min:1,left:4,top:2,height:28,width:150,font:window.fontMed,onChange:function(a){m=a}}),a.addChild(u);var v=["left","top","width","height","name","type","zIndex"];if(a.setProperties=function(b){v.forEach(function(c){"undefined"!=typeof b[c]&&(a[c]=b[c])}),a.setSize(a.width,a.height),a.setPosition(a.left,a.top),a.setLayout&&a.setLayout(a.left,a.top,a.width,a.height)},a.setLayout=function(){s.setSize(a.width,a.height),t.setProperties({top:4,left:a.width-24})},!c.length)for(var w in z)z.hasOwnProperty(w)&&(w.indexOf("s")<0?(e[z[w].period]=c.length,c.push(w)):(e[z[w].period]=1e3+d.length,d.push(w)));E.on(p.pianoNoteOn,function(b){if(a.isVisible()&&b&&b.basePeriod){var c=e[b.basePeriod];c>=0&&(c-=c>=1e3?5*(m-1):7*(m-1),f[c]={startTime:F.context.currentTime,source:b.source},a.refresh())}}),E.on(p.pianoNoteOff,function(b){if(a.isVisible()&&b&&b.basePeriod){var c=e[b.basePeriod];c-=c>=1e3?5*(m-1):7*(m-1),c>=0&&(f[c]=!1,a.refresh())}});var x=function(a){var b;if(a<1e3&&c[a])b=z[c[a+7*(m-1)]];else{var e=a-1e3;d[e]&&(b=z[d[e+5*(m-1)]])}if(b&&b.period){U.isRecording()&&(U.getCurrentTrackPosition()>0||(U.putNote(U.getCurrentSampleIndex(),b.period),U.isPlaying()||U.moveCurrentPatternPos(1)));var f=F.playSample(U.getCurrentSampleIndex(),b.period);g[a]=f,E.trigger(p.pianoNoteOn,f)}},y=function(a){var b;if(g[a]){if(a<1e3&&c[a])b=z[c[a+7*(m-1)]];else{var e=a-1e3;d[e]&&(b=z[d[e+5*(m-1)]])}b&&b.period&&(E.trigger(p.pianoNoteOff,g[a]),g[a].volume?g[a].volume.gain.linearRampToValueAtTime(0,F.context.currentTime+.5):g[a].source.stop(),g[a]=!1)}},A=function(a,c){var d=-1;if(c-=o,c>=0)if(c>r)d=Math.floor(a/(b-4));else{var e=(b-4)/2,f=e/2,g=Math.floor((a-f)/e);if(g<0&&(g=0),g%2==0)d=g/2;else{var h={1:0,3:1,5:-1,7:2,9:3,11:4,13:-1,15:5,17:6,19:-1,21:7,23:8,25:9,27:-1,29:10,31:11,33:-1,35:12,37:13,39:14,41:-1};d=1e3+h[g],d<1e3&&(d=Math.floor(a/(b-4)))}}return d};return a.onTouchDown=function(b){var c=A(a.eventX,a.eventY);c>=0&&(h[b.id]=c,x(c))},a.onTouchUp=function(b){var c=b.dragX||a.eventX,d=A(c,a.eventY);d>=0&&(h[b.id]=!1,y(d))},a.onDrag=function(b){var c=b.dragX,d=b.dragY-a.top-o,e=A(c,d);e>=0&&h[b.id]!=e&&(y(h[b.id]),h[b.id]=e,x(e))},a.render=function(c){if(a.isVisible()){if(c=!!c,this.needsRendering){a.clearCanvas(),s.render(),t.render(),u.render();for(var d=a.height-o,e=0,g=4,h=0;e<a.width;){var m=f[h]?j:i;a.ctx.drawImage(m,e,o,b,d),h++,e+=b-g}var n=48;r=Math.floor(d/1.7);var p=b-n/2-2;h=0;for(var q=0;p<a.width;){var v=h%7,w=f[1e3+q]?l:k;2!=v&&6!=v&&(a.ctx.drawImage(w,p,o,n,r),q++),h++,p+=b-g}}return this.needsRendering=!1,c?a.canvas:void a.parentCtx.drawImage(a.canvas,a.left,a.top,a.width,a.height)}},a},n.SampleView=function(){var a=n.panel();a.hide();var b,c=20,d=n.inputbox({name:"sampleName",height:c,onChange:function(a){if(b){var c=U.getSample(b);c&&(c.name=a),E.trigger(p.sampleNameChange,b)}}});a.addChild(d);var e=n.WaveForm();a.addChild(e);var f=new n.panel;f.setProperties({name:"sampleSideButtonPanel"});var g=n.spinBox({name:"Sample",label:"Sample",value:1,max:64,min:1,font:window.fontMed,onChange:function(a){U.setCurrentSampleIndex(a)}});f.addChild(g);var h=n.spinBox({name:"Volume",label:"Volume",value:64,max:64,min:0,font:window.fontMed,onChange:function(a){var b=U.getCurrentSample();b&&(b.volume=a)}});f.addChild(h);var i=n.spinBox({name:"Finetune",label:"Finetune",value:0,max:7,min:-8,font:window.fontMed,onChange:function(a){var b=U.getCurrentSample();b&&(b.finetune=a)}});f.addChild(i);var j=n.spinBox({name:"Length",label:"Length",value:0,max:65535,min:0,font:window.fontMed});f.addChild(j);var k=n.spinBox({name:"Repeat",label:"Repeat",value:0,max:65535,min:0,step:2,font:window.fontMed,onChange:function(a){var b=U.getCurrentSample();b&&(b.loopStart=a),e.refresh()}});f.addChild(k);var l=n.spinBox({name:"Repeat Length",label:"Repeat Length",value:0,max:65535,min:0,step:2,font:window.fontMed,onChange:function(a){var b=U.getCurrentSample();b&&(b.loopRepeatLength=a),e.refresh()}});f.addChild(l),a.addChild(f);var m=n.Assets.generate("buttonLight");m.setLabel("Load"),m.onClick=function(){n.mainPanel.setView("diskop_samples")},a.addChild(m);var o=n.Assets.generate("buttonLight");o.setLabel("Clear"),o.onClick=function(){U.getSample()},a.addChild(o);var q=n.Assets.generate("buttonLight");q.setLabel("Reverse"),q.onClick=function(){var a=U.getSample(b);a&&a.data&&a.data.reverse(),E.trigger(p.sampleChange,b)},a.addChild(q);var r=n.Assets.generate("buttonLight");return r.setLabel("Exit"),r.onClick=function(){n.mainPanel.setView("main")},a.addChild(r),E.on(p.sampleChange,function(a){b=a,g.setValue(a,!0);var c=U.getSample(a);c?(d.setValue(c.name,!0),h.setValue(c.volume),j.setValue(c.length),i.setValue(c.finetune),k.setValue(c.loopStart),l.setValue(c.loopRepeatLength),e.setSample(c)):(e.setSample(),d.setValue("",!0),h.setValue(0),j.setValue(0),i.setValue(0),k.setValue(0),l.setValue(0))}),E.on(p.samplePlay,function(c){a.visible&&c&&c.sampleIndex==b&&e.play(c.startPeriod)}),E.on(p.songPropertyChange,function(a){g.setMax(a.samples.length-1)}),a.setLayout=function(){if(n.mainPanel){a.clearCanvas(),e.setPosition(n.mainPanel.col2X,c+n.mainPanel.defaultMargin+8),e.setSize(n.mainPanel.col4W,100),d.setProperties({top:n.mainPanel.defaultMargin,left:n.mainPanel.col2X,width:n.mainPanel.col4W});var b=28;f.setProperties({left:0,top:0,width:n.mainPanel.col1W,height:a.height}),g.setProperties({left:0,top:0,width:f.width,height:b}),h.setProperties({left:0,top:b,width:f.width,height:b}),i.setProperties({left:0,top:2*b,width:f.width,height:b}),j.setProperties({left:0,top:3*b,width:f.width,height:b}),k.setProperties({left:0,top:4*b,width:f.width,height:b}),l.setProperties({left:0,top:5*b,width:f.width,height:b});var p=e.top+e.height+n.mainPanel.defaultMargin;m.setProperties({width:n.mainPanel.col1W,height:b,left:n.mainPanel.col2X,top:p}),o.setProperties({width:n.mainPanel.col1W,height:b,left:n.mainPanel.col3X,top:p}),q.setProperties({width:n.mainPanel.col1W,height:b,left:n.mainPanel.col4X,top:p}),r.setProperties({width:n.mainPanel.col1W,height:b,left:n.mainPanel.col5X,top:p})}},a},n.sliderBox=function(a){function b(){for(var a=""+i;a.length<m;)a=o+a;return a}function c(a){"undefined"!=typeof a.name&&(d.name=a.name),"undefined"!=typeof a.left&&(d.left=a.left),"undefined"!=typeof a.top&&(d.top=a.top),"undefined"!=typeof a.width&&(d.width=a.width),"undefined"!=typeof a.height&&(d.height=a.height),"undefined"!=typeof a.label&&(h=a.label),"undefined"!=typeof a.value&&(i=a.value),"undefined"!=typeof a.font&&(e=a.font),"undefined"!=typeof a.min&&(j=a.min),"undefined"!=typeof a.max&&(k=a.max),"undefined"!=typeof a.step&&(l=a.step),"undefined"!=typeof a.onChange&&(g=a.onChange)}var d=n.element();d.type="sliderBox";var e,f,g,h="",i=0,j=0,k=100,l=1,m=4,o=" ",p=20;a&&c(a),k>9999&&(m=5);var q=n.rangeSlider({min:j,max:k,height:p,onChange:function(a){i=a,g&&g(a)}});return d.addChild(q),d.setProperties=function(a){return a?(f=a||{},c(f),d.setSize(d.width,d.height),void d.setPosition(d.left,d.top)):f},d.setValue=function(a,b){i=a,q.setValue(i,b),d.refresh(),!b&&g&&g(i)},d.getValue=function(){return i},d.setMax=function(a){k=a,i>k&&d.setValue(k)},d.setMin=function(a){j=a,i<j&&d.setValue(j)},d.render=function(a){if(a=!!a,d.needsRendering){d.clearCanvas(),e?e.write(d.ctx,h,6,8,0):(d.ctx.fillStyle="white",d.ctx.fillText(h,10,10));var c=d.width-40,f=2,g=40,i=19;5==m&&(g=48,c-=8),d.ctx.drawImage(W.getImage("panel_inset_dark"),c,f,g,i),c+=4,f+=2,window.fontLed.write(d.ctx,b(),c,f,0),q.render()}return d.needsRendering=!1,a?d.canvas:void d.parentCtx.drawImage(d.canvas,d.left,d.top,d.width,d.height)},d.onMouseWheel=function(a){a.mouseWheels[0]>0?(i++,i>k&&(i=k),d.setValue(i)):(i--,i<j&&(i=j),d.setValue(i))},d.onResize=function(){q.setSize(d.width,p),q.setPosition(0,d.height-p)},d},n.songControl=function(a,b,c,d,e){var f=n.element(a,b,c,d,e);f.type="songControl";var g=n.radioGroup();g.setItems([{label:"   song",active:!0},{label:"pattern",active:!1}]),g.onChange=function(a){U.setPlayType(0==a?r.song:r.pattern)},f.addChild(g);var h={};h.play=n.Assets.generate("buttonDarkGreen"),h.play.setProperties({image:W.getImage("play_green"),activeImage:W.getImage("play_active_red"),activeBackground:n.Assets.buttonDarkRedActiveScale9}),h.play.onClick=function(){h.play.toggleActive(),U.isPlaying()?U.stop():U.getPlayType()==r.song?U.playSong():U.playPattern()},h.play.setProperties({name:"buttonPlay"}),f.addChild(h.play),h.record=n.Assets.generate("buttonDarkRed"),h.record.setProperties({image:W.getImage("record"),activeImage:W.getImage("record_active")}),h.record.onClick=function(){U.toggleRecord()},h.record.setProperties({name:"buttonRecord"}),f.addChild(h.record),h.song=n.Assets.generate("buttonDark"),h.song.onClick=function(){U.playSong()},h.song.setProperties({label:"Song"}),f.addChild(h.song),h.pattern=n.Assets.generate("buttonDark"),h.pattern.onClick=function(){U.playPattern()},h.pattern.setProperties({label:"Pattern"}),f.addChild(h.pattern),E.on(p.recordingChange,function(a){h.record.setActive(a)}),E.on(p.playingChange,function(a){h.play.setActive(a)}),E.on(p.playTypeChange,function(a){a==r.song?g.setSelectedIndex(0,!0):g.setSelectedIndex(1,!0)});var i=["left","top","width","height","name","type","songPatternSelector"];return f.setProperties=function(a){i.forEach(function(b){if("undefined"!=typeof a[b])switch(b){default:f[b]=a[b]}}),f.setSize(f.width,f.height),f.setPosition(f.left,f.top);var b=Math.floor(f.width/3)+1;g.setProperties({left:0,width:b,top:0,height:f.height}),h.play.setProperties({left:b,width:b,top:0,height:f.height}),h.record.setProperties({left:2*b,width:b,top:0,height:f.height}),"big"==f.songPatternSelector&&(g.left=-500,b=Math.floor(f.width/4)+1,h.play.setProperties({left:0,width:b}),h.record.setProperties({left:b,width:b}),h.song.setProperties({left:2*b,width:b,top:0,height:f.height}),h.pattern.setProperties({left:3*b,width:b,top:0,height:f.height}))},f.render=function(a){return a=!!a,f.needsRendering&&(f.clearCanvas(),"small"==f.songPatternSelector&&g.render(),h.play.render(),h.record.render(),"big"==f.songPatternSelector&&(h.song.render(),h.pattern.render())),f.needsRendering=!1,a?f.canvas:void f.parentCtx.drawImage(f.canvas,f.left,f.top,f.width,f.height)},f},n.spinBox=function(a){function b(){for(var a=""+i;a.length<m;)a=o+a;return a}function c(a){"undefined"!=typeof a.name&&(d.name=a.name),"undefined"!=typeof a.left&&(d.left=a.left),"undefined"!=typeof a.top&&(d.top=a.top),"undefined"!=typeof a.width&&(d.width=a.width),"undefined"!=typeof a.height&&(d.height=a.height),"undefined"!=typeof a.label&&(h=a.label),"undefined"!=typeof a.value&&(i=a.value),"undefined"!=typeof a.font&&(e=a.font),"undefined"!=typeof a.min&&(j=a.min),"undefined"!=typeof a.max&&(k=a.max),"undefined"!=typeof a.step&&(l=a.step),"undefined"!=typeof a.onChange&&(g=a.onChange)}var d=n.element();d.type="spinBox";var e,f,g,h="",i=0,j=0,k=100,l=1,m=4,o=" ";a&&c(a),k>9999&&(m=5);var p=n.Assets.generate("button20_20");p.onClick=function(){i-=l,i<j&&(i=j),d.setValue(i)},p.setProperties({name:"buttonDown",label:"↓"}),d.addChild(p);var q=n.Assets.generate("button20_20");return q.onClick=function(){i+=l,i>k&&(i=k),d.setValue(i)},q.setProperties({name:"buttonUp",label:"↑"}),d.addChild(q),d.setProperties=function(a){return a?(f=a||{},c(f),d.setSize(d.width,d.height),d.setPosition(d.left,d.top),p.setProperties({left:d.width-p.width,top:5}),void q.setProperties({left:d.width-q.width-p.width,top:5})):f},d.setValue=function(a,b){i=a,d.refresh(),!b&&g&&g(i)},d.getValue=function(){return i},d.setMax=function(a){k=a,i>k&&d.setValue(k)},d.render=function(a){if(a=!!a,d.needsRendering){d.clearCanvas(),e?e.write(d.ctx,h.toUpperCase(),6,11,0):(d.ctx.fillStyle="white",d.ctx.fillText(h,10,10)),q.render(),p.render();var c=q.left-32-10,f=2,g=40,i=24;5==m&&(g=48,c-=8),d.ctx.drawImage(W.getImage("panel_inset_dark"),c,f,g,i),c+=4,f=7,window.fontLed.write(d.ctx,b(),c,f,0)}return d.needsRendering=!1,a?d.canvas:void d.parentCtx.drawImage(d.canvas,d.left,d.top,d.width,d.height)},d},n.trackControl=function(a,b,c,d,e){function f(a){E.trigger(p.trackStateChange,{track:g.track,solo:j.solo.isActive,mute:j.mute.isActive,wasSolo:a})}var g=n.element(a,b,c,d,e);g.type="trackControl",g.track=0;var h,i="test",j={};j.solo=n.Assets.generate("buttonDark"),j.solo.setProperties({activeImage:W.getImage("solo.png"),activeBackground:n.Assets.buttonDarkGreenActiveScale9}),j.solo.onClick=function(){var a=j.solo.isActive;j.solo.toggleActive(),j.mute.isActive&&j.mute.toggleActive(),f(a)},j.solo.setProperties({name:"buttonSolo",label:"S"}),g.addChild(j.solo),j.mute=n.Assets.generate("buttonDark"),j.mute.setProperties({activeImage:W.getImage("mute"),activeBackground:n.Assets.buttonDarkRedActiveScale9}),j.mute.onClick=function(){j.mute.toggleActive(),j.solo.isActive&&j.solo.toggleActive(),f()},j.mute.setProperties({name:"buttonMute",label:"M"}),g.addChild(j.mute),j.fx=n.Assets.generate("buttonDark"),j.fx.onClick=function(){j.fx.toggleActive(),n.mainPanel.toggleFxPanel(g.track)},j.fx.setProperties({name:"buttonFX",label:"FX"}),g.addChild(j.fx);var k=["left","top","width","height","name","type","track","solo","mute"];return g.setProperties=function(a){k.forEach(function(b){if("undefined"!=typeof a[b])switch(b){case"solo":j.mute.isActive&&j.mute.setActive(!1),j.solo.setActive(a[b]),f();break;case"mute":j.solo.isActive&&j.solo.setActive(!1),j.mute.setActive(a[b]),f();break;default:g[b]=a[b]}}),g.setSize(g.width,g.height),g.setPosition(g.left,g.top);var b=Math.floor(g.width/3)+1;j.solo.setProperties({left:0,width:b,top:0,height:g.height}),j.mute.setProperties({
left:b-1,width:b,top:0,height:g.height}),j.fx.setProperties({left:2*b-2,width:b,top:0,height:g.height})},g.render=function(a){return a=!!a,g.needsRendering&&(g.clearCanvas(),h?h.write(g.ctx,i.toUpperCase(),6,11,0):(g.ctx.fillStyle="white",g.ctx.fillText(i,10,10)),j.solo.render(),j.mute.render(),j.fx.render()),g.needsRendering=!1,a?g.canvas:void g.parentCtx.drawImage(g.canvas,g.left,g.top,g.width,g.height)},g},n.visualiser=function(){var a,b=n.panel(),c=["wave","spectrum","tracks"],d=2,e=c[d],f=[];return b.ctx.fillStyle="black",b.ctx.lineWidth=2,b.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",b.init=function(){function c(){var a=F.context.createAnalyser();a.minDecibels=-90,a.maxDecibels=-10,a.smoothingTimeConstant=.85,a.fftSize=64,f.push(a)}if(F.context){a=F.context.createAnalyser(),a.minDecibels=-90,a.maxDecibels=-10,a.smoothingTimeConstant=.85;for(var d=0;d<U.getTrackCount();d++)c()}E.on(p.trackCountChange,function(a){for(var b=f.length;b<a;b++)c()}),b.needsRendering=!0},b.connect=function(b){if(F.context){b.connect(a);for(var c=0;c<U.getTrackCount();c++)F.filterChains[c].output().connect(f[c])}},b.nextMode=function(){d++,d>=c.length&&(d=0),e=c[d]},b.render=function(){function c(){a.getByteTimeDomainData(g),b.ctx.beginPath();for(var c=1*b.width/d,e=0,f=0;f<d;f++){var h=g[f]/128,i=h*height/2;0===f?b.ctx.moveTo(e,i):b.ctx.lineTo(e,i),e+=c}b.ctx.lineTo(b.width,height/2),b.ctx.stroke(),b.parentCtx.drawImage(b.canvas,x,y)}if(F.context){var d,g;if("wave"==e)a.fftSize=256,d=a.fftSize,g=new Uint8Array(d),c();else if("spectrum"==e){a.fftSize=128,d=a.frequencyBinCount,g=new Uint8Array(d);var h=8,i=8,j=d-i,k=d-h-i;a.getByteFrequencyData(g);for(var l,m=(b.width-k)/k,n=0,o=h;o<j;o++)l=g[o],b.ctx.fillStyle="rgb("+(l+100)+",50,50)",b.ctx.fillRect(n,height-l/2,m,l/2),n+=m+1;K.drawImage(b.canvas,x,y)}else if("tracks"==e){for(var p=F.cutOffVolume.gain.value>0,q=0;q<U.getTrackCount();q++){var r=f[q],s=b.width/U.getTrackCount(),t=s*q,u=W.getImage("oscilloscope");if(b.ctx.drawImage(u,t,0,s,b.height),r){b.ctx.lineWidth=2,b.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",b.ctx.beginPath();var v;if(p){d=r.fftSize,g=new Uint8Array(d),r.getByteTimeDomainData(g);for(var w=1*s/d,n=t,o=0;o<d;o++){var z=g[o]/128;v=z*b.height/2,0===o?b.ctx.moveTo(n,v):b.ctx.lineTo(n,v),n+=w}}else v=b.height/2,b.ctx.moveTo(t,v),b.ctx.lineTo(t+s,v);b.ctx.stroke()}}K.drawImage(b.canvas,b.left,b.top)}}},b.init(),b},n.vumeter=function(){function a(){l.width=m.width=g,l.height=m.height=h;var a=Math.floor(g/(i+j));o.clearRect(0,0,l.width,l.height),p.clearRect(0,0,m.width,m.height);for(var b=0;b<a;b++){var c=q,d=r;b>=a/3&&(c=s,d=t),b>=a/1.5&&(c=u,d=v),o.drawImage(c,b*(i+j),0,i,h),p.drawImage(d,b*(i+j),0,i,h)}}function b(a){for(var b=a.length,c=128,d=128,e=0;e<b;e++){var f=a[e];f<c?c=f:f>d&&(d=f)}return(d-c)/255}var c=n.panel();c.left=400,c.top=7;var d,e,f;F.context&&(d=F.context.createAnalyser(),d.minDecibels=-90,d.maxDecibels=-10,d.smoothingTimeConstant=.85,e=F.context.createAnalyser(),e.minDecibels=-90,e.maxDecibels=-10,e.smoothingTimeConstant=.85);var g=500,h=5,i=10,j=2,k=4,l=document.createElement("canvas"),m=document.createElement("canvas"),o=l.getContext("2d"),p=m.getContext("2d"),q=W.getImage("vu_green"),r=W.getImage("vu_green_active"),s=W.getImage("vu_yellow"),t=W.getImage("vu_yellow_active"),u=W.getImage("vu_red"),v=W.getImage("vu_red_active");return c.setSize(g,2*h+k),a(),c.needsRendering=!0,c.connect=function(a){if(F.context){var b=F.context.createChannelSplitter(2);a.connect(b),b.connect(d,0),b.connect(e,1),f=!0}},c.setProperties=function(b){g=b.width,c.left=b.left,c.setSize(g,2*h+k),a()},c.render=function(){if(f){var a,i;d.fftSize=32,e.fftSize=32,a=d.fftSize,i=new Uint8Array(a),d.getByteTimeDomainData(i);var j=b(i)*(Math.E-1);e.getByteTimeDomainData(i);var n=b(i)*(Math.E-1);c.ctx.fillStyle="#253352",c.ctx.fillRect(0,0,c.width,c.height),c.ctx.drawImage(l,0,0),c.ctx.drawImage(l,0,h+k);var o=Math.min(Math.floor(j*g),g),p=Math.min(Math.floor(n*g),g);o&&c.ctx.drawImage(m,0,0,o,h,0,0,o,h),p&&c.ctx.drawImage(m,0,0,p,h,0,h+k,p,h),K.drawImage(c.canvas,c.left,c.top)}},c},n.WaveForm=function(){function a(){return d||e}var b,c,d,e,f,g,h,i,j,k=n.element(),l=n.element(),m=n.scale9Panel(0,0,k.width,k.height,{img:W.getImage("panel_dark"),left:3,top:3,right:2,bottom:2});return m.ignoreEvents=!0,E.on(p.screenRefresh,function(){a()&&k.isVisible()&&k.refresh()}),k.onDragStart=function(a){e=!0,i=j=a.startX-k.left},k.onDrag=function(a){j=a.dragX-k.left},k.onTouchUp=function(a){e=!1},k.setSample=function(a){c=a,a?(b=c.data,h=b.length):(b=void 0,h=0),d=!1,l.needsRendering=!0,k.refresh()},k.play=function(a){d=!0,f=(new Date).getTime(),g=v/(2*a),k.refresh()},k.render=function(){if(this.needsRendering){if(l.needsRendering){if(l.clearCanvas(),l.setPosition(0,0),l.setSize(k.width,k.height),l.ctx.fillStyle="rgb(13, 19, 27)",l.ctx.fillRect(0,0,k.width,k.height),l.ctx.strokeStyle="rgba(120, 255, 50, 0.5)",m.width!=k.width&&m.setSize(k.width,k.height),l.ctx.drawImage(m.render(!0),0,0,k.width,k.height),b&&b.length&&k.width){var a=h/k.width,n=k.height/2;l.ctx.beginPath();for(var o=k.height/2-2,p=0;p<k.width;p++){var q=Math.floor(p*a),r=b[q]*o;0===p?l.ctx.moveTo(p,n+r):l.ctx.lineTo(p,n+r)}l.ctx.stroke()}l.needsRendering=!1}if(k.ctx.drawImage(l.canvas,0,0),d&&h){var s=(new Date).getTime(),t=s-f,q=g*t/1e3;if(q>h)d=!1;else{var u=q/h*k.width;k.ctx.fillStyle="rgb(241, 162, 71)",k.ctx.fillRect(u,0,2,k.height)}}if(c.loopRepeatLength>2){k.ctx.fillStyle="rgb(241, 220, 71)";var v=c.loopStart||0,w=v/h*k.width;w=Math.max(5,w),k.ctx.fillRect(w,0,2,k.height),w=(v+c.loopRepeatLength)/h*k.width,w=Math.min(w,k.width-6),k.ctx.fillRect(w,0,2,k.height)}e&&(k.ctx.fillStyle="rgba(241, 162, 71,0.3)",k.ctx.fillRect(i,0,j-i,k.height))}this.needsRendering=!1,k.parentCtx.drawImage(k.canvas,k.left,k.top,k.width,k.height)},k},V.sprite=function(a){var b={};if(b.canvas=document.createElement("canvas"),b.ctx=b.canvas.getContext("2d"),a&&(a.width&&(b.canvas.width=a.width,b.canvas.height=a.height||a.width),a.img)){var c=a.x||0,d=a.y||0,e=b.canvas.width,f=b.canvas.height;b.ctx.drawImage(a.img,c,d,e,f,0,0,e,f)}return b};var $={RAW_8BIT:1,WAVE_PCM:2,IFF_8SVX:3,MP3:4};FilterChain=function(a){function b(){d.volumeValue(C)}function c(a){for(var b,c="number"==typeof a?a:50,d=44100,e=new Float32Array(d),f=Math.PI/180,g=0;g<d;++g)b=2*g/d-1,e[g]=(3+c)*b*20*f/(Math.PI+c*Math.abs(b));return e}var d={};a=a||{volume:!0,panning:!0};var e,f,g,h,i,j,k,l,n,p,q,r=a.volume,s=a.panning,t=a.high,u=a.mid,v=a.low,w=a.lowPass,x=a.reverb,y=a.distortion,z=0,A=0,B=0,C=70,D=0,E=30,G=F.context;if(t&&(i=G.createBiquadFilter(),i.type="highshelf",i.frequency.value=3200,i.gain.value=B,e=i,f=i),u&&(j=G.createBiquadFilter(),j.type="peaking",j.frequency.value=1e3,j.Q.value=.5,j.gain.value=A,e||(e=j),f&&f.connect(j),f=j),v&&(k=G.createBiquadFilter(),k.type="lowshelf",k.frequency.value=320,k.gain.value=z,e||(e=k),f&&f.connect(k),f=k),w&&(l=G.createBiquadFilter(),l.type="lowpass",l.frequency.value=5e3,e||(e=l),f&&f.connect(l),f=l),x&&(n=G.createConvolver(),p=G.createGain(),p.gain.value=0,e||(e=p),f&&f.connect(p),p.connect(n),g=n),y){var H=G.createWaveShaper();H.curve=c(400),H.oversample="4x"}return r&&(h=G.createGain(),e||(e=h),f&&f.connect(h),g&&g.connect(h),f=h),s&&(q=F.context.createStereoPanner(),e||(e=q),f&&f.connect(q),f=q),d.lowValue=function(a){if(v){if("undefined"!=typeof a){var b=20;z=a,k.gain.value=z*b}return z}},d.midValue=function(a){if(u){if("undefined"!=typeof a){var b=20;A=a,j.gain.value=A*b}return A}},d.highValue=function(a){if(t){if("undefined"!=typeof a){var b=20;B=a,i.gain.value=B*b}return B}},d.lowPassFrequencyValue=function(a){if(w){var b=40,c=F.context.sampleRate/2,d=Math.log(c/b)/Math.LN2,e=Math.pow(2,d*(a-1));l.frequency.value=c*e}},d.lowPassQualityValue=function(a){w&&(l.Q.value=a*E)},d.reverbValue=function(a){if(x){if(!n.buffer){var b=m.audio["data/reverb/sportcentre.m4a"];if(b)n.buffer=b;else{var c=L();c.load(["data/reverb/sportcentre.m4a"],o.audio,function(){n.buffer=m.audio["data/reverb/sportcentre.m4a"]})}}var d=100,e=parseInt(a)/d;p.gain.value=e*e}},d.volumeValue=function(a){if(r){if("undefined"!=typeof a){var b=100;C=a;var c=a/b;h.gain.value=c*c}return C}},d.panningValue=function(a){if(s)return"undefined"!=typeof a&&(D=a,q.pan.value=D),D},d.input=function(){return e},d.output=function(){return f},b(),d},function(a){"use strict";function b(){function a(a){var b,c,e,f,g,h,j=d.dyn_tree,k=d.stat_desc.static_tree,l=d.stat_desc.extra_bits,m=d.stat_desc.extra_base,n=d.stat_desc.max_length,p=0;for(f=0;f<=i;f++)a.bl_count[f]=0;for(j[2*a.heap[a.heap_max]+1]=0,b=a.heap_max+1;b<o;b++)c=a.heap[b],f=j[2*j[2*c+1]+1]+1,f>n&&(f=n,p++),j[2*c+1]=f,c>d.max_code||(a.bl_count[f]++,g=0,c>=m&&(g=l[c-m]),h=j[2*c],a.opt_len+=h*(f+g),k&&(a.static_len+=h*(k[2*c+1]+g)));if(0!==p){do{for(f=n-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[n]--,p-=2}while(p>0);for(f=n;0!==f;f--)for(c=a.bl_count[f];0!==c;)e=a.heap[--b],e>d.max_code||(j[2*e+1]!=f&&(a.opt_len+=(f-j[2*e+1])*j[2*e],j[2*e+1]=f),c--)}}function b(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function c(a,c,d){var e,f,g,h=[],j=0;for(e=1;e<=i;e++)h[e]=j=j+d[e-1]<<1;for(f=0;f<=c;f++)g=a[2*f+1],0!==g&&(a[2*f]=b(h[g]++,g))}var d=this;d.build_tree=function(b){var e,f,g,h=d.dyn_tree,i=d.stat_desc.static_tree,j=d.stat_desc.elems,k=-1;for(b.heap_len=0,b.heap_max=o,e=0;e<j;e++)0!==h[2*e]?(b.heap[++b.heap_len]=k=e,b.depth[e]=0):h[2*e+1]=0;for(;b.heap_len<2;)g=b.heap[++b.heap_len]=k<2?++k:0,h[2*g]=1,b.depth[g]=0,b.opt_len--,i&&(b.static_len-=i[2*g+1]);for(d.max_code=k,e=Math.floor(b.heap_len/2);e>=1;e--)b.pqdownheap(h,e);g=j;do e=b.heap[1],b.heap[1]=b.heap[b.heap_len--],b.pqdownheap(h,1),f=b.heap[1],b.heap[--b.heap_max]=e,b.heap[--b.heap_max]=f,h[2*g]=h[2*e]+h[2*f],b.depth[g]=Math.max(b.depth[e],b.depth[f])+1,h[2*e+1]=h[2*f+1]=g,b.heap[1]=g++,b.pqdownheap(h,1);while(b.heap_len>=2);b.heap[--b.heap_max]=b.heap[1],a(b),c(h,d.max_code,b.bl_count)}}function c(a,b,c,d,e){var f=this;f.static_tree=a,f.extra_bits=b,f.extra_base=c,f.elems=d,f.max_length=e}function d(a,b,c,d,e){var f=this;f.good_length=a,f.max_lazy=b,f.nice_length=c,f.max_chain=d,f.func=e}function e(a,b,c,d){var e=a[2*b],f=a[2*c];return e<f||e==f&&d[b]<=d[c]}function f(){function a(){var a;for(Ea=2*Aa,Ga[Ia-1]=0,a=0;a<Ia-1;a++)Ga[a]=0;Va=P[Wa].max_lazy,Ya=P[Wa].good_length,Za=P[Wa].nice_length,Ua=P[Wa].max_chain,Qa=0,Ma=0,Sa=0,Na=Ta=ba-1,Pa=0,Ha=0}function d(){var a;for(a=0;a<n;a++)$a[2*a]=0;for(a=0;a<j;a++)_a[2*a]=0;for(a=0;a<k;a++)ab[2*a]=0;$a[2*p]=1,bb.opt_len=bb.static_len=0,hb=jb=0}function f(){cb.dyn_tree=$a,cb.stat_desc=c.static_l_desc,db.dyn_tree=_a,db.stat_desc=c.static_d_desc,eb.dyn_tree=ab,eb.stat_desc=c.static_bl_desc,lb=0,mb=0,kb=8,d()}function g(a,b){var c,d,e=-1,f=a[1],g=0,h=7,i=4;for(0===f&&(h=138,i=3),a[2*(b+1)+1]=65535,c=0;c<=b;c++)d=f,f=a[2*(c+1)+1],++g<h&&d==f||(g<i?ab[2*d]+=g:0!==d?(d!=e&&ab[2*d]++,ab[2*r]++):g<=10?ab[2*s]++:ab[2*t]++,g=0,e=d,0===f?(h=138,i=3):d==f?(h=6,i=3):(h=7,i=4))}function h(){var a;for(g($a,cb.max_code),g(_a,db.max_code),eb.build_tree(bb),a=k-1;a>=3&&0===ab[2*b.bl_order[a]+1];a--);return bb.opt_len+=3*(a+1)+5+5+4,a}function i(a){bb.pending_buf[bb.pending++]=a}function l(a){i(255&a),i(a>>>8&255)}function o(a){i(a>>8&255),i(255&a&255)}function q(a,b){var c,d=b;mb>u-d?(c=a,lb|=c<<mb&65535,l(lb),lb=c>>>u-mb,mb+=d-u):(lb|=a<<mb&65535,mb+=d)}function J(a,b){var c=2*a;q(65535&b[c],65535&b[c+1])}function ea(a,b){var c,d,e=-1,f=a[1],g=0,h=7,i=4;for(0===f&&(h=138,i=3),c=0;c<=b;c++)if(d=f,f=a[2*(c+1)+1],!(++g<h&&d==f)){if(g<i){do J(d,ab);while(0!==--g)}else 0!==d?(d!=e&&(J(d,ab),g--),J(r,ab),q(g-3,2)):g<=10?(J(s,ab),q(g-3,3)):(J(t,ab),q(g-11,7));g=0,e=d,0===f?(h=138,i=3):d==f?(h=6,i=3):(h=7,i=4)}}function fa(a,c,d){var e;for(q(a-257,5),q(c-1,5),q(d-4,4),e=0;e<d;e++)q(ab[2*b.bl_order[e]+1],3);ea($a,a-1),ea(_a,c-1)}function ga(){16==mb?(l(lb),lb=0,mb=0):mb>=8&&(i(255&lb),lb>>>=8,mb-=8)}function ha(){q(_<<1,3),J(p,c.static_ltree),ga(),1+kb+10-mb<9&&(q(_<<1,3),J(p,c.static_ltree),ga()),kb=7}function ia(a,c){var d,e,f;if(bb.pending_buf[ib+2*hb]=a>>>8&255,bb.pending_buf[ib+2*hb+1]=255&a,bb.pending_buf[fb+hb]=255&c,hb++,0===a?$a[2*c]++:(jb++,a--,$a[2*(b._length_code[c]+m+1)]++,_a[2*b.d_code(a)]++),0===(8191&hb)&&Wa>2){for(d=8*hb,e=Qa-Ma,f=0;f<j;f++)d+=_a[2*f]*(5+b.extra_dbits[f]);if(d>>>=3,jb<Math.floor(hb/2)&&d<Math.floor(e/2))return!0}return hb==gb-1}function ja(a,c){var d,e,f,g,h=0;if(0!==hb)do d=bb.pending_buf[ib+2*h]<<8&65280|255&bb.pending_buf[ib+2*h+1],e=255&bb.pending_buf[fb+h],h++,0===d?J(e,a):(f=b._length_code[e],J(f+m+1,a),g=b.extra_lbits[f],0!==g&&(e-=b.base_length[f],q(e,g)),d--,f=b.d_code(d),J(f,c),g=b.extra_dbits[f],0!==g&&(d-=b.base_dist[f],q(d,g)));while(h<hb);J(p,a),kb=a[2*p+1]}function ka(){mb>8?l(lb):mb>0&&i(255&lb),lb=0,mb=0}function la(a,b,c){ka(),kb=8,c&&(l(b),l(~b)),bb.pending_buf.set(Da.subarray(a,a+b),bb.pending),bb.pending+=b}function ma(a,b,c){q(($<<1)+(c?1:0),3),la(a,b,!0)}function na(a,b,e){var f,g,i=0;Wa>0?(cb.build_tree(bb),db.build_tree(bb),i=h(),f=bb.opt_len+3+7>>>3,g=bb.static_len+3+7>>>3,g<=f&&(f=g)):f=g=b+5,b+4<=f&&a!=-1?ma(a,b,e):g==f?(q((_<<1)+(e?1:0),3),ja(c.static_ltree,c.static_dtree)):(q((aa<<1)+(e?1:0),3),fa(cb.max_code+1,db.max_code+1,i+1),ja($a,_a)),d(),e&&ka()}function oa(a){na(Ma>=0?Ma:-1,Qa-Ma,a),Ma=Qa,va.flush_pending()}function pa(){var a,b,c,d;do{if(d=Ea-Sa-Qa,0===d&&0===Qa&&0===Sa)d=Aa;else if(d==-1)d--;else if(Qa>=Aa+Aa-da){Da.set(Da.subarray(Aa,Aa+Aa),0),Ra-=Aa,Qa-=Aa,Ma-=Aa,a=Ia,c=a;do b=65535&Ga[--c],Ga[c]=b>=Aa?b-Aa:0;while(0!==--a);a=Aa,c=a;do b=65535&Fa[--c],Fa[c]=b>=Aa?b-Aa:0;while(0!==--a);d+=Aa}if(0===va.avail_in)return;a=va.read_buf(Da,Qa+Sa,d),Sa+=a,Sa>=ba&&(Ha=255&Da[Qa],Ha=(Ha<<La^255&Da[Qa+1])&Ka)}while(Sa<da&&0!==va.avail_in)}function qa(a){var b,c=65535;for(c>xa-5&&(c=xa-5);;){if(Sa<=1){if(pa(),0===Sa&&a==z)return R;if(0===Sa)break}if(Qa+=Sa,Sa=0,b=Ma+c,(0===Qa||Qa>=b)&&(Sa=Qa-b,Qa=b,oa(!1),0===va.avail_out))return R;if(Qa-Ma>=Aa-da&&(oa(!1),0===va.avail_out))return R}return oa(a==C),0===va.avail_out?a==C?T:R:a==C?U:S}function ra(a){var b,c,d=Ua,e=Qa,f=Ta,g=Qa>Aa-da?Qa-(Aa-da):0,h=Za,i=Ca,j=Qa+ca,k=Da[e+f-1],l=Da[e+f];Ta>=Ya&&(d>>=2),h>Sa&&(h=Sa);do if(b=a,Da[b+f]==l&&Da[b+f-1]==k&&Da[b]==Da[e]&&Da[++b]==Da[e+1]){e+=2,b++;do;while(Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&Da[++e]==Da[++b]&&e<j);if(c=ca-(j-e),e=j-ca,c>f){if(Ra=a,f=c,c>=h)break;k=Da[e+f-1],l=Da[e+f]}}while((a=65535&Fa[a&i])>g&&0!==--d);return f<=Sa?f:Sa}function sa(a){for(var b,c=0;;){if(Sa<da){if(pa(),Sa<da&&a==z)return R;if(0===Sa)break}if(Sa>=ba&&(Ha=(Ha<<La^255&Da[Qa+(ba-1)])&Ka,c=65535&Ga[Ha],Fa[Qa&Ca]=Ga[Ha],Ga[Ha]=Qa),0!==c&&(Qa-c&65535)<=Aa-da&&Xa!=x&&(Na=ra(c)),Na>=ba)if(b=ia(Qa-Ra,Na-ba),Sa-=Na,Na<=Va&&Sa>=ba){Na--;do Qa++,Ha=(Ha<<La^255&Da[Qa+(ba-1)])&Ka,c=65535&Ga[Ha],Fa[Qa&Ca]=Ga[Ha],Ga[Ha]=Qa;while(0!==--Na);Qa++}else Qa+=Na,Na=0,Ha=255&Da[Qa],Ha=(Ha<<La^255&Da[Qa+1])&Ka;else b=ia(0,255&Da[Qa]),Sa--,Qa++;if(b&&(oa(!1),0===va.avail_out))return R}return oa(a==C),0===va.avail_out?a==C?T:R:a==C?U:S}function ta(a){for(var b,c,d=0;;){if(Sa<da){if(pa(),Sa<da&&a==z)return R;if(0===Sa)break}if(Sa>=ba&&(Ha=(Ha<<La^255&Da[Qa+(ba-1)])&Ka,d=65535&Ga[Ha],Fa[Qa&Ca]=Ga[Ha],Ga[Ha]=Qa),Ta=Na,Oa=Ra,Na=ba-1,0!==d&&Ta<Va&&(Qa-d&65535)<=Aa-da&&(Xa!=x&&(Na=ra(d)),Na<=5&&(Xa==w||Na==ba&&Qa-Ra>4096)&&(Na=ba-1)),Ta>=ba&&Na<=Ta){c=Qa+Sa-ba,b=ia(Qa-1-Oa,Ta-ba),Sa-=Ta-1,Ta-=2;do++Qa<=c&&(Ha=(Ha<<La^255&Da[Qa+(ba-1)])&Ka,d=65535&Ga[Ha],Fa[Qa&Ca]=Ga[Ha],Ga[Ha]=Qa);while(0!==--Ta);if(Pa=0,Na=ba-1,Qa++,b&&(oa(!1),0===va.avail_out))return R}else if(0!==Pa){if(b=ia(0,255&Da[Qa-1]),b&&oa(!1),Qa++,Sa--,0===va.avail_out)return R}else Pa=1,Qa++,Sa--}return 0!==Pa&&(b=ia(0,255&Da[Qa-1]),Pa=0),oa(a==C),0===va.avail_out?a==C?T:R:a==C?U:S}function ua(b){return b.total_in=b.total_out=0,b.msg=null,bb.pending=0,bb.pending_out=0,wa=X,za=z,f(),a(),D}var va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,_a,ab,bb=this,cb=new b,db=new b,eb=new b;bb.depth=[];var fb,gb,hb,ib,jb,kb,lb,mb;bb.bl_count=[],bb.heap=[],$a=[],_a=[],ab=[],bb.pqdownheap=function(a,b){for(var c=bb.heap,d=c[b],f=b<<1;f<=bb.heap_len&&(f<bb.heap_len&&e(a,c[f+1],c[f],bb.depth)&&f++,!e(a,d,c[f],bb.depth));)c[b]=c[f],b=f,f<<=1;c[b]=d},bb.deflateInit=function(a,b,c,d,e,f){return d||(d=Z),e||(e=L),f||(f=y),a.msg=null,b==v&&(b=6),e<1||e>K||d!=Z||c<9||c>15||b<0||b>9||f<0||f>x?G:(a.dstate=bb,Ba=c,Aa=1<<Ba,Ca=Aa-1,Ja=e+7,Ia=1<<Ja,Ka=Ia-1,La=Math.floor((Ja+ba-1)/ba),Da=new Uint8Array(2*Aa),Fa=[],Ga=[],gb=1<<e+6,bb.pending_buf=new Uint8Array(4*gb),xa=4*gb,ib=Math.floor(gb/2),fb=3*gb,Wa=b,Xa=f,ya=255&d,ua(a))},bb.deflateEnd=function(){return wa!=W&&wa!=X&&wa!=Y?G:(bb.pending_buf=null,Ga=null,Fa=null,Da=null,bb.dstate=null,wa==X?H:D)},bb.deflateParams=function(a,b,c){var d=D;return b==v&&(b=6),b<0||b>9||c<0||c>x?G:(P[Wa].func!=P[b].func&&0!==a.total_in&&(d=a.deflate(A)),Wa!=b&&(Wa=b,Va=P[Wa].max_lazy,Ya=P[Wa].good_length,Za=P[Wa].nice_length,Ua=P[Wa].max_chain),Xa=c,d)},bb.deflateSetDictionary=function(a,b,c){var d,e=c,f=0;if(!b||wa!=W)return G;if(e<ba)return D;for(e>Aa-da&&(e=Aa-da,f=c-e),Da.set(b.subarray(f,f+e),0),Qa=e,Ma=e,Ha=255&Da[0],Ha=(Ha<<La^255&Da[1])&Ka,d=0;d<=e-ba;d++)Ha=(Ha<<La^255&Da[d+(ba-1)])&Ka,Fa[d&Ca]=Ga[Ha],Ga[Ha]=d;return D},bb.deflate=function(a,b){var c,d,e,f,g;if(b>C||b<0)return G;if(!a.next_out||!a.next_in&&0!==a.avail_in||wa==Y&&b!=C)return a.msg=Q[F-G],G;if(0===a.avail_out)return a.msg=Q[F-I],I;if(va=a,f=za,za=b,wa==W&&(d=Z+(Ba-8<<4)<<8,e=(Wa-1&255)>>1,e>3&&(e=3),d|=e<<6,0!==Qa&&(d|=V),d+=31-d%31,wa=X,o(d)),0!==bb.pending){if(va.flush_pending(),0===va.avail_out)return za=-1,D}else if(0===va.avail_in&&b<=f&&b!=C)return va.msg=Q[F-I],I;if(wa==Y&&0!==va.avail_in)return a.msg=Q[F-I],I;if(0!==va.avail_in||0!==Sa||b!=z&&wa!=Y){switch(g=-1,P[Wa].func){case M:g=qa(b);break;case N:g=sa(b);break;case O:g=ta(b)}if(g!=T&&g!=U||(wa=Y),g==R||g==T)return 0===va.avail_out&&(za=-1),D;if(g==S){if(b==A)ha();else if(ma(0,0,!1),b==B)for(c=0;c<Ia;c++)Ga[c]=0;if(va.flush_pending(),0===va.avail_out)return za=-1,D}}return b!=C?D:E}}function g(){var a=this;a.next_in_index=0,a.next_out_index=0,a.avail_in=0,a.total_in=0,a.avail_out=0,a.total_out=0}function h(a){var b=this,c=new g,d=512,e=z,f=new Uint8Array(d),h=a?a.level:v;"undefined"==typeof h&&(h=v),c.deflateInit(h),c.next_out=f,b.append=function(a,b){var g,h,i=[],j=0,k=0,l=0;if(a.length){c.next_in_index=0,c.next_in=a,c.avail_in=a.length;do{if(c.next_out_index=0,c.avail_out=d,g=c.deflate(e),g!=D)throw new Error("deflating: "+c.msg);c.next_out_index&&i.push(c.next_out_index==d?new Uint8Array(f):new Uint8Array(f.subarray(0,c.next_out_index))),l+=c.next_out_index,b&&c.next_in_index>0&&c.next_in_index!=j&&(b(c.next_in_index),j=c.next_in_index)}while(c.avail_in>0||0===c.avail_out);return h=new Uint8Array(l),i.forEach(function(a){h.set(a,k),k+=a.length}),h}},b.flush=function(){var a,b,e=[],g=0,h=0;do{if(c.next_out_index=0,c.avail_out=d,a=c.deflate(C),a!=E&&a!=D)throw new Error("deflating: "+c.msg);d-c.avail_out>0&&e.push(new Uint8Array(f.subarray(0,c.next_out_index))),h+=c.next_out_index}while(c.avail_in>0||0===c.avail_out);return c.deflateEnd(),b=new Uint8Array(h),e.forEach(function(a){b.set(a,g),g+=a.length}),b}}var i=15,j=30,k=19,l=29,m=256,n=m+1+l,o=2*n+1,p=256,q=7,r=16,s=17,t=18,u=16,v=-1,w=1,x=2,y=0,z=0,A=1,B=3,C=4,D=0,E=1,F=2,G=-2,H=-3,I=-5,J=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];b._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],b.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],b.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],b.d_code=function(a){return a<256?J[a]:J[256+(a>>>7)]},b.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],b.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],c.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],c.static_l_desc=new c(c.static_ltree,b.extra_lbits,m+1,n,i),c.static_d_desc=new c(c.static_dtree,b.extra_dbits,0,j,i),c.static_bl_desc=new c(null,b.extra_blbits,0,k,q);var K=9,L=8,M=0,N=1,O=2,P=[new d(0,0,0,0,M),new d(4,4,8,4,N),new d(4,5,16,8,N),new d(4,6,32,32,N),new d(4,4,16,16,O),new d(8,16,32,32,O),new d(8,16,128,128,O),new d(8,32,128,256,O),new d(32,128,258,1024,O),new d(32,258,258,4096,O)],Q=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],R=0,S=1,T=2,U=3,V=32,W=42,X=113,Y=666,Z=8,$=0,_=1,aa=2,ba=3,ca=258,da=ca+ba+1;g.prototype={deflateInit:function(a,b){var c=this;return c.dstate=new f,b||(b=i),c.dstate.deflateInit(c,a,b)},deflate:function(a){var b=this;return b.dstate?b.dstate.deflate(b,a):G},deflateEnd:function(){var a=this;if(!a.dstate)return G;var b=a.dstate.deflateEnd();return a.dstate=null,b},deflateParams:function(a,b){var c=this;return c.dstate?c.dstate.deflateParams(c,a,b):G},deflateSetDictionary:function(a,b){var c=this;return c.dstate?c.dstate.deflateSetDictionary(c,a,b):G},read_buf:function(a,b,c){var d=this,e=d.avail_in;return e>c&&(e=c),0===e?0:(d.avail_in-=e,a.set(d.next_in.subarray(d.next_in_index,d.next_in_index+e),b),d.next_in_index+=e,d.total_in+=e,e)},flush_pending:function(){var a=this,b=a.dstate.pending;b>a.avail_out&&(b=a.avail_out),0!==b&&(a.next_out.set(a.dstate.pending_buf.subarray(a.dstate.pending_out,a.dstate.pending_out+b),a.next_out_index),a.next_out_index+=b,a.dstate.pending_out+=b,a.total_out+=b,a.avail_out-=b,a.dstate.pending-=b,0===a.dstate.pending&&(a.dstate.pending_out=0))}};var ea=a.zip||a;ea.Deflater=ea._jzlib_Deflater=h}(this),function(a){"use strict";function b(){function a(a,b,c,d,j,k,l,n,p,r,s){var t,u,v,w,x,y,z,A,C,D,E,F,G,H,I;D=0,x=c;do e[a[b+D]]++,D++,x--;while(0!==x);if(e[0]==c)return l[0]=-1,n[0]=0,i;for(A=n[0],y=1;y<=B&&0===e[y];y++);for(z=y,A<y&&(A=y),x=B;0!==x&&0===e[x];x--);for(v=x,A>x&&(A=x),n[0]=A,H=1<<y;y<x;y++,H<<=1)if((H-=e[y])<0)return m;if((H-=e[x])<0)return m;for(e[x]+=H,h[1]=y=0,D=1,G=2;0!==--x;)h[G]=y+=e[D],G++,D++;x=0,D=0;do 0!==(y=a[b+D])&&(s[h[y]++]=x),D++;while(++x<c);for(c=h[v],h[0]=x=0,D=0,w=-1,F=-A,g[0]=0,E=0,I=0;z<=v;z++)for(t=e[z];0!==t--;){for(;z>F+A;){if(w++,F+=A,I=v-F,I=I>A?A:I,(u=1<<(y=z-F))>t+1&&(u-=t+1,G=z,y<I))for(;++y<I&&!((u<<=1)<=e[++G]);)u-=e[G];if(I=1<<y,r[0]+I>q)return m;g[w]=E=r[0],r[0]+=I,0!==w?(h[w]=x,f[0]=y,f[1]=A,y=x>>>F-A,f[2]=E-g[w-1]-y,p.set(f,3*(g[w-1]+y))):l[0]=E}for(f[1]=z-F,D>=c?f[0]=192:s[D]<d?(f[0]=s[D]<256?0:96,f[2]=s[D++]):(f[0]=k[s[D]-d]+16+64,f[2]=j[s[D++]-d]),u=1<<z-F,y=x>>>F;y<I;y+=u)p.set(f,3*(E+y));for(y=1<<z-1;0!==(x&y);y>>>=1)x^=y;for(x^=y,C=(1<<F)-1;(x&C)!=h[w];)w--,F-=A,C=(1<<F)-1}return 0!==H&&1!=v?o:i}function b(a){var b;for(c||(c=[],d=[],e=new Int32Array(B+1),f=[],g=new Int32Array(B),h=new Int32Array(B+1)),d.length<a&&(d=[]),b=0;b<a;b++)d[b]=0;for(b=0;b<B+1;b++)e[b]=0;for(b=0;b<3;b++)f[b]=0;g.set(e.subarray(0,B),0),h.set(e.subarray(0,B+1),0)}var c,d,e,f,g,h,j=this;j.inflate_trees_bits=function(e,f,g,h,i){var j;return b(19),c[0]=0,j=a(e,0,19,19,null,null,g,f,h,c,d),j==m?i.msg="oversubscribed dynamic bit lengths tree":j!=o&&0!==f[0]||(i.msg="incomplete dynamic bit lengths tree",j=m),j},j.inflate_trees_dynamic=function(e,f,g,h,j,k,l,p,q){var r;return b(288),c[0]=0,r=a(g,0,e,257,x,y,k,h,p,c,d),r!=i||0===h[0]?(r==m?q.msg="oversubscribed literal/length tree":r!=n&&(q.msg="incomplete literal/length tree",r=m),r):(b(288),r=a(g,e,f,0,z,A,l,j,p,c,d),r!=i||0===j[0]&&e>257?(r==m?q.msg="oversubscribed distance tree":r==o?(q.msg="incomplete distance tree",r=m):r!=n&&(q.msg="empty distance tree with lengths",r=m),r):i)}}function c(){function a(a,b,c,d,e,f,g,h){var k,l,n,o,q,r,s,t,u,v,w,x,y,z,A,B;s=h.next_in_index,t=h.avail_in,q=g.bitb,r=g.bitk,u=g.write,v=u<g.read?g.read-u-1:g.end-u,w=p[a],x=p[b];do{for(;r<20;)t--,q|=(255&h.read_byte(s++))<<r,r+=8;if(k=q&w,l=c,n=d,B=3*(n+k),0!==(o=l[B]))for(;;){if(q>>=l[B+1],r-=l[B+1],0!==(16&o)){for(o&=15,y=l[B+2]+(q&p[o]),q>>=o,r-=o;r<15;)t--,q|=(255&h.read_byte(s++))<<r,r+=8;for(k=q&x,l=e,n=f,B=3*(n+k),o=l[B];;){if(q>>=l[B+1],r-=l[B+1],0!==(16&o)){for(o&=15;r<o;)t--,q|=(255&h.read_byte(s++))<<r,r+=8;if(z=l[B+2]+(q&p[o]),q>>=o,r-=o,v-=y,u>=z)A=u-z,u-A>0&&2>u-A?(g.window[u++]=g.window[A++],g.window[u++]=g.window[A++],y-=2):(g.window.set(g.window.subarray(A,A+2),u),u+=2,A+=2,y-=2);else{A=u-z;do A+=g.end;while(A<0);if(o=g.end-A,y>o){if(y-=o,u-A>0&&o>u-A){do g.window[u++]=g.window[A++];while(0!==--o)}else g.window.set(g.window.subarray(A,A+o),u),u+=o,A+=o,o=0;A=0}}if(u-A>0&&y>u-A){do g.window[u++]=g.window[A++];while(0!==--y)}else g.window.set(g.window.subarray(A,A+y),u),u+=y,A+=y,y=0;break}if(0!==(64&o))return h.msg="invalid distance code",y=h.avail_in-t,y=r>>3<y?r>>3:y,t+=y,s-=y,r-=y<<3,g.bitb=q,g.bitk=r,h.avail_in=t,h.total_in+=s-h.next_in_index,h.next_in_index=s,g.write=u,m;k+=l[B+2],k+=q&p[o],B=3*(n+k),o=l[B]}break}if(0!==(64&o))return 0!==(32&o)?(y=h.avail_in-t,y=r>>3<y?r>>3:y,t+=y,s-=y,r-=y<<3,g.bitb=q,g.bitk=r,h.avail_in=t,h.total_in+=s-h.next_in_index,h.next_in_index=s,g.write=u,j):(h.msg="invalid literal/length code",y=h.avail_in-t,y=r>>3<y?r>>3:y,t+=y,s-=y,r-=y<<3,g.bitb=q,g.bitk=r,h.avail_in=t,h.total_in+=s-h.next_in_index,h.next_in_index=s,g.write=u,m);if(k+=l[B+2],k+=q&p[o],B=3*(n+k),0===(o=l[B])){q>>=l[B+1],r-=l[B+1],g.window[u++]=l[B+2],v--;break}}else q>>=l[B+1],r-=l[B+1],g.window[u++]=l[B+2],v--}while(v>=258&&t>=10);return y=h.avail_in-t,y=r>>3<y?r>>3:y,t+=y,s-=y,r-=y<<3,g.bitb=q,g.bitk=r,h.avail_in=t,h.total_in+=s-h.next_in_index,h.next_in_index=s,g.write=u,i}var b,c,d,e,f=this,g=0,h=0,k=0,n=0,o=0,q=0,r=0,s=0,t=0,u=0;f.init=function(a,f,g,h,i,j){b=C,r=a,s=f,d=g,t=h,e=i,u=j,c=null},f.proc=function(f,v,w){var x,y,z,A,B,M,N,O=0,P=0,Q=0;for(Q=v.next_in_index,A=v.avail_in,O=f.bitb,P=f.bitk,B=f.write,M=B<f.read?f.read-B-1:f.end-B;;)switch(b){case C:if(M>=258&&A>=10&&(f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,w=a(r,s,d,t,e,u,f,v),Q=v.next_in_index,A=v.avail_in,O=f.bitb,P=f.bitk,B=f.write,M=B<f.read?f.read-B-1:f.end-B,w!=i)){b=w==j?J:L;break}k=r,c=d,h=t,b=D;case D:for(x=k;P<x;){if(0===A)return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);w=i,A--,O|=(255&v.read_byte(Q++))<<P,P+=8}if(y=3*(h+(O&p[x])),O>>>=c[y+1],P-=c[y+1],z=c[y],0===z){n=c[y+2],b=I;break}if(0!==(16&z)){o=15&z,g=c[y+2],b=E;break}if(0===(64&z)){k=z,h=y/3+c[y+2];break}if(0!==(32&z)){b=J;break}return b=L,v.msg="invalid literal/length code",w=m,f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);case E:for(x=o;P<x;){if(0===A)return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);w=i,A--,O|=(255&v.read_byte(Q++))<<P,P+=8}g+=O&p[x],O>>=x,P-=x,k=s,c=e,h=u,b=F;case F:for(x=k;P<x;){if(0===A)return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);w=i,A--,O|=(255&v.read_byte(Q++))<<P,P+=8}if(y=3*(h+(O&p[x])),O>>=c[y+1],P-=c[y+1],z=c[y],0!==(16&z)){o=15&z,q=c[y+2],b=G;break}if(0===(64&z)){k=z,h=y/3+c[y+2];break}return b=L,v.msg="invalid distance code",w=m,f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);case G:for(x=o;P<x;){if(0===A)return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);w=i,A--,O|=(255&v.read_byte(Q++))<<P,P+=8}q+=O&p[x],O>>=x,P-=x,b=H;case H:for(N=B-q;N<0;)N+=f.end;for(;0!==g;){if(0===M&&(B==f.end&&0!==f.read&&(B=0,M=B<f.read?f.read-B-1:f.end-B),0===M&&(f.write=B,w=f.inflate_flush(v,w),B=f.write,M=B<f.read?f.read-B-1:f.end-B,B==f.end&&0!==f.read&&(B=0,M=B<f.read?f.read-B-1:f.end-B),0===M)))return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);f.window[B++]=f.window[N++],
M--,N==f.end&&(N=0),g--}b=C;break;case I:if(0===M&&(B==f.end&&0!==f.read&&(B=0,M=B<f.read?f.read-B-1:f.end-B),0===M&&(f.write=B,w=f.inflate_flush(v,w),B=f.write,M=B<f.read?f.read-B-1:f.end-B,B==f.end&&0!==f.read&&(B=0,M=B<f.read?f.read-B-1:f.end-B),0===M)))return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);w=i,f.window[B++]=n,M--,b=C;break;case J:if(P>7&&(P-=8,A++,Q--),f.write=B,w=f.inflate_flush(v,w),B=f.write,M=B<f.read?f.read-B-1:f.end-B,f.read!=f.write)return f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);b=K;case K:return w=j,f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);case L:return w=m,f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w);default:return w=l,f.bitb=O,f.bitk=P,v.avail_in=A,v.total_in+=Q-v.next_in_index,v.next_in_index=Q,f.write=B,f.inflate_flush(v,w)}},f.free=function(){}}function d(a,d){var e,f=this,g=N,h=0,k=0,n=0,r=[0],s=[0],t=new c,u=0,v=new Int32Array(3*q),w=0,x=new b;f.bitk=0,f.bitb=0,f.window=new Uint8Array(d),f.end=d,f.read=0,f.write=0,f.reset=function(a,b){b&&(b[0]=w),g==T&&t.free(a),g=N,f.bitk=0,f.bitb=0,f.read=f.write=0},f.reset(a,null),f.inflate_flush=function(a,b){var c,d,e;return d=a.next_out_index,e=f.read,c=(e<=f.write?f.write:f.end)-e,c>a.avail_out&&(c=a.avail_out),0!==c&&b==o&&(b=i),a.avail_out-=c,a.total_out+=c,a.next_out.set(f.window.subarray(e,e+c),d),d+=c,e+=c,e==f.end&&(e=0,f.write==f.end&&(f.write=0),c=f.write-e,c>a.avail_out&&(c=a.avail_out),0!==c&&b==o&&(b=i),a.avail_out-=c,a.total_out+=c,a.next_out.set(f.window.subarray(e,e+c),d),d+=c,e+=c),a.next_out_index=d,f.read=e,b},f.proc=function(a,c){var d,o,q,w,y,z,A,B;for(w=a.next_in_index,y=a.avail_in,o=f.bitb,q=f.bitk,z=f.write,A=z<f.read?f.read-z-1:f.end-z;;)switch(g){case N:for(;q<3;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}switch(d=7&o,u=1&d,d>>>1){case 0:o>>>=3,q-=3,d=7&q,o>>>=d,q-=d,g=O;break;case 1:var C=[],D=[],E=[[]],F=[[]];b.inflate_trees_fixed(C,D,E,F),t.init(C[0],D[0],E[0],0,F[0],0),o>>>=3,q-=3,g=T;break;case 2:o>>>=3,q-=3,g=Q;break;case 3:return o>>>=3,q-=3,g=W,a.msg="invalid block type",c=m,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c)}break;case O:for(;q<32;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}if((~o>>>16&65535)!=(65535&o))return g=W,a.msg="invalid stored block lengths",c=m,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);h=65535&o,o=q=0,g=0!==h?P:0!==u?U:N;break;case P:if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);if(0===A&&(z==f.end&&0!==f.read&&(z=0,A=z<f.read?f.read-z-1:f.end-z),0===A&&(f.write=z,c=f.inflate_flush(a,c),z=f.write,A=z<f.read?f.read-z-1:f.end-z,z==f.end&&0!==f.read&&(z=0,A=z<f.read?f.read-z-1:f.end-z),0===A)))return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);if(c=i,d=h,d>y&&(d=y),d>A&&(d=A),f.window.set(a.read_buf(w,d),z),w+=d,y-=d,z+=d,A-=d,0!==(h-=d))break;g=0!==u?U:N;break;case Q:for(;q<14;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}if(k=d=16383&o,(31&d)>29||(d>>5&31)>29)return g=W,a.msg="too many length or distance symbols",c=m,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);if(d=258+(31&d)+(d>>5&31),!e||e.length<d)e=[];else for(B=0;B<d;B++)e[B]=0;o>>>=14,q-=14,n=0,g=R;case R:for(;n<4+(k>>>10);){for(;q<3;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}e[M[n++]]=7&o,o>>>=3,q-=3}for(;n<19;)e[M[n++]]=0;if(r[0]=7,d=x.inflate_trees_bits(e,r,s,v,a),d!=i)return c=d,c==m&&(e=null,g=W),f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);n=0,g=S;case S:for(;;){if(d=k,n>=258+(31&d)+(d>>5&31))break;var G,H;for(d=r[0];q<d;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}if(d=v[3*(s[0]+(o&p[d]))+1],H=v[3*(s[0]+(o&p[d]))+2],H<16)o>>>=d,q-=d,e[n++]=H;else{for(B=18==H?7:H-14,G=18==H?11:3;q<d+B;){if(0===y)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);c=i,y--,o|=(255&a.read_byte(w++))<<q,q+=8}if(o>>>=d,q-=d,G+=o&p[B],o>>>=B,q-=B,B=n,d=k,B+G>258+(31&d)+(d>>5&31)||16==H&&B<1)return e=null,g=W,a.msg="invalid bit length repeat",c=m,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);H=16==H?e[B-1]:0;do e[B++]=H;while(0!==--G);n=B}}s[0]=-1;var I=[],J=[],K=[],L=[];if(I[0]=9,J[0]=6,d=k,d=x.inflate_trees_dynamic(257+(31&d),1+(d>>5&31),e,I,J,K,L,v,a),d!=i)return d==m&&(e=null,g=W),c=d,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);t.init(I[0],J[0],v,K[0],v,L[0]),g=T;case T:if(f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,(c=t.proc(f,a,c))!=j)return f.inflate_flush(a,c);if(c=i,t.free(a),w=a.next_in_index,y=a.avail_in,o=f.bitb,q=f.bitk,z=f.write,A=z<f.read?f.read-z-1:f.end-z,0===u){g=N;break}g=U;case U:if(f.write=z,c=f.inflate_flush(a,c),z=f.write,A=z<f.read?f.read-z-1:f.end-z,f.read!=f.write)return f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);g=V;case V:return c=j,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);case W:return c=m,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c);default:return c=l,f.bitb=o,f.bitk=q,a.avail_in=y,a.total_in+=w-a.next_in_index,a.next_in_index=w,f.write=z,f.inflate_flush(a,c)}},f.free=function(a){f.reset(a,null),f.window=null,v=null},f.set_dictionary=function(a,b,c){f.window.set(a.subarray(b,b+c),0),f.read=f.write=c},f.sync_point=function(){return g==O?1:0}}function e(){function a(a){return a&&a.istate?(a.total_in=a.total_out=0,a.msg=null,a.istate.mode=ea,a.istate.blocks.reset(a,null),i):l}var b=this;b.mode=0,b.method=0,b.was=[0],b.need=0,b.marker=0,b.wbits=0,b.inflateEnd=function(a){return b.blocks&&b.blocks.free(a),b.blocks=null,i},b.inflateInit=function(c,e){return c.msg=null,b.blocks=null,e<8||e>15?(b.inflateEnd(c),l):(b.wbits=e,c.istate.blocks=new d(c,1<<e),a(c),i)},b.inflate=function(a,b){var c,d;if(!a||!a.istate||!a.next_in)return l;for(b=b==s?o:i,c=o;;)switch(a.istate.mode){case Z:if(0===a.avail_in)return c;if(c=b,a.avail_in--,a.total_in++,(15&(a.istate.method=a.read_byte(a.next_in_index++)))!=Y){a.istate.mode=ga,a.msg="unknown compression method",a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=ga,a.msg="invalid window size",a.istate.marker=5;break}a.istate.mode=$;case $:if(0===a.avail_in)return c;if(c=b,a.avail_in--,a.total_in++,d=255&a.read_byte(a.next_in_index++),((a.istate.method<<8)+d)%31!==0){a.istate.mode=ga,a.msg="incorrect header check",a.istate.marker=5;break}if(0===(d&X)){a.istate.mode=ea;break}a.istate.mode=_;case _:if(0===a.avail_in)return c;c=b,a.avail_in--,a.total_in++,a.istate.need=(255&a.read_byte(a.next_in_index++))<<24&4278190080,a.istate.mode=aa;case aa:if(0===a.avail_in)return c;c=b,a.avail_in--,a.total_in++,a.istate.need+=(255&a.read_byte(a.next_in_index++))<<16&16711680,a.istate.mode=ba;case ba:if(0===a.avail_in)return c;c=b,a.avail_in--,a.total_in++,a.istate.need+=(255&a.read_byte(a.next_in_index++))<<8&65280,a.istate.mode=ca;case ca:return 0===a.avail_in?c:(c=b,a.avail_in--,a.total_in++,a.istate.need+=255&a.read_byte(a.next_in_index++),a.istate.mode=da,k);case da:return a.istate.mode=ga,a.msg="need dictionary",a.istate.marker=0,l;case ea:if(c=a.istate.blocks.proc(a,c),c==m){a.istate.mode=ga,a.istate.marker=0;break}if(c==i&&(c=b),c!=j)return c;c=b,a.istate.blocks.reset(a,a.istate.was),a.istate.mode=fa;case fa:return j;case ga:return m;default:return l}},b.inflateSetDictionary=function(a,b,c){var d=0,e=c;return a&&a.istate&&a.istate.mode==da?(e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e),a.istate.blocks.set_dictionary(b,d,e),a.istate.mode=ea,i):l},b.inflateSync=function(b){var c,d,e,f,g;if(!b||!b.istate)return l;if(b.istate.mode!=ga&&(b.istate.mode=ga,b.istate.marker=0),0===(c=b.avail_in))return o;for(d=b.next_in_index,e=b.istate.marker;0!==c&&e<4;)b.read_byte(d)==ha[e]?e++:e=0!==b.read_byte(d)?0:4-e,d++,c--;return b.total_in+=d-b.next_in_index,b.next_in_index=d,b.avail_in=c,b.istate.marker=e,4!=e?m:(f=b.total_in,g=b.total_out,a(b),b.total_in=f,b.total_out=g,b.istate.mode=ea,i)},b.inflateSyncPoint=function(a){return a&&a.istate&&a.istate.blocks?a.istate.blocks.sync_point():l}}function f(){}function g(){var a=this,b=new f,c=512,d=r,e=new Uint8Array(c),g=!1;b.inflateInit(),b.next_out=e,a.append=function(a,f){var h,k,l=[],m=0,n=0,p=0;if(0!==a.length){b.next_in_index=0,b.next_in=a,b.avail_in=a.length;do{if(b.next_out_index=0,b.avail_out=c,0!==b.avail_in||g||(b.next_in_index=0,g=!0),h=b.inflate(d),g&&h===o){if(0!==b.avail_in)throw new Error("inflating: bad input")}else if(h!==i&&h!==j)throw new Error("inflating: "+b.msg);if((g||h===j)&&b.avail_in===a.length)throw new Error("inflating: bad input");b.next_out_index&&l.push(b.next_out_index===c?new Uint8Array(e):new Uint8Array(e.subarray(0,b.next_out_index))),p+=b.next_out_index,f&&b.next_in_index>0&&b.next_in_index!=m&&(f(b.next_in_index),m=b.next_in_index)}while(b.avail_in>0||0===b.avail_out);return k=new Uint8Array(p),l.forEach(function(a){k.set(a,n),n+=a.length}),k}},a.flush=function(){b.inflateEnd()}}var h=15,i=0,j=1,k=2,l=-2,m=-3,n=-4,o=-5,p=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],q=1440,r=0,s=4,t=9,u=5,v=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],w=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=15;b.inflate_trees_fixed=function(a,b,c,d){return a[0]=t,b[0]=u,c[0]=v,d[0]=w,i};var C=0,D=1,E=2,F=3,G=4,H=5,I=6,J=7,K=8,L=9,M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=0,O=1,P=2,Q=3,R=4,S=5,T=6,U=7,V=8,W=9,X=32,Y=8,Z=0,$=1,_=2,aa=3,ba=4,ca=5,da=6,ea=7,fa=12,ga=13,ha=[0,0,255,255];f.prototype={inflateInit:function(a){var b=this;return b.istate=new e,a||(a=h),b.istate.inflateInit(b,a)},inflate:function(a){var b=this;return b.istate?b.istate.inflate(b,a):l},inflateEnd:function(){var a=this;if(!a.istate)return l;var b=a.istate.inflateEnd(a);return a.istate=null,b},inflateSync:function(){var a=this;return a.istate?a.istate.inflateSync(a):l},inflateSetDictionary:function(a,b){var c=this;return c.istate?c.istate.inflateSetDictionary(c,a,b):l},read_byte:function(a){var b=this;return b.next_in.subarray(a,a+1)[0]},read_buf:function(a,b){var c=this;return c.next_in.subarray(a,a+b)}};var ia=a.zip||a;ia.Inflater=ia._jzlib_Inflater=g}(this),function(a){"use strict";function b(a){a.scripts&&a.scripts.length>0&&importScripts.apply(void 0,a.scripts),postMessage({type:"importScripts"})}function c(b){var c=a[b.codecClass],d=b.sn;if(j[d])throw Error("duplicated sn");j[d]={codec:new c(b.options),crcInput:"input"===b.crcType,crcOutput:"output"===b.crcType,crc:new g},postMessage({type:"newTask",sn:d})}function d(a){var b=a.sn,d=a.type,e=a.data,f=j[b];!f&&a.codecClass&&(c(a),f=j[b]);var g,h="append"===d,i=k();if(h)try{g=f.codec.append(e,function(a){postMessage({type:"progress",sn:b,loaded:a})})}catch(a){throw delete j[b],a}else delete j[b],g=f.codec.flush();var l=k()-i;i=k(),e&&f.crcInput&&f.crc.append(e),g&&f.crcOutput&&f.crc.append(g);var m=k()-i,n={type:d,sn:b,codecTime:l,crcTime:m},o=[];g&&(n.data=g,o.push(g.buffer)),h||!f.crcInput&&!f.crcOutput||(n.crc=f.crc.get());try{postMessage(n,o)}catch(a){postMessage(n)}}function e(a,b,c){var d={type:a,sn:b,error:f(c)};postMessage(d)}function f(a){return{message:a.message,stack:a.stack}}function g(){this.crc=-1}function h(){}if(a.zWorkerInitialized)throw new Error("z-worker.js should be run only once");a.zWorkerInitialized=!0,addEventListener("message",function(a){var b=a.data,c=b.type,d=b.sn,f=i[c];if(f)try{f(b)}catch(a){e(c,d,a)}});var i={importScripts:b,newTask:c,append:d,flush:d},j={},k=a.performance?a.performance.now.bind(a.performance):Date.now;g.prototype.append=function(a){for(var b=0|this.crc,c=this.table,d=0,e=0|a.length;d<e;d++)b=b>>>8^c[255&(b^a[d])];this.crc=b},g.prototype.get=function(){return~this.crc},g.prototype.table=function(){var a,b,c,d=[];for(a=0;a<256;a++){for(c=a,b=0;b<8;b++)1&c?c=c>>>1^3988292384:c>>>=1;d[a]=c}return d}(),a.NOOP=h,h.prototype.append=function(a,b){return a},h.prototype.flush=function(){}}(this);var _=function(){var a={},b={unknown:{name:"UNKNOWN"},unsupported:{name:"UNSUPPORTED"},mod_ProTracker:{name:"PROTRACKER",isMod:!0,loader:function(){return ba()}},mod_SoundTracker:{name:"SOUNDTRACKER",isMod:!0,loader:function(){return ca()}},mod_FastTracker:{name:"FASTTRACKER",isMod:!0,loader:function(){return aa()}},sample:{name:"SAMPLE",isSample:!0},zip:{name:"ZIP"}};return a.detect=function(a,c){function d(a){return a<128}function e(){a.goto(0);for(var b=0;b<20;b++)if(!d(a.readByte()))return!1;for(var c=0,e=0,g=0;g<15;g++){for(b=0;b<22;b++)if(!d(a.readByte()))return!1;a.jump(-22);var h=a.readString(22);if("st-"==h.toLowerCase().substr(0,3)&&(e+=10),e>20)return!0;c+=a.readWord(),a.jump(6)}return!(2*c+1624>f)}var f=a.length,g="";if(g=a.readString(17,0),"Extended Module: "==g)return b.mod_FastTracker;if(f>1100&&(g=a.readString(4,1080)),"M.K."==g)return b.mod_ProTracker;if("M!K!"==g)return b.mod_ProTracker;if("M&K!"==g)return b.mod_ProTracker;if("FLT4"==g)return b.mod_ProTracker;if("2CHN"==g)return b.mod_ProTracker;if("6CHN"==g)return b.mod_ProTracker;if("8CHN"==g)return b.mod_ProTracker;if("10CH"==g)return b.mod_ProTracker;if("12CH"==g)return b.mod_ProTracker;if("14CH"==g)return b.mod_ProTracker;if("16CH"==g)return b.mod_ProTracker;if("18CH"==g)return b.mod_ProTracker;if("20CH"==g)return b.mod_ProTracker;if("22CH"==g)return b.mod_ProTracker;if("24CH"==g)return b.mod_ProTracker;if("26CH"==g)return b.mod_ProTracker;if("28CH"==g)return b.mod_ProTracker;if("30CH"==g)return b.mod_ProTracker;if("32CH"==g)return b.mod_ProTracker;var h="";if(c&&c.length>4&&(h=c.substr(c.length-4)),h=h.toLowerCase(),".wav"==h)return b.sample;if(".mp3"==h)return b.sample;if(".iff"==h)return b.sample;if(".zip"==h)return b.zip;var i=a.readString(2,0);if("PK"==i)return b.zip;if(c&&c.indexOf(".")>=0&&f>1624){var j=e();if(j)return b.mod_SoundTracker}return b.sample},a}(),aa=function(){var a={};return a.load=function(a,b){var c={},d={patterns:[],samples:[]};a.litteEndian=!0,a.goto(17),d.title=a.readString(20),a.jump(1),c.trackerName=a.readString(20),c.trackerVersion=a.readByte(),c.trackerVersion=a.readByte()+"."+c.trackerVersion,c.headerSize=a.readDWord(),c.songlength=a.readWord(),c.restartPosition=a.readWord(),c.numberOfChannels=a.readWord(),c.numberOfPatterns=a.readWord(),c.numberOfInstruments=a.readWord(),c.flags=a.readWord(),c.defaultTempo=a.readWord(),c.defaultBPM=a.readWord();for(var e=[],f=0,g=0;g<c.songlength;++g)e[g]=a.readUbyte(),f<e[g]&&(f=e[g]);d.patternTable=e,d.length=c.songlength,d.channels=c.numberOfChannels;var h=60+c.headerSize;for(a.goto(h),g=0;g<=f;++g){var i=[],j={};j.headerSize=a.readDWord(),j.packingType=a.readUbyte(),j.patternLength=a.readWord(),j.patternSize=a.readWord(),h+=j.headerSize,a.goto(h);for(var k=0;k<j.patternLength;k++){var l,m=[];for(l=0;l<c.numberOfChannels;l++){var o={note:0,period:0,sample:0,volume:0,effect:0,param:0},p=a.readUbyte();128&p?(1&p&&(o.note=a.readUbyte()),2&p&&(o.sample=a.readUbyte()),4&p&&(o.volume=a.readUbyte()),8&p&&(o.effect=a.readUbyte()),16&p&&(o.param=a.readUbyte())):(o.note=p,o.sample=a.readUbyte(),o.volume=a.readUbyte(),o.effect=a.readUbyte(),o.param=a.readUbyte()),m.push(o)}i.push(m)}h+=j.patternSize,a.goto(h),d.patterns.push(i)}var q=[];for(g=1;g<=c.numberOfInstruments;++g){var r={};if(r.filePosition=a.index,r.headerSize=a.readDWord(),r.name=a.readString(22),r.type=a.readUbyte(),r.numberOfSamples=a.readWord(),r.samples=[],r.sampleHeaderSize=0,r.numberOfSamples>0&&(r.sampleHeaderSize=a.readDWord()),h+=r.headerSize,a.goto(h),a.isEOF(1))break;for(var s=0;s<r.numberOfSamples;s++){var t={name:r.name,data:[]};t.length=a.readDWord(),t.loopStart=a.readDWord(),t.loopRepeatLength=a.readDWord(),t.volume=a.readUbyte(),t.finetune=a.readByte(),t.type=a.readUbyte(),t.panning=a.readUbyte(),t.relativeNote=a.readByte(),t.reserved=a.readByte(),t.sName=a.readString(22),t.bits=8,r.samples.push(t),h+=r.sampleHeaderSize,a.goto(h)}for(s=0;s<r.numberOfSamples;s++)if(t=r.samples[s],t.length){h+=t.length,16&t.type&&(t.bits=16,t.type^=16,t.length>>=1,t.loopStart>>=1,t.loopRepeatLength>>=1),t.looptype=t.type||0,t.looptype||(t.loopStart=0,t.loopRepeatLength=0);var u=t.length,v=0;if(16==t.bits)for(var w=0;w<u;w++){var x=a.readShort()+v;x<-32768?x+=65536:x>32767&&(x-=65536),v=x,t.data.push(x/32768)}else for(w=0;w<u;w++)x=a.readByte()+v,x<-128?x+=256:x>127&&(x-=256),v=x,t.data.push(x/127);a.goto(h)}U.setSample(g,r.samples[0]),q.push({label:g+" "+r.name,data:g})}return n&&n.mainPanel.setInstruments(q),d.samples=U.getSamples(),d},a},ba=function(){var a={};return a.load=function(a,b){var c={patterns:[]},d=64,e=31,f=4;c.typeId=a.readString(4,1080),c.title=a.readString(20,0),"2CHN"===c.typeId&&(f=2),"6CHN"===c.typeId&&(f=6),"8CHN"===c.typeId&&(f=8),"10CH"===c.typeId&&(f=10),"12CH"===c.typeId&&(f=12),"14CH"===c.typeId&&(f=14),"16CH"===c.typeId&&(f=16),"18CH"===c.typeId&&(f=18),"20CH"===c.typeId&&(f=20),"22CH"===c.typeId&&(f=22),"24CH"===c.typeId&&(f=24),"26CH"===c.typeId&&(f=26),"28CH"===c.typeId&&(f=28),"30CH"===c.typeId&&(f=30),"32CH"===c.typeId&&(f=32),c.channels=f;var g=0;for(o=1;o<=e;++o){var h=a.readString(22),i=a.readWord(),k={name:h,data:[]};k.length=k.realLen=i<<1,k.finetune=a.readUbyte(),k.finetune>7&&(k.finetune-=16),k.volume=a.readUbyte(),k.loopStart=a.readWord()<<1,k.loopRepeatLength=a.readWord()<<1,k.pointer=g,g+=k.length,U.setSample(o,k)}c.samples=U.getSamples(),a.goto(950),c.length=a.readUbyte(),a.jump(1);for(var l=[],m=0,o=0;o<128;++o)l[o]=a.readUbyte(),l[o]>m&&(m=l[o]);for(c.patternTable=l,a.goto(1084),o=0;o<=m;++o){for(var p=[],q=0;q<d;q++){var r,s=[];for(r=0;r<f;r++){var t={},u=a.readUint();t.period=u>>16&4095,t.effect=u>>8&15,t.sample=u>>24&240|u>>12&15,t.param=255&u,s.push(t)}for(r=f;r<U.getTrackCount();r++)s.push({note:0,effect:0,sample:0,param:0});p.push(s)}c.patterns.push(p)}var v=[];for(o=1;o<=e;o++)if(k=U.getSample(o)){var w=k.length;for(k.loopRepeatLength>2&&D.unrollShortLoops&&k.loopRepeatLength<1e3&&(w=Math.min(w,k.loopStart+k.loopRepeatLength),k.length=w),j=0;j<w;j++){var x=a.readByte();j<2&&(x=0),k.data.push(x/127)}if((D.unrollShortLoops||D.unrollLoops)&&k.loopRepeatLength>2){var y=Math.ceil(4e4/k.loopRepeatLength)+1;D.unrollLoops||(y=0);var z=!1,A=0;D.unrollShortLoops&&k.loopRepeatLength<1600&&(y=Math.floor(1e3/k.loopRepeatLength),z=!0);for(var B=0;B<y;B++){var C=k.loopStart,E=C+k.loopRepeatLength;for(j=C;j<E;j++)k.data.push(k.data[j]);A+=k.loopRepeatLength}z&&A&&(k.loopRepeatLength+=A,k.length+=A)}v.push({label:o+" "+k.name,data:o})}return n&&n.mainPanel.setInstruments(v),c},a},ca=function(){var a={};return a.load=function(a,b){var c={patterns:[]},d=64,e=15;c.typeId="ST",c.channels=4,c.title=a.readString(20,0);var f=0;for(m=1;m<=e;++m){var g=a.readString(22),h=a.readWord(),i={name:g,data:[]};i.length=i.realLen=h<<1,i.volume=a.readWord(),i.finetune=0,i.loopStart=a.readWord(),i.loopRepeatLength=a.readWord()<<1,i.pointer=f,f+=i.length,U.setSample(m,i)}c.samples=U.getSamples(),a.goto(470),c.length=a.readUbyte(),c.speed=a.readUbyte();for(var k=[],l=0,m=0;m<128;++m)k[m]=a.readUbyte(),k[m]>l&&(l=k[m]);for(c.patternTable=k,a.goto(600),m=0;m<=l;++m){for(var o=[],p=0;p<d;p++){var q,r=[];for(q=0;q<4;q++){var s={},t=a.readUint();s.period=t>>16&4095,s.effect=t>>8&15,s.sample=t>>24&240|t>>12&15,s.param=255&t,r.push(s)}for(q=4;q<U.getTrackCount();q++)r.push({note:0,effect:0,sample:0,param:0});o.push(r)}c.patterns.push(o)}var u=[];for(m=1;m<=e;m++)if(i=U.getSample(m)){var v=i.length;for(j=0;j<v;j++){var w=a.readByte();j<2&&(w=0),i.data.push(w/127)}u.push({label:m+" "+i.name,data:m})}return n.mainPanel.setInstruments(u),c},a},da=function(){var a={},b="https://www.stef.be/bassoontracker/";b=window.location.href;var c=b;return b.indexOf("https://www.stef.be/")>=0&&(c="https://www.stef.be/bassoontracker/auth/dropbox.html"),a.isConnected=!1,a.checkConnected=function(b){dropboxService.getAccessToken()?dropboxService("users/get_current_account",void 0,{onComplete:function(c){c&&c.account_id&&(a.isConnected=!0,b&&b(!0))},onError:function(){b&&b(!1)}}):b&&b(!1)},a.authenticate=function(){dropboxService.clearAccessToken(),dropboxService.authenticate({client_id:"ukk9z4f0nd1xa13",redirect_uri:c},{onComplete:function(a){},onError:function(a){}})},a.list=function(a,b){dropboxService("files/list_folder",{path:a},function(a){var c=[];a.entries.forEach(function(a){var b=Math.floor(a.size/1e3)+"kb";c.push({title:a.name+" ("+b+")"||"---",url:a.id})}),b(c)})},a.getFile=function(a,b){dropboxService("files/download",{path:a},function(a,c,d){b(c)})},a.putFile=function(a,b){dropboxService("files/upload",{path:a},b,function(a,b,c){})},a}(),ea=function(){function a(a){g.length?a&&a(g):c("genres",function(b){b&&b.parent&&b.parent.forEach(function(a){var b={title:a.text+" ("+a.files+")",children:[]};a.children&&a.children.child&&a.children.child.length&&a.children.child.forEach(function(a){b.children.push({title:a.text+" ("+a.files+")",children:[],url:"genre/"+a.id})}),g.push(b)}),a&&a(g)})}function b(a,b,e){var f="genre/"+a;b&&(b=parseInt(b),f+="/"+b),c(f,function(c){e(d(c,["genre",a,b]))})}function c(a,b){I.json(f+a,function(a){a&&a.modarchive&&(a=a.modarchive),b(a)})}function d(a,b){var c=[];if(a){if(a.module){var d=a.module;d.forEach?d.forEach(function(a){c.push({title:a.songtitle||"---",url:a.url})}):c.push({title:d.songtitle||"---",url:d.url})}if(a.totalpages){var e=parseInt(a.totalpages);if(e>1){var f=b[0]+"/",g=parseInt(b[1]||1);isNaN(g)&&(g=1),"artist/"!=f&&"genre/"!=f||(f+=b[1]+"/",g=parseInt(b[2]||1),isNaN(g)&&(g=1)),e>g&&(f+=g+1,c.push({title:"... load more ...",children:[],url:f}))}}}return c}var e={},f="http://localhost:3000/";f="http://www.stef.be/bassoontracker/api/";var g=[];return e.get=function(e,f){var g=e.split("/");e=g[0];var h=g[1]||"",i=g[2]||"";switch(e){case"genres":a(f);break;case"genre":b(h,i,f);break;case"toprating":i=h||1,c("toprating/"+i,function(a){f(d(a,g))});break;case"topreview":i=h||1,c("topreview/"+i,function(a){f(d(a,g))});break;case"artist":var j="artist/"+h;i&&(j+="/"+i),c(j,function(a){f(d(a,g))});break;default:f([])}},e}(),fa=function(){function a(a){j.length?a&&a(j):d("artists",function(b){b&&b.forEach(function(a){var b={title:a.handle+" ("+a.count+")",url:"artist/"+a.id,children:[]};j.push(b)}),a&&a(j)})}function b(a){i.length?a&&a(i):d("genres",function(b){b&&b.forEach(function(a){var b=a.split("(")[0].trim(),c={title:a,url:"genre/"+b,children:[]};i.push(c)}),a&&a(i)})}function c(a,b,c){var f="genre/"+a;b&&(b=parseInt(b),f+="/"+b),d(f,function(d){c(e(d,["genre",a,b]))})}function d(a,b){I.json(g+a,function(a){b(a)})}function e(a){var b=[];return a&&a.forEach(function(a){b.push({title:a.title||"---",url:h+a.id})}),b}var f={},g="https://www.stef.be/bassoontracker/api/mpl/",h="https://www.stef.be/bassoontracker/api/modules.pl/",i=[],j=[];return f.get=function(f,g){var h=f.split("/");f=h[0];var i=h[1]||"",j=h[2]||"";switch(f){case"genres":b(g);break;case"genre":c(i,j,g);break;case"toprating":j=i||1,d("toprating/"+j,function(a){g(e(a,h))});break;case"topscore":j=i||1,d("topscore/"+j,function(a){g(e(a,h))});break;case"artists":a(g);break;case"artist":var k="artist/"+i;j&&(k+="/"+j),d(k,function(a){g(e(a,h))});break;default:g([])}},f}();return{init:U.init,load:U.load,playSong:U.playSong,stop:U.stop,togglePlay:U.togglePlay,isPlaying:U.isPlaying,getTrackCount:U.getTrackCount,getSong:U.getSong}}();