/*BassoonTracker v0.1.22 by Steffest - build 2017-08-13 - Full source on https://github.com/steffest/BassoonTracker */function loadFile(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(a){var d=c.response;d?b&&b(d):b&&b(!1)},c.send(null)}function saveFile(a,b){var c=document.createElement("a");document.body.appendChild(c),c.style="display: none",url=window.URL.createObjectURL(a),c.href=url,c.download=b,c.click(),window.URL.revokeObjectURL(url)}function BinaryStream(a,b){function c(a){a=0===a?a:a||d.index,a<0&&(a=0),a>=d.length&&(a=d.length-1),d.index=a}var d={index:0,litteEndian:!b};return d.goto=function(a){c(a)},d.jump=function(a){this.goto(this.index+a)},d.readByte=function(a){c(a);var b=this.dataView.getInt8(this.index);return this.index++,b},d.writeByte=function(a,b){c(b),this.dataView.setInt8(this.index,a),this.index++},d.readUbyte=function(a){c(a);var b=this.dataView.getUint8(this.index);return this.index++,b},d.writeUByte=function(a,b){c(b),this.dataView.setUint8(this.index,a),this.index++},d.readUint=function(a){c(a);var b=this.dataView.getUint32(this.index,this.litteEndian);return this.index+=4,b},d.writeUint=function(a,b){c(b),this.dataView.setUint32(this.index,a,this.litteEndian),this.index+=4},d.readBytes=function(a,b){c(b);var e=this.buffer,f=e.slice(d.index,d.index+a);return c(d.index+a),f},d.readString=function(a,b){c(b);var d=this.index,e=this.dataView,f="";for((a+=d)>this.length&&(a=this.length);d<a;++d){var g=e.getUint8(d);if(0==g)break;f+=String.fromCharCode(g)}return this.index=a,f},d.writeString=function(a,b){c(b);for(var d=this.dataView,e=a.length,f=0;f<e;f++)d.setUint8(this.index+f,a.charCodeAt(f));this.index+=e},d.writeStringSection=function(a,b,e,f){c(f),b=b||1,a=a||"",e=e||0;var g=a.length;g>b&&(a=a.substr(0,b)),d.writeString(a),d.fill(e,b-g)},d.readWord=function(a){c(a);var b=this.dataView.getUint16(this.index,this.litteEndian);return this.index+=2,b},d.writeWord=function(a,b){c(b),this.dataView.setUint16(this.index,a,this.litteEndian),this.index+=2},d.readDWord=d.readUint,d.readShort=function(a,b){c(b);var d=this.dataView.getInt16(this.index,this.litteEndian);return this.index+=2,d},d.clear=function(a){d.fill(0,a)},d.fill=function(a,b){a=a||0,b=b||0;for(var c=0;c<b;c++)d.writeByte(a)},d.isEOF=function(a){return a=a||0,this.index>=this.length-a},d.buffer=a,d.dataView=new DataView(a),d.length=a.byteLength,d}function getUrlParameter(a){if(window.location.getParameter)return window.location.getParameter(a);if(location.search)for(var b=location.search.substring(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]&&d[0]==a)return d[1]||!0}}var cachedAssets={images:{},audio:{},json:{},arrayBuffer:{}},sprites={},UI=void 0,PRELOADTYPE={image:1,audio:2,json:3,binary:4},EVENT={sampleChange:1,patternChange:2,patternPosChange:3,patternTableChange:4,recordingChange:5,cursorPositionChange:6,trackStateChange:7,playingChange:8,playTypeChange:9,songPositionChange:10,songSpeedChange:11,songBPMChange:12,samplePlay:13,screenRefresh:14,songPropertyChange:15,sampleNameChange:16,command:17,pianoNoteOn:18,pianoNoteOff:19,statusChange:20,diskOperationTargetChange:21},COMMAND={newFile:1,openFile:2,saveFile:3,clearTrack:4,clearPattern:5,clearSong:6,clearInstruments:7,showMain:8,showOptions:9,showFileOperations:10,showSampleEditor:11,showAbout:12,showHelp:13,togglePiano:14,showTop:15,showBottom:16,randomSong:17,showGithub:18},PLAYTYPE={song:1,pattern:2},FILETYPE={module:1,sample:2,pattern:3,track:4},MODULETYPE={mod:1,xm:2},STEREOSEPARATION={FULL:1,BALANCED:2,NONE:3},PALFREQUENCY=7093790,LAYOUTS={column4:4,column5:5,column5Full:6,column6:7},periodTable=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,0,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,0,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,0,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,0,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,0,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,0,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,0,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,0,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,0,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,0,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,0,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,0,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,0,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,0,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114,0],NOTEPERIOD={C1:{period:856,name:"C-1",tune:[907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814]},Cs1:{period:808,name:"C#1",tune:[856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768]},D1:{period:762,name:"D-1",tune:[808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725]},Ds1:{period:720,name:"D#1",tune:[762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684]},E1:{period:678,name:"E-1",tune:[720,715,709,704,699,694,689,684,678,674,670,665,660,655,651,646]},F1:{period:640,name:"F-1",tune:[678,675,670,665,660,655,651,646,640,637,632,628,623,619,614,610]},Fs1:{period:604,name:"F#1",tune:[640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575]},G1:{period:570,name:"G-1",tune:[604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543]},Gs1:{period:538,name:"G#1",tune:[570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513]},A1:{period:508,name:"A-1",tune:[538,535,532,528,524,520,516,513,508,505,502,498,495,491,487,484]},As1:{period:480,name:"A#1",tune:[508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457]},B1:{period:453,name:"B-1",tune:[480,477,474,470,467,463,460,457,453,450,447,444,441,437,434,431]},C2:{period:428,name:"C-2",tune:[453,450,447,444,441,437,434,431,428,425,422,419,416,413,410,407]},Cs2:{period:404,name:"C#2",tune:[428,425,422,419,416,413,410,407,404,401,398,395,392,390,387,384]},D2:{period:381,name:"D-2",tune:[404,401,398,395,392,390,387,384,381,379,376,373,370,368,365,363]},Ds2:{period:360,name:"D#2",tune:[381,379,376,373,370,368,365,363,360,357,355,352,350,347,345,342]},E2:{period:339,name:"E-2",tune:[360,357,355,352,350,347,345,342,339,337,335,332,330,328,325,323]},F2:{period:320,name:"F-2",tune:[339,337,335,332,330,328,325,323,320,318,316,314,312,309,307,305]},Fs2:{period:302,name:"F#2",tune:[320,318,316,314,312,309,307,305,302,300,298,296,294,292,290,288]},G2:{period:285,name:"G-2",tune:[302,300,298,296,294,292,290,288,285,284,282,280,278,276,274,272]},Gs2:{period:269,name:"G#2",tune:[285,284,282,280,278,276,274,272,269,268,266,264,262,260,258,256]},A2:{period:254,name:"A-2",tune:[269,268,266,264,262,260,258,256,254,253,251,249,247,245,244,242]},As2:{period:240,name:"A#2",tune:[254,253,251,249,247,245,244,242,240,239,237,235,233,232,230,228]},B2:{period:226,name:"B-2",tune:[240,238,237,235,233,232,230,228,226,225,224,222,220,219,217,216]},C3:{period:214,name:"C-3",tune:[226,225,223,222,220,219,217,216,214,213,211,209,208,206,205,204]},Cs3:{period:202,name:"C#3",tune:[214,212,211,209,208,206,205,203,202,201,199,198,196,195,193,192]},D3:{period:190,name:"D-3",tune:[202,200,199,198,196,195,193,192,190,189,188,187,185,184,183,181]},Ds3:{period:180,name:"D#3",tune:[190,189,188,187,185,184,183,181,180,179,177,176,175,174,172,171]},E3:{period:170,name:"E-3",tune:[180,179,177,176,175,174,172,171,170,169,167,166,165,164,163,161]},F3:{period:160,name:"F-3",tune:[170,169,167,166,165,164,163,161,160,159,158,157,156,155,154,152]},Fs3:{period:151,name:"F#3",tune:[160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144]},G3:{period:143,name:"G-3",tune:[151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136]},Gs3:{period:135,name:"G#3",tune:[143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128]},A3:{period:127,name:"A-3",tune:[135,134,133,132,131,130,129,128,127,126,125,125,124,123,122,121]},As3:{period:120,name:"A#3",tune:[127,126,125,125,123,123,122,121,120,119,118,118,117,116,115,114]},B3:{period:113,name:"B-3",tune:[120,119,118,118,117,116,115,114,113,113,112,111,110,109,109,108]}},KEYBOADKEYS={C:{name:"C",octave:0},Csharp:{name:"Cs",octave:0},D:{name:"D",octave:0},Dsharp:{name:"Ds",octave:0},E:{name:"E",octave:0},F:{name:"F",octave:0},Fsharp:{name:"Fs",octave:0},G:{name:"G",octave:0},Gsharp:{name:"Gs",octave:0},A:{name:"A",octave:0},Asharp:{name:"As",octave:0},B:{name:"B",octave:0},COctaveUp:{name:"C",octave:1},CsharpOctaveUp:{name:"Cs",octave:1},DOctaveUp:{name:"D",octave:1},DsharpOctaveUp:{name:"Ds",octave:1},EOctaveUp:{name:"E",octave:1},FOctaveUp:{name:"F",octave:1},FsharpOctaveUp:{name:"Fs",octave:1},GOctaveUp:{name:"G",octave:1},GsharpOctaveUp:{name:"Gs",octave:1},AOctaveUp:{name:"A",octave:1},AsharpOctaveUp:{name:"As",octave:1},BOctaveUp:{name:"B",octave:1},COctaveUp2:{name:"C",octave:2},CsharpOctaveUp2:{name:"Cs",octave:2},DOctaveUp2:{name:"D",octave:2}},KEYBOARDTABLE={azerty:{a:KEYBOADKEYS.COctaveUp,z:KEYBOADKEYS.DOctaveUp,e:KEYBOADKEYS.EOctaveUp,r:KEYBOADKEYS.FOctaveUp,t:KEYBOADKEYS.GOctaveUp,y:KEYBOADKEYS.AOctaveUp,u:KEYBOADKEYS.BOctaveUp,i:KEYBOADKEYS.COctaveUp2,o:KEYBOADKEYS.DOctaveUp2,"é":KEYBOADKEYS.CsharpOctaveUp,'"':KEYBOADKEYS.DsharpOctaveUp,"(":KEYBOADKEYS.FsharpOctaveUp,"§":KEYBOADKEYS.GsharpOctaveUp,"è":KEYBOADKEYS.AsharpOctaveUp,"ç":KEYBOADKEYS.CsharpOctaveUp2,w:KEYBOADKEYS.C,x:KEYBOADKEYS.D,c:KEYBOADKEYS.E,v:KEYBOADKEYS.F,b:KEYBOADKEYS.G,n:KEYBOADKEYS.A,",":KEYBOADKEYS.B,";":KEYBOADKEYS.COctaveUp,":":KEYBOADKEYS.DOctaveUp,s:KEYBOADKEYS.Csharp,d:KEYBOADKEYS.Dsharp,g:KEYBOADKEYS.Fsharp,h:KEYBOADKEYS.Gsharp,j:KEYBOADKEYS.Asharp},qwerty:{q:KEYBOADKEYS.COctaveUp,w:KEYBOADKEYS.DOctaveUp,e:KEYBOADKEYS.EOctaveUp,r:KEYBOADKEYS.FOctaveUp,t:KEYBOADKEYS.GOctaveUp,y:KEYBOADKEYS.AOctaveUp,u:KEYBOADKEYS.BOctaveUp,i:KEYBOADKEYS.COctaveUp2,o:KEYBOADKEYS.DOctaveUp2,2:KEYBOADKEYS.CsharpOctaveUp,3:KEYBOADKEYS.DsharpOctaveUp,5:KEYBOADKEYS.FsharpOctaveUp,6:KEYBOADKEYS.GsharpOctaveUp,7:KEYBOADKEYS.AsharpOctaveUp,9:KEYBOADKEYS.CsharpOctaveUp2,z:KEYBOADKEYS.C,x:KEYBOADKEYS.D,c:KEYBOADKEYS.E,v:KEYBOADKEYS.F,b:KEYBOADKEYS.G,n:KEYBOADKEYS.A,m:KEYBOADKEYS.B,",":KEYBOADKEYS.COctaveUp,".":KEYBOADKEYS.DOctaveUp,s:KEYBOADKEYS.Csharp,d:KEYBOADKEYS.Dsharp,g:KEYBOADKEYS.Fsharp,h:KEYBOADKEYS.Gsharp,j:KEYBOADKEYS.Asharp},qwertz:{q:KEYBOADKEYS.COctaveUp,w:KEYBOADKEYS.DOctaveUp,e:KEYBOADKEYS.EOctaveUp,r:KEYBOADKEYS.FOctaveUp,t:KEYBOADKEYS.GOctaveUp,z:KEYBOADKEYS.AOctaveUp,u:KEYBOADKEYS.BOctaveUp,i:KEYBOADKEYS.COctaveUp2,o:KEYBOADKEYS.DOctaveUp2,2:KEYBOADKEYS.CsharpOctaveUp,3:KEYBOADKEYS.DsharpOctaveUp,5:KEYBOADKEYS.FsharpOctaveUp,6:KEYBOADKEYS.GsharpOctaveUp,7:KEYBOADKEYS.AsharpOctaveUp,9:KEYBOADKEYS.CsharpOctaveUp2,y:KEYBOADKEYS.C,x:KEYBOADKEYS.D,c:KEYBOADKEYS.E,v:KEYBOADKEYS.F,b:KEYBOADKEYS.G,n:KEYBOADKEYS.A,m:KEYBOADKEYS.B,",":KEYBOADKEYS.COctaveUp,".":KEYBOADKEYS.DOctaveUp,s:KEYBOADKEYS.Csharp,d:KEYBOADKEYS.Dsharp,g:KEYBOADKEYS.Fsharp,h:KEYBOADKEYS.Gsharp,j:KEYBOADKEYS.Asharp}},SETTINGS={unrollLoops:!1,unrollShortLoops:!1,sustainKeyboardNotes:!1,useHover:!0,keyboardTable:"qwerty",vubars:!0,stereoSeparation:STEREOSEPARATION.BALANCED,emulateProtracker1OffsetBug:!0},EventBus=function(){var a={},b={};return b.onEvent=function(b,c){var d=a[b];d||(d=[],a[b]=d),d.push(c)},b.sendEvent=function(b,c){var d=a[b];if(d){var e,f=d.length;for(e=0;e<f;e++)d[e](c,b)}},b.trigger=function(a,c){b.sendEvent(a,c)},b.on=function(a,c){b.onEvent(a,c)},b}(),Audio=function(){function a(a){e=a.createGain(),e.gain.value=1,e.connect(a.destination),d=a.createGain(),d.gain.value=.7,d.connect(e),f=a.createBiquadFilter(),f.type="lowpass",f.frequency.value=2e4,f.connect(d)}var b={};window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var c,d,e,f,g,h,i,j,k=[],l=[],m={volume:!0,panning:!0,high:!0,mid:!0,low:!0,lowPass:!0,reverb:!0,distortion:!1},n=!1;return AudioContext&&(c=new AudioContext,a(c)),b.init=function(a){if(a=a||c){var d=Tracker.getTrackCount();for(k=[],g=0;g<d;g++){var e=FilterChain(m);e.output().connect(f),e.panningValue(g%2==0?-.5:.5),k.push(e)}b.filterChains=k,n||EventBus.on(EVENT.trackStateChange,function(a){"undefined"!=typeof a.track&&k[a.track]&&k[a.track].volumeValue(a.mute?0:70)})}},b.enable=function(){e.gain.value=1},b.disable=function(){e.gain.value=0},b.playSample=function(a,d,e,f,h,i){var l;n?l=j:(l=c,b.enable()),d=d||428,f=f||Tracker.getCurrentTrack(),i=i||0;var m=Tracker.getSample(a),o=d;if(m){var p,q=0,r=0,s=0;e="undefined"==typeof e?100*m.volume/64:e,m.finetune&&(d=b.getFineTunePeriod(d,m.finetune));var t=PALFREQUENCY/(2*d),u=1;m.data.length?(r=m.data.length,s=m.loopStart,h&&h.offset&&(h.offset.value>=r&&(h.offset.value=r-1),q=h.offset.value,r-=q,s&&(s-=q)),p=l.createBuffer(1,r,l.sampleRate),u=t/l.sampleRate):(p=l.createBuffer(1,1,t),q=0);var v=p.getChannelData(0);for(g=0;g<r;g++)v[g]=m.data[g+q];var w=l.createBufferSource();w.buffer=p;var x=l.createGain();x.gain.value=e/100,m.loopRepeatLength>2&&(SETTINGS.unrollLoops||(w.loop=!0,w.loopStart=s/l.sampleRate,w.loopEnd=(s+m.loopRepeatLength)/l.sampleRate)),w.connect(x),x.connect(k[f].input()),w.playbackRate.value=u;var y=0,z=i+y;w.start(z);var A={source:w,volume:x,startVolume:e,currentVolume:e,startPeriod:d,basePeriod:o,startPlaybackRate:u,sampleIndex:a,effects:h,track:f};return n||EventBus.trigger(EVENT.samplePlay,A),A}return{}},b.playSilence=function(){if(c){var a=c.createBufferSource();a.connect(d),a.start()}},b.isRecording=function(){return h},b.startRecording=function(){if(!h&&c&&c.createMediaStreamDestination){var a=c.createMediaStreamDestination();i=new MediaRecorder(a.stream),i.ondataavailable=function(a){l.push(a.data)},i.onstop=function(a){var b=new Blob(l,{type:"audio/ogg; codecs=opus"});saveAs(b,"recording.opus")},d.connect(a),i.start(),h=!0}},b.stopRecording=function(){h&&(h=!1,i.stop())},b.startRendering=function(c){n=!0,j=new OfflineAudioContext(2,44100*c,44100),b.context=j,a(j),b.init(j)},b.stopRendering=function(d){n=!1,j.startRendering().then(function(a){d&&d(audioBufferToWav(a))}).catch(function(a){}),b.context=c,a(c),b.init(c)},b.setStereoSeparation=function(a){var b,c=Tracker.getTrackCount();switch(a){case STEREOSEPARATION.NONE:b=0,SETTINGS.stereoSeparation=STEREOSEPARATION.NONE;break;case STEREOSEPARATION.FULL:b=1,SETTINGS.stereoSeparation=STEREOSEPARATION.FULL;break;default:b=.5,SETTINGS.stereoSeparation=STEREOSEPARATION.BALANCED}for(g=0;g<c;g++){var d=k[g];d&&d.panningValue(g%2==0?-b:b)}},b.masterVolume=d,b.cutOffVolume=e,b.lowPassfilter=f,b.context=c,b.getSemiToneFrom=function(a,c,d){var e=a;if(d&&(a=b.getFineTuneBasePeriod(a,d),a||(a=e)),c){var f=periodNoteTable[a];if(f){var g=noteNames.indexOf(f.name),h=noteNames[g+c];if(h){var i=nameNoteTable[h];i&&(e=i.period,d&&(e=b.getFineTunePeriod(e,d)))}}}return e},b.getNearestSemiTone=function(a,b){var c=8;if(b){var d=Tracker.getSample(b);d&&d.finetune&&(c+=d.finetune)}var e=1e5,f=a;for(var g in NOTEPERIOD)if(NOTEPERIOD.hasOwnProperty(g)){var h=NOTEPERIOD[g].tune[c],i=Math.abs(h-a);i<e&&(e=i,f=h)}return f},b.getFineTunePeriod=function(a,b){var c=a,d=periodNoteTable[a];if(d&&d.tune){var e=8+b;e>=0&&e<d.tune.length&&(c=d.tune[e])}return c},b.getFineTuneBasePeriod=function(a,b){var c=a,d=periodFinetuneTable[b];return d&&(c=d[a]),c},b.limitAmigaPeriod=function(a){return a=Math.max(a,113),a=Math.min(a,856)},b.setAmigaLowPassFilter=function(a,b){var c=a?2e3:2e4;f.frequency.setValueAtTime(c,b)},b.waveFormFunction={sine:function(a,b,c,d){return a+Math.sin(b*c)*d*2},saw:function(a,b,c,d){var e=b*c/7%1;return e=2*e-1,e=e*d*-2,a+e},square:function(a,b,c,d){var e=Math.sin(b*c)<=0?-1:1;return e=e*d*2,a+e}},b}();!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b,c){var d=a("./lib/WAAClock");b.exports=d,"undefined"!=typeof window&&(window.WAAClock=d)},{"./lib/WAAClock":2}],3:[function(a,b,c){var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.binding=function(a){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b,c){var d=a("__browserify_process"),e="undefined"!=typeof window;if(e&&!AudioContext)throw new Error("This browser doesn't seem to support web audio API");var f={toleranceLate:.1,toleranceEarly:.001},g=function(a,b,c){this.clock=a,this.func=c,this.repeatTime=null,this.toleranceLate=f.toleranceLate,this.toleranceEarly=f.toleranceEarly,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(b)};g.prototype.clear=function(){return this.clock._removeEvent(this),this},g.prototype.repeat=function(a){if(0===a)throw new Error("delay cannot be 0");return this.repeatTime=a,this},g.prototype.tolerance=function(a){return"number"==typeof a.late&&(this.toleranceLate=a.late),"number"==typeof a.early&&(this.toleranceEarly=a.early),this._update(),this},g.prototype.isRepeated=function(){return null!==this.repeatTime},g.prototype.schedule=function(a){this._armed=!0,this.deadline=a,this._update(),this.clock.context.currentTime>=this._earliestTime&&(this.clock._removeEvent(this),this._execute())},g.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):this.onexpired&&this.onexpired(this),this._armed===!1&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},g.prototype._update=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly,this.clock._removeEvent(this),this.clock._insertEvent(this)};var h=b.exports=function(a,b){b=b||{},this.toleranceEarly=b.toleranceEarly||f.toleranceEarly,this.toleranceLate=b.toleranceLate||f.toleranceLate,this.context=a,this._events=[],this._started=!1};h.prototype.setTimeout=function(a,b){return this._createEvent(a,this._absTime(b))},h.prototype.callbackAtTime=function(a,b){return this._createEvent(a,b)},h.prototype.timeStretch=function(a,b,c){var d=this,e=d.context.currentTime;return b.forEach(function(b){b.isRepeated()&&b.repeat(b.repeatTime*c);var d=a+c*(b.deadline-a);if(b.isRepeated())for(;e>=d-b.toleranceEarly;)d+=b.repeatTime;b.schedule(d)}),b},h.prototype.start=function(){if(this._started===!1){var a=this;this._started=!0,this._events=[];var b=256;this._clockNode=this.context.createScriptProcessor(b,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){d.nextTick(function(){a._tick()})}}},h.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())},h.prototype._tick=function(){for(var a=this._events.shift();a&&a._earliestTime<=this.context.currentTime;)a._execute(),a=this._events.shift();a&&this._events.unshift(a)},h.prototype._createEvent=function(a,b){var c=new g(this,b,a);return c.tolerance({late:this.toleranceLate,early:this.toleranceEarly}),c},h.prototype._insertEvent=function(a){this._events.splice(this._indexByTime(a._earliestTime),0,a)},h.prototype._removeEvent=function(a){var b=this._events.indexOf(a);b!==-1&&this._events.splice(b,1)},h.prototype._indexByTime=function(a){for(var b,c=0,d=this._events.length;c<d;)b=Math.floor((c+d)/2),this._events[b]._earliestTime<a?c=b+1:d=b;return c},h.prototype._absTime=function(a){return a+this.context.currentTime},h.prototype._relTime=function(a){return a-this.context.currentTime}},{__browserify_process:3}]},{},[1]),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){"use strict";var c=b.AudioContext||b.webkitAudioContext,d=a("stereo-panner-node");c&&!c.prototype.createStereoPanner&&(c.prototype.createStereoPanner=function(){return new d(this)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"stereo-panner-node":4}],2:[function(a,b,c){"use strict";var d=4096,e=new Float32Array(d),f=new Float32Array(d);!function(){for(var a=0;a<d;a++)e[a]=Math.cos(a/d*Math.PI*.5),f[a]=Math.sin(a/d*Math.PI*.5)}(),b.exports={L:e,R:f}},{}],3:[function(a,b,c){(function(c){"use strict";function d(a){this.audioContext=a,this.inlet=a.createChannelSplitter(2),this._pan=a.createGain(),this.pan=this._pan.gain,this._wsL=a.createWaveShaper(),this._wsR=a.createWaveShaper(),this._L=a.createGain(),this._R=a.createGain(),this.outlet=a.createChannelMerger(2),this.inlet.channelCount=2,this.inlet.channelCountMode="explicit",this._pan.gain.value=0,this._wsL.curve=e.L,this._wsR.curve=e.R,this._L.gain.value=0,this._R.gain.value=0,this.inlet.connect(this._L,0),this.inlet.connect(this._R,1),this._L.connect(this.outlet,0,0),this._R.connect(this.outlet,0,1),this._pan.connect(this._wsL),this._pan.connect(this._wsR),this._wsL.connect(this._L.gain),this._wsR.connect(this._R.gain),this._isConnected=!1,this._dc1buffer=null,this._dc1=null}var e=a("./curve");d.prototype.connect=function(a){var b=this.audioContext;this._isConnected||(this._isConnected=!0,this._dc1buffer=b.createBuffer(1,2,b.sampleRate),this._dc1buffer.getChannelData(0).set([1,1]),this._dc1=b.createBufferSource(),this._dc1.buffer=this._dc1buffer,this._dc1.loop=!0,this._dc1.start(b.currentTime),this._dc1.connect(this._pan)),c.AudioNode.prototype.connect.call(this.outlet,a)},d.prototype.disconnect=function(){var a=this.audioContext;this._isConnected&&(this._isConnected=!1,this._dc1.stop(a.currentTime),this._dc1.disconnect(),this._dc1=null,this._dc1buffer=null),c.AudioNode.prototype.disconnect.call(this.outlet)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./curve":2}],4:[function(a,b,c){"use strict";function d(a){var b=new e(a);return Object.defineProperties(b.inlet,{pan:{value:b.pan,enumerable:!0},connect:{value:function(a){return b.connect(a)}},disconnect:{value:function(){return b.disconnect()}}}),b.inlet}var e=a("./stereo-panner-impl");b.exports=d},{"./stereo-panner-impl":3}]},{},[1]),FilterChain=function(a){function b(){d.volumeValue(A)}function c(a){for(var b,c="number"==typeof a?a:50,d=44100,e=new Float32Array(d),f=Math.PI/180,g=0;g<d;++g)b=2*g/d-1,e[g]=(3+c)*b*20*f/(Math.PI+c*Math.abs(b));return e}var d={};a=a||{volume:!0,panning:!0};var e,f,g,h,i,j,k,l,m,n,o,p=a.volume,q=a.panning,r=a.high,s=a.mid,t=a.low,u=a.lowPass,v=a.reverb,w=a.distortion,x=0,y=0,z=0,A=70,B=0,C=30,D=Audio.context;if(r&&(i=D.createBiquadFilter(),i.type="highshelf",i.frequency.value=3200,i.gain.value=z,e=i,f=i),s&&(j=D.createBiquadFilter(),j.type="peaking",j.frequency.value=1e3,j.Q.value=.5,j.gain.value=y,e||(e=j),f&&f.connect(j),f=j),t&&(k=D.createBiquadFilter(),k.type="lowshelf",k.frequency.value=320,k.gain.value=x,e||(e=k),f&&f.connect(k),f=k),u&&(l=D.createBiquadFilter(),l.type="lowpass",l.frequency.value=5e3,e||(e=l),f&&f.connect(l),f=l),v&&(m=D.createConvolver(),n=D.createGain(),n.gain.value=0,e||(e=n),f&&f.connect(n),n.connect(m),g=m),w){var E=D.createWaveShaper();E.curve=c(400),E.oversample="4x"}return p&&(h=D.createGain(),e||(e=h),f&&f.connect(h),g&&g.connect(h),f=h),q&&(o=Audio.context.createStereoPanner(),e||(e=o),f&&f.connect(o),f=o),d.lowValue=function(a){if(t){if("undefined"!=typeof a){var b=20;x=a,k.gain.value=x*b}return x}},d.midValue=function(a){if(s){if("undefined"!=typeof a){var b=20;y=a,j.gain.value=y*b}return y}},d.highValue=function(a){if(r){if("undefined"!=typeof a){var b=20;z=a,i.gain.value=z*b}return z}},d.lowPassFrequencyValue=function(a){if(u){var b=40,c=Audio.context.sampleRate/2,d=Math.log(c/b)/Math.LN2,e=Math.pow(2,d*(a-1));l.frequency.value=c*e}},d.lowPassQualityValue=function(a){u&&(l.Q.value=a*C)},d.reverbValue=function(a){if(v){if(!m.buffer){var b=cachedAssets.audio["data/reverb/sportcentre.m4a"];if(b)m.buffer=b;else{var c=PreLoader();c.load(["data/reverb/sportcentre.m4a"],PRELOADTYPE.audio,function(){m.buffer=cachedAssets.audio["data/reverb/sportcentre.m4a"]})}}var d=100,e=parseInt(a)/d;n.gain.value=e*e}},d.volumeValue=function(a){if(p){if("undefined"!=typeof a){var b=100;A=a;var c=a/b;h.gain.value=c*c}return A}},d.panningValue=function(a){if(q)return"undefined"!=typeof a&&(B=a,o.pan.value=B),B},d.input=function(){return e},d.output=function(){return f},b(),d};var periodNoteTable={},periodFinetuneTable={},nameNoteTable={},noteNames=[],Tracker=function(){function a(a){a=a||0,j=j||new WAAClock(Audio.context),j.start(),Audio.enable(),UI&&UI.setStatus("Playing"),R=[],S=[],p=k.patterns[a];var c=p.length,d={},f=0,g=Audio.context.currentTime+.01,h=.1,i=1,l=p,m=E;Q=[],s=j.setTimeout(function(j){f>1&&(h=i,s.repeat(h));for(var n=j.deadline+h;g<n;)if(t.setStateAtTime(g,{patternPos:f,songPos:m}),d.patternDelay){for(d.patternDelay--,T=0;T<J;T++)e(T,g);g+=H*I}else if(d=b(f,g,l,m),g+=H*I,f++,f>=c||d.patternBreak)if(d.positionBreak&&d.targetSongPosition==m||(R=[],S=[]),f=0,Tracker.getPlayType()==PLAYTYPE.song){var o=d.positionBreak?d.targetSongPosition:++m;o>=k.length&&(o=0),m=o,a=k.patternTable[m],l=k.patterns[a],d.patternBreak&&(f=d.targetPatternPosition||0)}else d.patternBreak&&(f=d.targetPatternPosition||0)},.01).repeat(h).tolerance({early:.1})}function b(a,b,d,f){d=d||p;for(var g,h=d[a],i=h.length,j={},k=0;k<i;k++){var l=h[k],m={position:f,step:a},n=b;if(L){var o=(Math.random()*L*2-L)/1e3;n+=o}g=c(l,k,n,m),g.patternBreak&&(j.patternBreak=!0,j.targetPatternPosition=g.targetPatternPosition||0),g.positionBreak&&(j.positionBreak=!0,j.targetPatternPosition=g.targetPatternPosition||0,j.targetSongPosition=g.targetSongPosition||0),g.patternDelay&&(j.patternDelay=g.patternDelay)}for(k=0;k<i;k++)e(k,b);return j}function c(a,b,c,e){var f=100,g={},h=a.sample;if(a.period&&!a.sample&&(h=O[b].currentSample,f="number"==typeof O[b].currentVolume?O[b].currentVolume:f,SETTINGS.emulateProtracker1OffsetBug&&h&&P[b].offset&&P[b].offset.sample==h&&(g.offset=P[b].offset)),"number"==typeof a.sample){var i=t.getSample(a.sample);i&&(f=100*(i.volume/64),SETTINGS.emulateProtracker1OffsetBug&&(P[b].offset=P[b].offset||{},P[b].offset.value=0,P[b].offset.sample=a.sample))}var j,k,l=a.period,m=f,n=!0,o=a.param,p={};switch(a.effect){case 0:if(o){j=o>>4,k=15&o;var s=l||O[b].startPeriod,u=0,v=h||O[b]?O[b].currentSample:0;v&&(i=t.getSample(v),i&&i.finetune&&(u=i.finetune,s=Audio.getFineTunePeriod(s,u))),g.arpeggio={root:s,interval1:s-Audio.getSemiToneFrom(s,j,u),interval2:s-Audio.getSemiToneFrom(s,k,u),step:1}}a.sample&&(g.volume={value:f});break;case 1:o*=-1,g.slide={value:o},P[b].slideUp=g.slide;break;case 2:g.slide={value:o},P[b].slideDown=g.slide;break;case 3:n=!1;var w=a.period;if(O[b].currentSample&&(h=O[b].currentSample),w&&h){var i=t.getSample(h);i&&i.finetune&&(w=Audio.getFineTunePeriod(w,i.finetune))}var x=P[b].slide;x&&(o||(o=x.value)),w||(w=P[b].defaultSlideTarget),g.slide={value:o,target:w,canUseGlissando:!0},P[b].slide=g.slide,a.sample&&(g.volume={value:f});break;case 4:a.sample&&(O[b].startVolume&&(g.volume={value:m}),O[b].vibratoTimer=0),j=o>>4,k=15&o;var y=j*H/64,z=P[b].vibrato;0==j&&z&&(y=z.freq),0==k&&z&&(k=z.amplitude),g.vibrato={amplitude:k,freq:y},P[b].vibrato=g.vibrato;break;case 5:n=!1;var w=a.period;if(w&&h){var i=t.getSample(h);i&&i.finetune&&(w=Audio.getFineTunePeriod(w,i.finetune))}o=1;var x=P[b].slide;x&&(w||(w=x.target||0),o=x.value),g.slide={value:o,target:w},P[b].slide=g.slide,a.sample&&(g.volume={value:f}),o=a.param,o&&(a.param<16?o*=-1:o=a.param>>4,o=100*o/64,g.fade={value:o,resetOnStep:!!a.sample},P[b].fade=g.fade);break;case 6:a.sample&&(O[b].startVolume&&(g.volume={value:m}),O[b].vibratoTimer=0),a.param&&(a.param<16?o*=-1:o=15&a.param,o=100*o/64,g.fade={value:o},P[b].fade=g.fade),P[b].vibrato&&(g.vibrato=P[b].vibrato);break;case 7:a.period&&!a.sample&&(O[b].startVolume&&(g.volume={value:m}),O[b].tremoloTimer=0),j=o>>4,k=15&o;var A=k,y=j*H/64,B=P[b].tremolo;0==j&&B&&(y=B.freq),0==k&&B&&(A=B.amplitude),g.tremolo={amplitude:A,freq:y},P[b].tremolo=g.tremolo;break;case 8:break;case 9:o<<=8,!o&&P[b].offset&&(o=P[b].offset.stepValue||P[b].offset.value||0);var C=o;SETTINGS.emulateProtracker1OffsetBug&&!a.sample&&P[b].offset&&(o+=P[b].offset.value),g.offset={value:o,stepValue:C},P[b].offset=P[b].offset||{},P[b].offset.value=g.offset.value,P[b].offset.stepValue=g.offset.stepValue,SETTINGS.emulateProtracker1OffsetBug&&(a.sample&&(P[b].offset.sample=a.sample),a.period&&(P[b].offset.value+=C)),a.sample&&(g.volume={value:f});break;case 10:if(a.param<16?o*=-1:o=a.param>>4,o=100*o/64,!a.param){var D=P[b].fade;D&&(o=D.value)}g.fade={value:o,resetOnStep:!!a.sample};break;case 11:p.patternBreak=!0,p.positionBreak=!0,p.targetSongPosition=a.param,p.targetPatternPosition=0;break;case 12:m=a.param/64*100,g.volume={value:m};break;case 13:p.patternBreak=!0,j=o>>4,k=15&o,p.targetPatternPosition=10*j+k,p.targetPatternPosition>=K&&(p.targetPatternPosition=0);break;case 14:var E=o>>4,F=15&o;switch(E){case 0:Audio.setAmigaLowPassFilter(!F,c);break;case 1:F*=-1,!F&&P[b].fineSlide&&(F=P[b].fineSlide.value),g.slide={value:F,fine:!0},P[b].fineSlide=g.slide;break;case 2:!F&&P[b].fineSlide&&(F=P[b].fineSlide.value),g.slide={value:F,fine:!0},P[b].fineSlide=g.slide;break;case 3:P[b].glissando=!!F;break;case 4:switch(F){case 1:q=Audio.waveFormFunction.saw;break;case 2:q=Audio.waveFormFunction.square;break;case 3:q=Audio.waveFormFunction.sine;break;case 4:q=Audio.waveFormFunction.sine;break;case 5:q=Audio.waveFormFunction.saw;break;case 6:q=Audio.waveFormFunction.square;break;case 7:q=Audio.waveFormFunction.sine;break;default:q=Audio.waveFormFunction.sine}break;case 5:if(h){var i=t.getSample(h);g.fineTune={
original:i.finetune,sample:i},i.finetune=F,F>7&&(i.finetune=F-15)}break;case 6:F?(S[b]=S[b]||0,S[b]<F?(S[b]++,p.patternBreak=!0,p.positionBreak=!0,p.targetSongPosition=e.position,p.targetPatternPosition=R[b]||0):S[b]=0):R[b]=e.step;break;case 7:switch(F){case 1:r=Audio.waveFormFunction.saw;break;case 2:r=Audio.waveFormFunction.square;break;case 3:r=Audio.waveFormFunction.sine;break;case 4:r=Audio.waveFormFunction.sine;break;case 5:r=Audio.waveFormFunction.saw;break;case 6:r=Audio.waveFormFunction.square;break;case 7:r=Audio.waveFormFunction.sine;break;default:r=Audio.waveFormFunction.sine}break;case 8:break;case 9:F&&(g.reTrigger={value:F});break;case 10:F=100*F/64,g.fade={value:F,fine:!0};break;case 11:F=100*F/64,g.fade={value:-F,fine:!0};break;case 12:F?F<H&&(g.cutNote={value:F}):n=!1;break;case 13:F&&(F<H?c+=I*F:n=!1);break;case 14:p.patternDelay=F;break;case 15:}break;case 15:a.param<=32?(0==a.param&&(a.param=1),Tracker.setAmigaSpeed(a.param)):Tracker.setBPM(a.param)}return n&&h&&l&&(d(b,c),O[b]=Audio.playSample(h,l,m,b,g,c),P[b].defaultSlideTarget=O[b].startPeriod),h&&(O[b].currentSample=h,g.fineTune&&g.fineTune.sample&&(g.fineTune.sample.finetune=g.fineTune.original||0)),O[b].effects=g,O[b].note=a,p}function d(a,b){try{if(O[a].source){var c=O[a].volume.gain;c.setValueAtTime(O[a].currentVolume/100,b-.002),c.linearRampToValueAtTime(0,b),O[a].source.stop(b+.02)}}catch(a){}}function e(a,b){var c=O[a],e=c.effects;if(c&&e){var f;if(c.resetPeriodOnStep&&c.source){var g=c.currentPeriod||c.startPeriod,h=c.startPeriod/g;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b),c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b+.01),c.resetPeriodOnStep=!1}if(e.volume){var i=e.volume.value;c.volume&&c.volume.gain.setValueAtTime(i/100,b),c.currentVolume=i}if(e.fade){f=e.fade.value;var j;j=e.fade.resetOnStep?c.startVolume:c.currentVolume;var k=H;e.fade.fine&&(k=1);for(var l=0;l<k;l++)c.volume&&(c.volume.gain.setValueAtTime(j/100,b+l*I),j+=f,j=Math.max(j,0),j=Math.min(j,100));c.currentVolume=j}if(e.slide&&c.source){var m=c.currentPeriod||c.startPeriod,g=m;f=Math.abs(e.slide.value);var k=H;e.slide.fine&&(k=2);for(var l=1;l<k;l++){e.slide.target?(P[a].defaultSlideTarget=e.slide.target,g<e.slide.target?(g+=f,g>e.slide.target&&(g=e.slide.target)):(g-=f,g<e.slide.target&&(g=e.slide.target))):(g+=e.slide.value,P[a].defaultSlideTarget&&(P[a].defaultSlideTarget+=e.slide.value)),g=Audio.limitAmigaPeriod(g);var n=g;if(e.slide.canUseGlissando&&P[a].glissando&&(n=Audio.getNearestSemiTone(g,c.sampleIndex)),n!=c.currentPeriod){c.currentPeriod=g;var h=c.startPeriod/n;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b+l*I),c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b+l*I+.005)}}}if(e.arpeggio&&c.source){var g,m=c.currentPeriod||c.startPeriod;c.resetPeriodOnStep=!0;for(var l=0;l<H;l++){var o=l%3;0==o&&(g=m),1==o&&e.arpeggio.interval1&&(g=m-e.arpeggio.interval1),2==o&&e.arpeggio.interval2&&(g=m-e.arpeggio.interval2);var h=m/g;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b+l*I)}}if(e.vibrato){var p=e.vibrato.freq,s=e.vibrato.amplitude;if(c.vibratoTimer=c.vibratoTimer||0,c.source){c.resetPeriodOnStep=!0,m=c.currentPeriod||c.startPeriod;for(var l=0;l<H;l++){g=q(m,c.vibratoTimer,p,s);var h=c.startPeriod/g;c.source.playbackRate.setValueAtTime(c.startPlaybackRate*h,b+l*I),c.vibratoTimer++}}}if(e.tremolo){var p=e.tremolo.freq,s=e.tremolo.amplitude;if(c.tremoloTimer=c.tremoloTimer||0,c.volume)for(var t=c.startVolume,l=0;l<H;l++)t=r(t,c.tremoloTimer,p,s),t<0&&(t=0),t>100&&(t=100),c.volume.gain.setValueAtTime(t/100,b+l*I),c.currentVolume=t,c.tremoloTimer++}if(e.cutNote&&(c.volume.gain.setValueAtTime(0,b+e.cutNote.value*I),c.currentVolume=0),e.reTrigger){var u=c.sampleIndex,v=c.startPeriod;i=c.startVolume;for(var w=e.reTrigger.value||1;w<H;){var x=b+w*I;d(a,x),O[a]=Audio.playSample(u,v,i,a,e,x),w+=w}}}}function f(){UI&&UI.mainPanel.setPatternTable(k.patternTable),UI&&UI.setInfo(k.title),n=void 0,l=void 0,m=void 0,F=void 0,t.setCurrentSongPosition(0),t.setCurrentPatternPos(0),t.setCurrentSampleIndex(1),t.clearEffectCache(),EventBus.trigger(EVENT.songPropertyChange,k)}function g(){t.setAmigaSpeed(6),t.setBPM(125),q=Audio.waveFormFunction.sine,r=Audio.waveFormFunction.sine,P=[],O=[];for(var a=0;a<J;a++)O.push({}),P.push({})}function h(){for(var a=[],b=0;b<K;b++){var c,d=[];for(c=0;c<4;c++)d.push({note:0,effect:0,sample:0,param:0});a.push(d)}return a}function i(){return{length:0,finetune:0,volume:100,loopStart:0,loopRepeatLength:0,name:"",data:[]}}var j,k,l,m,n,o,p,q,r,s,t={},u=!1,v=!1,w=[],x=1,y=0,z=0,A=0,B=0,C=0,D=PLAYTYPE.song,E=0,F=0,G=125,H=6,I=2.5/G,J=4,K=64,L=0,M={},N=getUrlParameter("tracks");8==N&&(J=8),16==N&&(J=16),32==N&&(J=32),64==N&&(J=64),128==N&&(J=128),256==N&&(J=256),512==N&&(J=512),1024==N&&(J=1024);for(var O=[],P=[],Q=[],R=[],S=[],T=0;T<J;T++)O.push({}),P.push({});return t.init=function(a){for(var b=-8;b<8;b++)periodFinetuneTable[b]={};for(var c in NOTEPERIOD)if(NOTEPERIOD.hasOwnProperty(c)){var d=NOTEPERIOD[c];if(periodNoteTable[d.period]=d,nameNoteTable[d.name]=d,noteNames.push(d.name),d.tune)for(b=-8;b<8;b++){var e=periodFinetuneTable[b],f=b+8;e[d.tune[f]]=d.period}}a&&Audio.init()},t.setCurrentSampleIndex=function(a){k.samples[a]&&(x=a,l!=x&&EventBus.trigger(EVENT.sampleChange,x),l=x)},t.getCurrentSampleIndex=function(){return x},t.getCurrentSample=function(){return w[x]},t.setCurrentPattern=function(a){y=a,p=k.patterns[y],p||(p=h(),k.patterns[y]=p),m!=y&&EventBus.trigger(EVENT.patternChange,y),m=y},t.getCurrentPattern=function(){return y},t.updatePatternTable=function(a,b){k.patternTable[a]=b,EventBus.trigger(EVENT.patternTableChange,b),a==E&&(m=void 0,Tracker.setCurrentPattern(b))},t.setCurrentPatternPos=function(a){z=a,n!=z&&EventBus.trigger(EVENT.patternPosChange,z),n=z},t.getCurrentPatternPos=function(){return z},t.moveCurrentPatternPos=function(a){var b=z+a,c=63;b<0&&(b=c),b>c&&(b=0),t.setCurrentPatternPos(b)},t.setCurrentCursorPosition=function(a){C=a,A=Math.floor(C/6),B=C%6,o!=C&&EventBus.trigger(EVENT.cursorPositionChange,C),o=B},t.getCurrentCursorPosition=function(){return C},t.moveCursorPosition=function(a){var b=C+a,c=6*J-1;b>c&&(b=0),b<0&&(b=c),t.setCurrentCursorPosition(b)},t.getCurrentTrack=function(){return A},t.getCurrentTrackPosition=function(){return B},t.getCurrentSongPosition=function(){return E},t.setCurrentSongPosition=function(a,b){E=a,E!=F&&(EventBus.trigger(EVENT.songPositionChange,E),k.patternTable&&t.setCurrentPattern(k.patternTable[E]),F=E,b&&t.isPlaying()&&(t.stop(),t.togglePlay()))},t.addToPatternTable=function(a,b){"undefined"==typeof a&&(a=k.length),b=b||0,a==k.length&&(k.patternTable[a]=b,k.length++),EventBus.trigger(EVENT.songPropertyChange,k),EventBus.trigger(EVENT.patternTableChange)},t.removeFromPatternTable=function(a){k.length<2||("undefined"==typeof a&&(a=k.length-1),a==k.length-1&&(k.patternTable[a]=0,k.length--),E==k.length&&t.setCurrentSongPosition(E-1),EventBus.trigger(EVENT.songPropertyChange,k),EventBus.trigger(EVENT.patternTableChange))},t.setPlayType=function(a){D=a,EventBus.trigger(EVENT.playTypeChange,D)},t.getPlayType=function(){return D},t.playSong=function(){t.stop(),t.setPlayType(PLAYTYPE.song),v=!0,a(y),EventBus.trigger(EVENT.playingChange,v)},t.playPattern=function(){t.stop(),z=0,t.setPlayType(PLAYTYPE.pattern),v=!0,a(y),EventBus.trigger(EVENT.playingChange,v)},t.stop=function(){j&&j.stop(),Audio.disable(),UI&&(UI.setStatus("Ready"),Input.clearInputNotes()),t.clearEffectCache();for(var a=0;a<J;a++)if(O[a].source)try{O[a].source.stop()}catch(a){}v=!1,EventBus.trigger(EVENT.playingChange,v)},t.togglePlay=function(){t.isPlaying()?t.stop():D==PLAYTYPE.pattern?t.playPattern():t.playSong()},t.save=function(a){t.buildBinary(MODULETYPE.mod,function(b){var c=new Blob([b.buffer],{type:"application/octet-stream"}),d=a||t.getFileName();saveAs(c,d)})},t.getProperties=function(){return{ticksPerStep:H,tickTime:I}},t.playPatternStep=b,t.renderTrackToBuffer=function(a){var c=0,d=0,e=64,f=0,g=H*I*e;for(Audio.startRendering(g);c<e;){b(c,f);f+=H*I,c++}c=0,d++,Audio.stopRendering(function(b){var c=new Blob([b],{type:"octet/stream"});a=a||t.getSong().title.replace(/ /g,"-").replace(/\W/g,"")+".wav"||"module-export.wav",saveAs(c,a)})},t.setBPM=function(a){j&&j.timeStretch(Audio.context.currentTime,[s],G/a),G=a,I=2.5/G,EventBus.trigger(EVENT.songBPMChange,G)},t.getBPM=function(){return G},t.setAmigaSpeed=function(a){H=a},t.getAmigaSpeed=function(){return H},t.getSwing=function(){return L},t.setSwing=function(a){L=a},t.getPatterLength=function(){return K},t.getTrackCount=function(){return J},t.toggleRecord=function(){t.stop(),u=!u,EventBus.trigger(EVENT.recordingChange,u)},t.isPlaying=function(){return v},t.isRecording=function(){return u},t.putNote=function(a,b){var c=k.patterns[y][z][A];c&&(c.sample=a,c.period=b),k.patterns[y][z][A]=c,EventBus.trigger(EVENT.patternChange,y)},t.putNoteParam=function(a,b){var c,d,e=k.patterns[y][z][A];if(e){if(1==a||2==a){var f=e.sample;c=f>>4,d=15&f,1==a&&(c=b),2==a&&(d=b),e.sample=(c<<4)+d}if(3==a&&(e.effect=b),4==a||5==a){var g=e.param;c=g>>4,d=15&g,4==a&&(c=b),5==a&&(d=b),e.param=(c<<4)+d}}k.patterns[y][z][A]=e,EventBus.trigger(EVENT.patternChange,y)},t.setStateAtTime=function(a,b){Q.push({time:a,state:b})},t.getStateAtTime=function(a){for(var b=void 0,c=0,d=Q.length;c<d;c++){var e=Q[0];if(!(e.time<a))return b;b=Q.shift().state}return b},t.load=function(a,b,c){a=a||"demomods/StardustMemories.mod";var d=a.substr(a.lastIndexOf("/")+1);UI&&(UI.setInfo(""),UI.setStatus("Loading")),loadFile(a,function(e){var f=t.processFile(e,d);if(UI&&UI.setStatus("Ready"),f){var g="",h="";if(a.indexOf("modarchive.org")>0){var i=a.split("moduleid=")[1];k.filename=i.split("#")[1]||i,i=i.split("#")[0],i=i.split("&")[0],h="modArchive",g="https://modarchive.org/index.php?request=view_by_moduleid&query="+i,EventBus.trigger(EVENT.songPropertyChange,k)}UI&&UI.setInfo(k.title,h,g)}if(UI&&f&&!b){var j=window.location.pathname,l=j.substring(j.lastIndexOf("/")+1);window.history.pushState&&window.history.pushState({},d,l+"?file="+encodeURIComponent(a))}var m=getUrlParameter("autoplay");!UI&&b&&(m="1"),"true"!=m&&"1"!=m||Tracker.playSong(),c&&c()})},t.handleUpload=function(a){if(a.length){var b=a[0],c=new FileReader;c.onload=function(){t.processFile(c.result,b.name),UI&&UI.setStatus("Ready")},c.readAsArrayBuffer(b)}},t.processFile=function(a,b){var c=!1,d=new BinaryStream(a,!0),e=FileDetector.detect(d,b);return e.isMod&&e.loader&&(c=!0,t.isPlaying()&&t.stop(),g(),k=e.loader().load(d,b),k.filename=b,f()),e.isSample&&t.importSample(d,b),c},t.getSong=function(){return k},t.getSamples=function(){return w},t.getSample=function(a){return w[a]},t.setSample=function(a,b){w[a]=b},t.importSample=function(a,b){var c=w[x]||{};c.name=b,c.length=a.length,c.loopStart=0,c.loopRepeatLength=0,c.finetune=0,c.volume=100,c.data=[],detectSampleType(a,c),EventBus.trigger(EVENT.sampleChange,x),EventBus.trigger(EVENT.sampleNameChange,x)},t.buildBinary=function(a,b){a=a||MODULETYPE.mod;var c=1084,d=0;for(f=0;f<128;f++){var e=k.patternTable[f]||0;d=Math.max(d,e)}c+=1024*(d+1),w.forEach(function(a){a&&(c+=a.length)});var f,g=new ArrayBuffer(c),h=new BinaryStream(g,!0);for(h.writeStringSection(k.title,20),w.forEach(function(a){a?(a.length=Math.min(a.length,131070),h.writeStringSection(a.name,22),h.writeWord(a.length>>1),h.writeUByte(a.finetune),h.writeUByte(a.volume),h.writeWord(a.loopStart>>1),h.writeWord(a.loopRepeatLength>>1)):h.clear(30)}),h.writeUByte(k.length),h.writeUByte(127),f=0;f<128;f++){var e=k.patternTable[f]||0;h.writeUByte(e)}for(h.writeString("M.K."),f=0;f<=d;f++)for(var i=k.patterns[f],j=0;j<K;j++)for(var l=i[j],m=0;m<J;m++){var n=l[m],o=0,p=n.sample;p>15&&(o=16,p=n.sample-16);var q=(o<<24)+(n.period<<16)+(p<<12)+(n.effect<<8)+n.param;h.writeUint(q)}w.forEach(function(a){if(a&&a.data&&a.length){h.clear(2);var b;for(f=0;f<a.length-2;f++)b=a.data[f]||0,h.writeByte(Math.round(127*b))}}),b&&b(h)},t.clearTrack=function(){for(var a=p.length,b=0;b<a;b++){var c=k.patterns[y][b][A];c&&(c.sample=0,c.period=0,c.effect=0,c.param=0)}EventBus.trigger(EVENT.patternChange,y)},t.clearPattern=function(){for(var a=p.length,b=0;b<a;b++)for(var c=0;c<J;c++){var d=k.patterns[y][b][c];d&&(d.sample=0,d.period=0,d.effect=0,d.param=0)}EventBus.trigger(EVENT.patternChange,y)},t.copyTrack=function(a){var b="undefined"!=typeof a;b||(a=y);for(var c=p.length,d=[],e=0;e<c;e++){var f=k.patterns[y][e][a];d.push({sample:f.sample,period:f.period,effect:f.effect,param:f.param})}return b?d:void(M.track=d)},t.copyPattern=function(){for(var a=[],b=0;b<J;b++){var c=t.copyTrack(b);a.push(c)}M.pattern=a},t.getPasteData=function(){return M},t.pasteTrack=function(a,b){var c="undefined"!=typeof a,d=b;if(c||(a=A,d=M.track),d){for(var e=p.length,f=0;f<e;f++){var g=k.patterns[y][f][a],h=d[f];g.sample=h.sample,g.period=h.period,g.effect=h.effect,g.param=h.param}return c||EventBus.trigger(EVENT.patternChange,y),!0}return!1},t.pastePattern=function(){var a=M.pattern;if(a){for(var b=0;b<J;b++)t.pasteTrack(b,a[b]);return EventBus.trigger(EVENT.patternChange,y),!0}return!1},t.clearEffectCache=function(){P=[];for(var a=0;a<J;a++)P.push({})},t.clearInstruments=function(){var a=[];for(T=1;T<=31;++T)w[T]=i(),a.push({label:T+" ",data:T});k.samples=w,UI&&UI.mainPanel.setInstruments(a),EventBus.trigger(EVENT.sampleChange,x)},t.new=function(){g(),k={patterns:[],samples:[]},w=[],k.typeId="M.K.",k.title="new song",k.length=1,k.patterns.push(h()),t.clearInstruments();for(var a=[],b=0;b<128;++b)a[b]=0;k.patternTable=a,f()},t.clearSample=function(){w[x]=i(),EventBus.trigger(EVENT.sampleChange,x),EventBus.trigger(EVENT.sampleNameChange,x)},t.getFileName=function(){return k.filename||(k.title?k.title.replace(/ /g,"-").replace(/\W/g,"")+".mod":"new.mod")},t}(),PreLoader=function(){var a={};a.load=function(c,d,e){a.type=d||PRELOADTYPE.image,a.loadCount=0,a.max=c.length,a.next=e;for(var f=0,g=c.length;f<g;f++)b(c[f])};var b=function(b){if(a.type==PRELOADTYPE.image){var c=new Image;c.onload=function(){cachedAssets.images[b]=this,++a.loadCount==a.max&&a.next&&a.next()},c.onerror=function(){alert("BufferLoader: XHR error")},c.src=b}if(a.type==PRELOADTYPE.audio){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.open("GET",b,!0),d.onload=function(){Audio.context.decodeAudioData(d.response,function(c){return c?(cachedAssets.audio[b]=c,void(++a.loadCount==a.max&&a.next&&a.next())):void alert("error decoding file data: "+b)},function(a){})},d.onerror=function(){alert("BufferLoader: XHR error")},d.send()}};return a},FetchService=function(){var a={},b=3e4;return a.get=function(b,c){a.ajax({url:b,success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.json=function(b,c){"undefined"==typeof c&&(c=function(){}),a.ajax({url:b,cache:!1,datatype:"json",headers:[{key:"Accept",value:"application/json"}],success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.html=function(b,c){a.ajax({url:b,cache:!1,datatype:"html",success:function(a){c(a)},error:function(a){c(void 0,a)}})},a.ajax=function(a){var c=new XMLHttpRequest;a.error=a.error||function(){a.success(!1)},"jsonp"===a.datatype&&a.error(c);var d=a.url;if("boolean"==typeof a.cache&&!a.cache){var e=(new Date).getTime();d+=d.indexOf("?")>0?"&r="+e:"?r="+e}var f=a.method||"GET";c.onreadystatechange=function(){if(!(c.readyState<4)&&4===c.readyState)if(200!==c.status&&201!==c.status)a.error(c);else{var b=c.responseText;"json"===a.datatype&&(b=JSON.parse(b)),"html"===a.datatype&&(b=document.createElement("div"),b.innerHTML=c.responseText),a.success(b)}},c.ontimeout=function(a){},c.open(f,d,!0),c.timeout=a.timeout||b,a.headers&&a.headers.forEach(function(a){c.setRequestHeader(a.key,a.value)});var g=a.data||"";"POST"==f&&a.data&&c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(g)},a}(),FileDetector=function(){var a={},b={unknown:{name:"UNKNOWN"},unsupported:{name:"UNSUPPORTED"},mod_ProTracker:{name:"PROTRACKER",isMod:!0,loader:function(){return ProTracker()}},mod_SoundTracker:{name:"SOUNDTRACKER",isMod:!0,loader:function(){return SoundTracker()}},sample:{name:"SAMPLE",isSample:!0}};return a.detect=function(a,c){function d(a){return 0==a||a>31&&a<128}function e(){a.goto(0);for(var b=0;b<20;b++)if(!d(a.readByte()))return!1;for(var c=0,e=0;e<15;e++){for(b=0;b<22;b++)if(!d(a.readByte()))return!1;c+=a.readWord(),a.jump(6)}return!(2*c+1624>f)}var f=a.length,g="";if(g=a.readString(17,0),"Extended Module: "==g)return alert("Sorry, FastTracker XM files are not supported yet ..."),b.unsupported;if(f>1100&&(g=a.readString(4,1080)),"M.K."==g)return b.mod_ProTracker;if("FLT4"==g)return b.mod_ProTracker;if("8CHN"==g)return alert("Sorry, 8 channel mod files are not supported yet ..."),b.unsupported;var h="";if(c&&c.length>4&&(h=c.substr(c.length-4)),h=h.toLowerCase(),".wav"==h)return b.sample;if(".mp3"==h)return b.sample;if(".iff"==h)return b.sample;if(c&&c.indexOf(".")>=0&&f>1624){var i=e();if(i)return b.mod_SoundTracker}return b.sample},a}(),ProTracker=function(){var a={};return a.load=function(a,b){var c={patterns:[]},d=64,e=31;c.typeId=a.readString(4,1080),c.title=a.readString(20,0);var f=0;for(m=1;m<=e;++m){var g=a.readString(22),h=a.readWord(),i={name:g,data:[]};i.length=i.realLen=h<<1,i.finetune=a.readUbyte(),i.finetune>7&&(i.finetune-=16),i.volume=a.readUbyte(),i.loopStart=a.readWord()<<1,i.loopRepeatLength=a.readWord()<<1,i.pointer=f,f+=i.length,Tracker.setSample(m,i)}c.samples=Tracker.getSamples(),a.goto(950),c.length=a.readUbyte(),a.jump(1);for(var k=[],l=0,m=0;m<128;++m)k[m]=a.readUbyte(),k[m]>l&&(l=k[m]);for(c.patternTable=k,a.goto(1084),m=0;m<=l;++m){for(var n=[],o=0;o<d;o++){var p,q=[];for(p=0;p<4;p++){var r={},s=a.readUint();r.period=s>>16&4095,r.effect=s>>8&15,r.sample=s>>24&240|s>>12&15,r.param=255&s,q.push(r)}for(p=4;p<Tracker.getTrackCount();p++)q.push({note:0,effect:0,sample:0,param:0});n.push(q)}c.patterns.push(n)}var t=[];for(m=1;m<=e;m++)if(i=Tracker.getSample(m)){var u=i.length;for(i.loopRepeatLength>2&&SETTINGS.unrollShortLoops&&i.loopRepeatLength<1e3&&(u=Math.min(u,i.loopStart+i.loopRepeatLength),i.length=u),j=0;j<u;j++){var v=a.readByte();j<2&&(v=0),i.data.push(v/127)}if((SETTINGS.unrollShortLoops||SETTINGS.unrollLoops)&&i.loopRepeatLength>2){var w=Math.ceil(4e4/i.loopRepeatLength)+1;SETTINGS.unrollLoops||(w=0);var x=!1,y=0;SETTINGS.unrollShortLoops&&i.loopRepeatLength<1600&&(w=Math.floor(1e3/i.loopRepeatLength),x=!0);for(var z=0;z<w;z++){var A=i.loopStart,B=A+i.loopRepeatLength;for(j=A;j<B;j++)i.data.push(i.data[j]);y+=i.loopRepeatLength}x&&y&&(i.loopRepeatLength+=y,i.length+=y)}t.push({label:m+" "+i.name,data:m})}return UI&&UI.mainPanel.setInstruments(t),c},a},SoundTracker=function(){var a={};return a.load=function(a,b){var c={patterns:[]},d=64,e=15;c.typeId="ST",c.title=a.readString(20,0);var f=0;for(m=1;m<=e;++m){var g=a.readString(22),h=a.readWord(),i={name:g,data:[]};i.length=i.realLen=h<<1,i.volume=a.readWord(),i.finetune=0,i.loopStart=a.readWord(),i.loopRepeatLength=a.readWord()<<1,i.pointer=f,f+=i.length,Tracker.setSample(m,i)}c.samples=Tracker.getSamples(),a.goto(470),c.length=a.readUbyte(),c.speed=a.readUbyte();for(var k=[],l=0,m=0;m<128;++m)k[m]=a.readUbyte(),k[m]>l&&(l=k[m]);for(c.patternTable=k,a.goto(600),m=0;m<=l;++m){for(var n=[],o=0;o<d;o++){var p,q=[];for(p=0;p<4;p++){var r={},s=a.readUint();r.period=s>>16&4095,r.effect=s>>8&15,r.sample=s>>24&240|s>>12&15,r.param=255&s,q.push(r)}for(p=4;p<Tracker.getTrackCount();p++)q.push({note:0,effect:0,sample:0,param:0});n.push(q)}c.patterns.push(n)}var t=[];for(m=1;m<=e;m++)if(i=Tracker.getSample(m)){var u=i.length;for(j=0;j<u;j++){var v=a.readByte();j<2&&(v=0),i.data.push(v/127)}t.push({label:m+" "+i.name,data:m})}return UI.mainPanel.setInstruments(t),c},a};